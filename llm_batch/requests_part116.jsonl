{"custom_id": "requests#22db55a8896b69e53d0a3cc2764c27b832c81478", "method": "POST", "url": "/v1/chat/completions", "body": {"model": "gpt-4o", "messages": [{"role": "user", "content": "You are a senior reviewer.\n\nCommit Summary:\nLines Added: 1 | Lines Deleted: 1 | Files Changed: 1 | Hunks: 1 | Methods Changed: 1 | Complexity Δ (Sum/Max): 0/0 | Churn Δ: 2 | Churn Cumulative: 1276 | Contributors (this commit): 57 | Commits (past 90d): 1 | Contributors (cumulative): 57 | DMM Complexity: None\n\nDIFF:\n@@ -25,7 +25,7 @@ def request(method, url, **kwargs):\n     :param cookies: (optional) Dict or CookieJar object to send with the :class:`Request`.\n     :param files: (optional) Dictionary of ``'name': file-like-objects`` (or ``{'name': file-tuple}``) for multipart encoding upload.\n         ``file-tuple`` can be a 2-tuple ``('filename', fileobj)``, 3-tuple ``('filename', fileobj, 'content_type')``\n-        or a 4-tuple ``('filename', fileobj, 'content_type', custom_headers)``, where ``'content-type'`` is a string\n+        or a 4-tuple ``('filename', fileobj, 'content_type', custom_headers)``, where ``'content_type'`` is a string\n         defining the content type of the given file and ``custom_headers`` a dict-like object containing additional headers\n         to add for the file.\n     :param auth: (optional) Auth tuple to enable Basic/Digest/Custom HTTP Auth.\n\n\nQuestion: Does this commit introduce technical debt? Answer yes or no."}], "max_tokens": 1, "temperature": 0}}
{"custom_id": "requests#fecf3dc472ddc78e20e96ea0b18e1589110c1d5e", "method": "POST", "url": "/v1/chat/completions", "body": {"model": "gpt-4o", "messages": [{"role": "user", "content": "You are a senior reviewer.\n\nCommit Summary:\nLines Added: 2 | Lines Deleted: 0 | Files Changed: 1 | Hunks: 1 | Methods Changed: 1 | Complexity Δ (Sum/Max): 0/0 | Churn Δ: 2 | Churn Cumulative: 4061 | Contributors (this commit): 109 | Commits (past 90d): 3 | Contributors (cumulative): 109 | DMM Complexity: None\n\nDIFF:\n@@ -545,6 +545,8 @@ class Session(SessionRedirectMixin):\n         :type allow_redirects: bool\n         :param proxies: (optional) Dictionary mapping protocol or protocol and\n             hostname to the URL of the proxy.\n+        :param hooks: (optional) Dictionary mapping hook name to one event or\n+            list of events, event must be callable.\n         :param stream: (optional) whether to immediately download the response\n             content. Defaults to ``False``.\n         :param verify: (optional) Either a boolean, in which case it controls whether we verify\n\n\nQuestion: Does this commit introduce technical debt? Answer yes or no."}], "max_tokens": 1, "temperature": 0}}
{"custom_id": "requests#2ecdb685619340735fa85d253c4779029957246f", "method": "POST", "url": "/v1/chat/completions", "body": {"model": "gpt-4o", "messages": [{"role": "user", "content": "You are a senior reviewer.\n\nCommit Summary:\nLines Added: 8 | Lines Deleted: 8 | Files Changed: 1 | Hunks: 8 | Methods Changed: 4 | Complexity Δ (Sum/Max): 0/0 | Churn Δ: 16 | Churn Cumulative: 1318 | Contributors (this commit): 33 | Commits (past 90d): 1 | Contributors (cumulative): 33 | DMM Complexity: None\n\nDIFF:\n@@ -2,7 +2,7 @@\n requests.cookies\n ~~~~~~~~~~~~~~~~\n \n-Compatibility code to be able to use `cookielib.CookieJar` with requests.\n+Compatibility code to be able to use `http.cookiejar.CookieJar` with requests.\n \n requests.utils imports from here, so be careful with imports.\n \"\"\"\n@@ -23,7 +23,7 @@ except ImportError:\n class MockRequest:\n     \"\"\"Wraps a `requests.Request` to mimic a `urllib2.Request`.\n \n-    The code in `cookielib.CookieJar` expects this interface in order to correctly\n+    The code in `http.cookiejar.CookieJar` expects this interface in order to correctly\n     manage cookie policies, i.e., determine whether a cookie can be set, given the\n     domains of the request and the cookie.\n \n@@ -76,7 +76,7 @@ class MockRequest:\n         return self._r.headers.get(name, self._new_headers.get(name, default))\n \n     def add_header(self, key, val):\n-        \"\"\"cookielib has no legitimate use for this method; add it back if you find one.\"\"\"\n+        \"\"\"cookiejar has no legitimate use for this method; add it back if you find one.\"\"\"\n         raise NotImplementedError(\n             \"Cookie headers should be added with add_unredirected_header()\"\n         )\n@@ -104,11 +104,11 @@ class MockResponse:\n     \"\"\"Wraps a `httplib.HTTPMessage` to mimic a `urllib.addinfourl`.\n \n     ...what? Basically, expose the parsed HTTP headers from the server response\n-    the way `cookielib` expects to see them.\n+    the way `http.cookiejar` expects to see them.\n     \"\"\"\n \n     def __init__(self, headers):\n-        \"\"\"Make a MockResponse for `cookielib` to read.\n+        \"\"\"Make a MockResponse for `cookiejar` to read.\n \n         :param headers: a httplib.HTTPMessage or analogous carrying the headers\n         \"\"\"\n@@ -124,7 +124,7 @@ class MockResponse:\n def extract_cookies_to_jar(jar, request, response):\n     \"\"\"Extract the cookies from the response into a CookieJar.\n \n-    :param jar: cookielib.CookieJar (not necessarily a RequestsCookieJar)\n+    :param jar: http.cookiejar.CookieJar (not necessarily a RequestsCookieJar)\n     :param request: our own requests.Request object\n     :param response: urllib3.HTTPResponse object\n     \"\"\"\n@@ -174,7 +174,7 @@ class CookieConflictError(RuntimeError):\n \n \n class RequestsCookieJar(cookielib.CookieJar, MutableMapping):\n-    \"\"\"Compatibility class; is a cookielib.CookieJar, but exposes a dict\n+    \"\"\"Compatibility class; is a http.cookiejar.CookieJar, but exposes a dict\n     interface.\n \n     This is the CookieJar we create by default for requests and sessions that\n@@ -341,7 +341,7 @@ class RequestsCookieJar(cookielib.CookieJar, MutableMapping):\n         self.set(name, value)\n \n     def __delitem__(self, name):\n-        \"\"\"Deletes a cookie given a name. Wraps ``cookielib.CookieJar``'s\n+        \"\"\"Deletes a cookie given a name. Wraps ``http.cookiejar.CookieJar``'s\n         ``remove_cookie_by_name()``.\n         \"\"\"\n         remove_cookie_by_name(self, name)\n\n\nQuestion: Does this commit introduce technical debt? Answer yes or no."}], "max_tokens": 1, "temperature": 0}}
{"custom_id": "requests#dfe46c1b7f55c9377caecba2119be14d3cce74e5", "method": "POST", "url": "/v1/chat/completions", "body": {"model": "gpt-4o", "messages": [{"role": "user", "content": "You are a senior reviewer.\n\nCommit Summary:\nLines Added: 1 | Lines Deleted: 5 | Files Changed: 1 | Hunks: 1 | Methods Changed: 1 | Complexity Δ (Sum/Max): 0/0 | Churn Δ: 6 | Churn Cumulative: 3566 | Contributors (this commit): 105 | Commits (past 90d): 1 | Contributors (cumulative): 105 | DMM Complexity: 0.0\n\nDIFF:\n@@ -466,11 +466,7 @@ def dict_from_cookiejar(cj):\n     :rtype: dict\n     \"\"\"\n \n-    cookie_dict = {}\n-\n-    for cookie in cj:\n-        cookie_dict[cookie.name] = cookie.value\n-\n+    cookie_dict = {cookie.name: cookie.value for cookie in cj}\n     return cookie_dict\n \n \n\n\nQuestion: Does this commit introduce technical debt? Answer yes or no."}], "max_tokens": 1, "temperature": 0}}
{"custom_id": "requests#8112fcc7beb15e1cdc66180c10a3290174866828", "method": "POST", "url": "/v1/chat/completions", "body": {"model": "gpt-4o", "messages": [{"role": "user", "content": "You are a senior reviewer.\n\nCommit Summary:\nLines Added: 5 | Lines Deleted: 25 | Files Changed: 6 | Hunks: 25 | Methods Changed: 23 | Complexity Δ (Sum/Max): 0/0 | Churn Δ: 30 | Churn Cumulative: 28350 | Contributors (this commit): 392 | Commits (past 90d): 12 | Contributors (cumulative): 605 | DMM Complexity: None\n\nDIFF:\n@@ -247,7 +247,6 @@ class HTTPAdapter(BaseAdapter):\n         :param cert: The SSL certificate to verify.\n         \"\"\"\n         if url.lower().startswith(\"https\") and verify:\n-\n             cert_loc = None\n \n             # Allow self-specified cert location.\n\n@@ -258,7 +258,6 @@ class HTTPDigestAuth(AuthBase):\n         s_auth = r.headers.get(\"www-authenticate\", \"\")\n \n         if \"digest\" in s_auth.lower() and self._thread_local.num_401_calls < 2:\n-\n             self._thread_local.num_401_calls += 1\n             pat = re.compile(r\"digest \", flags=re.IGNORECASE)\n             self._thread_local.chal = parse_dict_header(pat.sub(\"\", s_auth, count=1))\n\n@@ -170,7 +170,7 @@ class RequestEncodingMixin:\n                         )\n                     )\n \n-        for (k, v) in files:\n+        for k, v in files:\n             # support for explicit filename\n             ft = None\n             fh = None\n@@ -268,7 +268,6 @@ class Request(RequestHooksMixin):\n         hooks=None,\n         json=None,\n     ):\n-\n         # Default empty dicts for dict params.\n         data = [] if data is None else data\n         files = [] if files is None else files\n@@ -277,7 +276,7 @@ class Request(RequestHooksMixin):\n         hooks = {} if hooks is None else hooks\n \n         self.hooks = default_hooks()\n-        for (k, v) in list(hooks.items()):\n+        for k, v in list(hooks.items()):\n             self.register_hook(event=k, hook=v)\n \n         self.method = method\n@@ -865,7 +864,6 @@ class Response:\n         for chunk in self.iter_content(\n             chunk_size=chunk_size, decode_unicode=decode_unicode\n         ):\n-\n             if pending is not None:\n                 chunk = pending + chunk\n \n\n@@ -262,7 +262,6 @@ class SessionRedirectMixin:\n             if yield_requests:\n                 yield req\n             else:\n-\n                 resp = self.send(\n                     req,\n                     stream=stream,\n@@ -389,7 +388,6 @@ class Session(SessionRedirectMixin):\n     ]\n \n     def __init__(self):\n-\n         #: A case-insensitive dictionary of headers to be sent on each\n         #: :class:`Request <Request>` sent from this\n         #: :class:`Session <Session>`.\n@@ -713,7 +711,6 @@ class Session(SessionRedirectMixin):\n \n         # Persist cookies\n         if r.history:\n-\n             # If the hooks create history then we want those cookies too\n             for resp in r.history:\n                 extract_cookies_to_jar(self.cookies, resp.request, resp.raw)\n@@ -761,7 +758,7 @@ class Session(SessionRedirectMixin):\n             # Set environment's proxies.\n             no_proxy = proxies.get(\"no_proxy\") if proxies is not None else None\n             env_proxies = get_environ_proxies(url, no_proxy=no_proxy)\n-            for (k, v) in env_proxies.items():\n+            for k, v in env_proxies.items():\n                 proxies.setdefault(k, v)\n \n             # Look for requests environment configuration\n@@ -787,8 +784,7 @@ class Session(SessionRedirectMixin):\n \n         :rtype: requests.adapters.BaseAdapter\n         \"\"\"\n-        for (prefix, adapter) in self.adapters.items():\n-\n+        for prefix, adapter in self.adapters.items():\n             if url.lower().startswith(prefix.lower()):\n                 return adapter\n \n\n@@ -763,6 +763,7 @@ def should_bypass_proxies(url, no_proxy):\n \n     :rtype: bool\n     \"\"\"\n+\n     # Prioritize lowercase environment variables over uppercase\n     # to keep a consistent behaviour with other http projects (curl, wget).\n     def get_proxy(key):\n\n@@ -75,11 +75,9 @@ except AttributeError:\n \n \n class TestRequests:\n-\n     digest_auth_algo = (\"MD5\", \"SHA-256\", \"SHA-512\")\n \n     def test_entry_points(self):\n-\n         requests.session\n         requests.session().get\n         requests.session().head\n@@ -510,7 +508,6 @@ class TestRequests:\n \n     @pytest.mark.parametrize(\"key\", (\"User-agent\", \"user-agent\"))\n     def test_user_agent_transfers(self, httpbin, key):\n-\n         heads = {key: \"Mozilla/5.0 (github.com/psf/requests)\"}\n \n         r = requests.get(httpbin(\"user-agent\"), headers=heads)\n@@ -704,7 +701,6 @@ class TestRequests:\n             requests.sessions.get_netrc_auth = old_auth\n \n     def test_DIGEST_HTTP_200_OK_GET(self, httpbin):\n-\n         for authtype in self.digest_auth_algo:\n             auth = HTTPDigestAuth(\"user\", \"pass\")\n             url = httpbin(\"digest-auth\", \"auth\", \"user\", \"pass\", authtype, \"never\")\n@@ -722,7 +718,6 @@ class TestRequests:\n             assert r.status_code == 200\n \n     def test_DIGEST_AUTH_RETURNS_COOKIE(self, httpbin):\n-\n         for authtype in self.digest_auth_algo:\n             url = httpbin(\"digest-auth\", \"auth\", \"user\", \"pass\", authtype)\n             auth = HTTPDigestAuth(\"user\", \"pass\")\n@@ -733,7 +728,6 @@ class TestRequests:\n             assert r.status_code == 200\n \n     def test_DIGEST_AUTH_SETS_SESSION_COOKIES(self, httpbin):\n-\n         for authtype in self.digest_auth_algo:\n             url = httpbin(\"digest-auth\", \"auth\", \"user\", \"pass\", authtype)\n             auth = HTTPDigestAuth(\"user\", \"pass\")\n@@ -742,7 +736,6 @@ class TestRequests:\n             assert s.cookies[\"fake\"] == \"fake_value\"\n \n     def test_DIGEST_STREAM(self, httpbin):\n-\n         for authtype in self.digest_auth_algo:\n             auth = HTTPDigestAuth(\"user\", \"pass\")\n             url = httpbin(\"digest-auth\", \"auth\", \"user\", \"pass\", authtype)\n@@ -754,7 +747,6 @@ class TestRequests:\n             assert r.raw.read() == b\"\"\n \n     def test_DIGESTAUTH_WRONG_HTTP_401_GET(self, httpbin):\n-\n         for authtype in self.digest_auth_algo:\n             auth = HTTPDigestAuth(\"user\", \"wrongpass\")\n             url = httpbin(\"digest-auth\", \"auth\", \"user\", \"pass\", authtype)\n@@ -771,7 +763,6 @@ class TestRequests:\n             assert r.status_code == 401\n \n     def test_DIGESTAUTH_QUOTES_QOP_VALUE(self, httpbin):\n-\n         for authtype in self.digest_auth_algo:\n             auth = HTTPDigestAuth(\"user\", \"pass\")\n             url = httpbin(\"digest-auth\", \"auth\", \"user\", \"pass\", authtype)\n@@ -780,7 +771,6 @@ class TestRequests:\n             assert '\"auth\"' in r.request.headers[\"Authorization\"]\n \n     def test_POSTBIN_GET_POST_FILES(self, httpbin):\n-\n         url = httpbin(\"post\")\n         requests.post(url).raise_for_status()\n \n@@ -798,7 +788,6 @@ class TestRequests:\n             requests.post(url, files=[\"bad file data\"])\n \n     def test_invalid_files_input(self, httpbin):\n-\n         url = httpbin(\"post\")\n         post = requests.post(url, files={\"random-file-1\": None, \"random-file-2\": 1})\n         assert b'name=\"random-file-1\"' not in post.request.body\n@@ -846,7 +835,6 @@ class TestRequests:\n         assert post2.json()[\"data\"] == \"st\"\n \n     def test_POSTBIN_GET_POST_FILES_WITH_DATA(self, httpbin):\n-\n         url = httpbin(\"post\")\n         requests.post(url).raise_for_status()\n \n@@ -1035,7 +1023,6 @@ class TestRequests:\n             requests.get(httpbin_secure(\"status\", \"200\"))\n \n     def test_urlencoded_get_query_multivalued_param(self, httpbin):\n-\n         r = requests.get(httpbin(\"get\"), params={\"test\": [\"foo\", \"baz\"]})\n         assert r.status_code == 200\n         assert r.url == httpbin(\"get?test=foo&test=baz\")\n\n\nQuestion: Does this commit introduce technical debt? Answer yes or no."}], "max_tokens": 1, "temperature": 0}}
{"custom_id": "requests#e9fa2e2da3076e4f55f18b3f4a169c7b3916b272", "method": "POST", "url": "/v1/chat/completions", "body": {"model": "gpt-4o", "messages": [{"role": "user", "content": "You are a senior reviewer.\n\nCommit Summary:\nLines Added: 1 | Lines Deleted: 0 | Files Changed: 1 | Hunks: 1 | Methods Changed: 0 | Complexity Δ (Sum/Max): 0/0 | Churn Δ: 1 | Churn Cumulative: 922 | Contributors (this commit): 45 | Commits (past 90d): 1 | Contributors (cumulative): 45 | DMM Complexity: None\n\nDIFF:\n@@ -112,6 +112,7 @@ setup(\n         \"Programming Language :: Python :: 3.9\",\n         \"Programming Language :: Python :: 3.10\",\n         \"Programming Language :: Python :: 3.11\",\n+        \"Programming Language :: Python :: 3.12\",\n         \"Programming Language :: Python :: 3 :: Only\",\n         \"Programming Language :: Python :: Implementation :: CPython\",\n         \"Programming Language :: Python :: Implementation :: PyPy\",\n\n\nQuestion: Does this commit introduce technical debt? Answer yes or no."}], "max_tokens": 1, "temperature": 0}}
{"custom_id": "requests#d63e94f552ebf77ccf45d97e5863ac46500fa2c7", "method": "POST", "url": "/v1/chat/completions", "body": {"model": "gpt-4o", "messages": [{"role": "user", "content": "You are a senior reviewer.\n\nCommit Summary:\nLines Added: 2 | Lines Deleted: 2 | Files Changed: 19 | Hunks: 2 | Methods Changed: 0 | Complexity Δ (Sum/Max): 0/0 | Churn Δ: 4 | Churn Cumulative: 926 | Contributors (this commit): 45 | Commits (past 90d): 20 | Contributors (cumulative): 63 | DMM Complexity: None\n\nDIFF:\n@@ -75,7 +75,7 @@ test_requirements = [\n \n about = {}\n here = os.path.abspath(os.path.dirname(__file__))\n-with open(os.path.join(here, \"requests\", \"__version__.py\"), \"r\", \"utf-8\") as f:\n+with open(os.path.join(here, \"src\", \"requests\", \"__version__.py\"), \"r\", \"utf-8\") as f:\n     exec(f.read(), about)\n \n with open(\"README.md\", \"r\", \"utf-8\") as f:\n@@ -92,7 +92,7 @@ setup(\n     url=about[\"__url__\"],\n     packages=[\"requests\"],\n     package_data={\"\": [\"LICENSE\", \"NOTICE\"]},\n-    package_dir={\"requests\": \"requests\"},\n+    package_dir={\"\": \"src\"},\n     include_package_data=True,\n     python_requires=\">=3.7\",\n     install_requires=requires,\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nQuestion: Does this commit introduce technical debt? Answer yes or no."}], "max_tokens": 1, "temperature": 0}}
{"custom_id": "requests#005571d1180835eb5266a3fdbdbe8fdae57d90c2", "method": "POST", "url": "/v1/chat/completions", "body": {"model": "gpt-4o", "messages": [{"role": "user", "content": "You are a senior reviewer.\n\nCommit Summary:\nLines Added: 18 | Lines Deleted: 16 | Files Changed: 3 | Hunks: 16 | Methods Changed: 12 | Complexity Δ (Sum/Max): 0/0 | Churn Δ: 34 | Churn Cumulative: 9572 | Contributors (this commit): 106 | Commits (past 90d): 6 | Contributors (cumulative): 121 | DMM Complexity: 0.0\n\nDIFF:\n@@ -1,3 +1,5 @@\n+from unittest import mock\n+\n from requests.help import info\n \n \n@@ -11,15 +13,15 @@ class VersionedPackage:\n         self.__version__ = version\n \n \n-def test_idna_without_version_attribute(mocker):\n+def test_idna_without_version_attribute():\n     \"\"\"Older versions of IDNA don't provide a __version__ attribute, verify\n     that if we have such a package, we don't blow up.\n     \"\"\"\n-    mocker.patch(\"requests.help.idna\", new=None)\n+    with mock.patch(\"requests.help.idna\", new=None):\n         assert info()[\"idna\"] == {\"version\": \"\"}\n \n \n-def test_idna_with_version_attribute(mocker):\n+def test_idna_with_version_attribute():\n     \"\"\"Verify we're actually setting idna version when it should be available.\"\"\"\n-    mocker.patch(\"requests.help.idna\", new=VersionedPackage(\"2.6\"))\n+    with mock.patch(\"requests.help.idna\", new=VersionedPackage(\"2.6\")):\n         assert info()[\"idna\"] == {\"version\": \"2.6\"}\n\n@@ -8,6 +8,7 @@ import os\n import pickle\n import re\n import warnings\n+from unittest import mock\n \n import pytest\n import urllib3\n@@ -972,9 +973,9 @@ class TestRequests:\n             ),\n         ),\n     )\n-    def test_env_cert_bundles(self, httpbin, mocker, env, expected):\n+    def test_env_cert_bundles(self, httpbin, env, expected):\n         s = requests.Session()\n-        mocker.patch(\"os.environ\", env)\n+        with mock.patch(\"os.environ\", env):\n             settings = s.merge_environment_settings(\n                 url=httpbin(\"get\"), proxies={}, stream=False, verify=True, cert=None\n             )\n@@ -1464,11 +1465,9 @@ class TestRequests:\n             (urllib3.exceptions.SSLError, tuple(), RequestsSSLError),\n         ),\n     )\n-    def test_iter_content_wraps_exceptions(\n-        self, httpbin, mocker, exception, args, expected\n-    ):\n+    def test_iter_content_wraps_exceptions(self, httpbin, exception, args, expected):\n         r = requests.Response()\n-        r.raw = mocker.Mock()\n+        r.raw = mock.Mock()\n         # ReadTimeoutError can't be initialized by mock\n         # so we'll manually create the instance with args\n         r.raw.stream.side_effect = exception(*args)\n@@ -2093,13 +2092,13 @@ class TestRequests:\n         next(r.iter_lines())\n         assert len(list(r.iter_lines())) == 3\n \n-    def test_session_close_proxy_clear(self, mocker):\n+    def test_session_close_proxy_clear(self):\n         proxies = {\n-            \"one\": mocker.Mock(),\n-            \"two\": mocker.Mock(),\n+            \"one\": mock.Mock(),\n+            \"two\": mock.Mock(),\n         }\n         session = requests.Session()\n-        mocker.patch.dict(session.adapters[\"http://\"].proxy_manager, proxies)\n+        with mock.patch.dict(session.adapters[\"http://\"].proxy_manager, proxies):\n             session.close()\n             proxies[\"one\"].clear.assert_called_once_with()\n             proxies[\"two\"].clear.assert_called_once_with()\n\n@@ -5,6 +5,7 @@ import tarfile\n import zipfile\n from collections import deque\n from io import BytesIO\n+from unittest import mock\n \n import pytest\n \n@@ -751,11 +752,11 @@ def test_should_bypass_proxies(url, expected, monkeypatch):\n         (\"http://user:pass@hostname:5000\", \"hostname\"),\n     ),\n )\n-def test_should_bypass_proxies_pass_only_hostname(url, expected, mocker):\n+def test_should_bypass_proxies_pass_only_hostname(url, expected):\n     \"\"\"The proxy_bypass function should be called with a hostname or IP without\n     a port number or auth credentials.\n     \"\"\"\n-    proxy_bypass = mocker.patch(\"requests.utils.proxy_bypass\")\n+    with mock.patch(\"requests.utils.proxy_bypass\") as proxy_bypass:\n         should_bypass_proxies(url, no_proxy=None)\n         proxy_bypass.assert_called_once_with(expected)\n \n\n\nQuestion: Does this commit introduce technical debt? Answer yes or no."}], "max_tokens": 1, "temperature": 0}}
{"custom_id": "requests#12862617df7391a87f30d5bc30fffbcfd8fa3761", "method": "POST", "url": "/v1/chat/completions", "body": {"model": "gpt-4o", "messages": [{"role": "user", "content": "You are a senior reviewer.\n\nCommit Summary:\nLines Added: 1 | Lines Deleted: 1 | Files Changed: 1 | Hunks: 1 | Methods Changed: 1 | Complexity Δ (Sum/Max): 190/190 | Churn Δ: 2 | Churn Cumulative: 2 | Contributors (this commit): 2 | Commits (past 90d): 2 | Contributors (cumulative): 2 | DMM Complexity: None\n\nDIFF:\n@@ -940,7 +940,7 @@ class Response:\n         return content\n \n     def json(self, **kwargs):\n-        r\"\"\"Returns the json-encoded content of a response, if any.\n+        r\"\"\"Returns the json-decoded dict of a response, if any.\n \n         :param \\*\\*kwargs: Optional arguments that ``json.loads`` takes.\n         :raises requests.exceptions.JSONDecodeError: If the response body does not\n\n\nQuestion: Does this commit introduce technical debt? Answer yes or no."}], "max_tokens": 1, "temperature": 0}}
{"custom_id": "requests#a8e9c1b436e9a35c271d8b690eefbc0d3d18df0f", "method": "POST", "url": "/v1/chat/completions", "body": {"model": "gpt-4o", "messages": [{"role": "user", "content": "You are a senior reviewer.\n\nCommit Summary:\nLines Added: 1 | Lines Deleted: 1 | Files Changed: 1 | Hunks: 1 | Methods Changed: 1 | Complexity Δ (Sum/Max): 0/0 | Churn Δ: 2 | Churn Cumulative: 7119 | Contributors (this commit): 87 | Commits (past 90d): 3 | Contributors (cumulative): 87 | DMM Complexity: None\n\nDIFF:\n@@ -1702,7 +1702,7 @@ class TestRequests:\n         }\n         r = requests.get(httpbin(\"get\"), headers=valid_headers)\n         for key in valid_headers.keys():\n-            valid_headers[key] == r.request.headers[key]\n+            assert valid_headers[key] == r.request.headers[key]\n \n     @pytest.mark.parametrize(\n         \"invalid_header, key\",\n\n\nQuestion: Does this commit introduce technical debt? Answer yes or no."}], "max_tokens": 1, "temperature": 0}}
{"custom_id": "requests#ad761abcdd2f1b5e4fcba549676b2ea52bd325cd", "method": "POST", "url": "/v1/chat/completions", "body": {"model": "gpt-4o", "messages": [{"role": "user", "content": "You are a senior reviewer.\n\nCommit Summary:\nLines Added: 1 | Lines Deleted: 2 | Files Changed: 1 | Hunks: 1 | Methods Changed: 0 | Complexity Δ (Sum/Max): 0/0 | Churn Δ: 3 | Churn Cumulative: 3 | Contributors (this commit): 2 | Commits (past 90d): 2 | Contributors (cumulative): 2 | DMM Complexity: None\n\nDIFF:\n@@ -23,6 +23,5 @@ for package in (\"urllib3\", \"idna\"):\n target = chardet.__name__\n for mod in list(sys.modules):\n     if mod == target or mod.startswith(f\"{target}.\"):\n-        target = target.replace(target, \"chardet\")\n-        sys.modules[f\"requests.packages.{target}\"] = sys.modules[mod]\n+        sys.modules[f\"requests.packages.{mod}\"] = sys.modules[mod]\n # Kinda cool, though, right?\n\\ No newline at end of file\n\n\nQuestion: Does this commit introduce technical debt? Answer yes or no."}], "max_tokens": 1, "temperature": 0}}
{"custom_id": "requests#e9b1217cff710307e5de9fb8ce2fc21eb79acec3", "method": "POST", "url": "/v1/chat/completions", "body": {"model": "gpt-4o", "messages": [{"role": "user", "content": "You are a senior reviewer.\n\nCommit Summary:\nLines Added: 2 | Lines Deleted: 0 | Files Changed: 1 | Hunks: 1 | Methods Changed: 0 | Complexity Δ (Sum/Max): 0/0 | Churn Δ: 2 | Churn Cumulative: 5 | Contributors (this commit): 2 | Commits (past 90d): 3 | Contributors (cumulative): 2 | DMM Complexity: None\n\nDIFF:\n@@ -24,4 +24,6 @@ target = chardet.__name__\n for mod in list(sys.modules):\n     if mod == target or mod.startswith(f\"{target}.\"):\n         sys.modules[f\"requests.packages.{mod}\"] = sys.modules[mod]\n+        target = target.replace(target, \"chardet\")\n+        sys.modules[f\"requests.packages.{target}\"] = sys.modules[mod]\n # Kinda cool, though, right?\n\\ No newline at end of file\n\n\nQuestion: Does this commit introduce technical debt? Answer yes or no."}], "max_tokens": 1, "temperature": 0}}
{"custom_id": "requests#d7490c9d2dc967f68c6ca38b73aa099bc888a04e", "method": "POST", "url": "/v1/chat/completions", "body": {"model": "gpt-4o", "messages": [{"role": "user", "content": "You are a senior reviewer.\n\nCommit Summary:\nLines Added: 4 | Lines Deleted: 3 | Files Changed: 1 | Hunks: 1 | Methods Changed: 0 | Complexity Δ (Sum/Max): 0/0 | Churn Δ: 7 | Churn Cumulative: 12 | Contributors (this commit): 3 | Commits (past 90d): 4 | Contributors (cumulative): 3 | DMM Complexity: None\n\nDIFF:\n@@ -23,7 +23,8 @@ for package in (\"urllib3\", \"idna\"):\n target = chardet.__name__\n for mod in list(sys.modules):\n     if mod == target or mod.startswith(f\"{target}.\"):\n-        sys.modules[f\"requests.packages.{mod}\"] = sys.modules[mod]\n-        target = target.replace(target, \"chardet\")\n-        sys.modules[f\"requests.packages.{target}\"] = sys.modules[mod]\n+        imported_mod = sys.modules[mod]\n+        sys.modules[f\"requests.packages.{mod}\"] = imported_mod\n+        mod = mod.replace(target, \"chardet\")\n+        sys.modules[f\"requests.packages.{mod}\"] = imported_mod\n # Kinda cool, though, right?\n\\ No newline at end of file\n\n\nQuestion: Does this commit introduce technical debt? Answer yes or no."}], "max_tokens": 1, "temperature": 0}}
{"custom_id": "requests#15849947ec4b8b7c3c136a47e950499edfd36921", "method": "POST", "url": "/v1/chat/completions", "body": {"model": "gpt-4o", "messages": [{"role": "user", "content": "You are a senior reviewer.\n\nCommit Summary:\nLines Added: 1 | Lines Deleted: 1 | Files Changed: 1 | Hunks: 1 | Methods Changed: 1 | Complexity Δ (Sum/Max): 192/192 | Churn Δ: 2 | Churn Cumulative: 2 | Contributors (this commit): 2 | Commits (past 90d): 1 | Contributors (cumulative): 2 | DMM Complexity: None\n\nDIFF:\n@@ -859,7 +859,7 @@ def select_proxy(url, proxies):\n def resolve_proxies(request, proxies, trust_env=True):\n     \"\"\"This method takes proxy information from a request and configuration\n     input to resolve a mapping of target proxies. This will consider settings\n-    such a NO_PROXY to strip proxy configurations.\n+    such as NO_PROXY to strip proxy configurations.\n \n     :param request: Request or PreparedRequest\n     :param proxies: A dictionary of schemes or schemes and hosts to proxy URLs\n\n\nQuestion: Does this commit introduce technical debt? Answer yes or no."}], "max_tokens": 1, "temperature": 0}}
{"custom_id": "requests#f6707042d8b18d2a3737380bf58ff020872fb07b", "method": "POST", "url": "/v1/chat/completions", "body": {"model": "gpt-4o", "messages": [{"role": "user", "content": "You are a senior reviewer.\n\nCommit Summary:\nLines Added: 17 | Lines Deleted: 0 | Files Changed: 1 | Hunks: 1 | Methods Changed: 2 | Complexity Δ (Sum/Max): 2/2 | Churn Δ: 17 | Churn Cumulative: 7136 | Contributors (this commit): 88 | Commits (past 90d): 2 | Contributors (cumulative): 88 | DMM Complexity: 1.0\n\nDIFF:\n@@ -1808,6 +1808,23 @@ class TestRequests:\n \n         assert p.headers[\"Content-Length\"] == length\n \n+    def test_content_length_for_bytes_data(self, httpbin):\n+        data = \"This is a string containing multi-byte UTF-8 ☃️\"\n+        encoded_data = data.encode(\"utf-8\")\n+        length = str(len(encoded_data))\n+        req = requests.Request(\"POST\", httpbin(\"post\"), data=encoded_data)\n+        p = req.prepare()\n+\n+        assert p.headers[\"Content-Length\"] == length\n+\n+    def test_content_length_for_string_data_counts_bytes(self, httpbin):\n+        data = \"This is a string containing multi-byte UTF-8 ☃️\"\n+        length = str(len(data.encode(\"utf-8\")))\n+        req = requests.Request(\"POST\", httpbin(\"post\"), data=data)\n+        p = req.prepare()\n+\n+        assert p.headers[\"Content-Length\"] == length\n+\n     def test_nonhttp_schemes_dont_check_URLs(self):\n         test_urls = (\n             \"data:image/gif;base64,R0lGODlhAQABAHAAACH5BAUAAAAALAAAAAABAAEAAAICRAEAOw==\",\n\n\nQuestion: Does this commit introduce technical debt? Answer yes or no."}], "max_tokens": 1, "temperature": 0}}
{"custom_id": "requests#b37878d3407995e41fd3c160fd04d5d0afda1130", "method": "POST", "url": "/v1/chat/completions", "body": {"model": "gpt-4o", "messages": [{"role": "user", "content": "You are a senior reviewer.\n\nCommit Summary:\nLines Added: 1 | Lines Deleted: 1 | Files Changed: 1 | Hunks: 1 | Methods Changed: 0 | Complexity Δ (Sum/Max): 8/8 | Churn Δ: 2 | Churn Cumulative: 2 | Contributors (this commit): 2 | Commits (past 90d): 1 | Contributors (cumulative): 2 | DMM Complexity: None\n\nDIFF:\n@@ -79,7 +79,7 @@ _codes = {\n     422: (\"unprocessable_entity\", \"unprocessable\"),\n     423: (\"locked\",),\n     424: (\"failed_dependency\", \"dependency\"),\n-    425: (\"unordered_collection\", \"unordered\"),\n+    425: (\"unordered_collection\", \"unordered\", \"too_early\"),\n     426: (\"upgrade_required\", \"upgrade\"),\n     428: (\"precondition_required\", \"precondition\"),\n     429: (\"too_many_requests\", \"too_many\"),\n\n\nQuestion: Does this commit introduce technical debt? Answer yes or no."}], "max_tokens": 1, "temperature": 0}}
{"custom_id": "requests#889910c77a9618dc59dd800c17913e2b1644cee3", "method": "POST", "url": "/v1/chat/completions", "body": {"model": "gpt-4o", "messages": [{"role": "user", "content": "You are a senior reviewer.\n\nCommit Summary:\nLines Added: 13 | Lines Deleted: 0 | Files Changed: 1 | Hunks: 1 | Methods Changed: 1 | Complexity Δ (Sum/Max): -1/0 | Churn Δ: 13 | Churn Cumulative: 7149 | Contributors (this commit): 89 | Commits (past 90d): 3 | Contributors (cumulative): 89 | DMM Complexity: 1.0\n\nDIFF:\n@@ -2795,3 +2795,16 @@ class TestPreparingURLs:\n         with pytest.raises(requests.exceptions.JSONDecodeError) as excinfo:\n             r.json()\n         assert excinfo.value.doc == r.text\n+\n+    def test_status_code_425(self):\n+        r1 = requests.codes.get(\"TOO_EARLY\")\n+        r2 = requests.codes.get(\"too_early\")\n+        r3 = requests.codes.get(\"UNORDERED\")\n+        r4 = requests.codes.get(\"unordered\")\n+        r5 = requests.codes.get(\"UNORDERED_COLLECTION\")\n+        r6 = requests.codes.get(\"unordered_collection\")\n+\n+        assert r1 == 425\n+        assert r2 == 425\n+        assert r3 == 425\n+        assert r4 == 425\n\n\nQuestion: Does this commit introduce technical debt? Answer yes or no."}], "max_tokens": 1, "temperature": 0}}
{"custom_id": "requests#ec84f2c539d952499e0207849dfd3f73e2c11324", "method": "POST", "url": "/v1/chat/completions", "body": {"model": "gpt-4o", "messages": [{"role": "user", "content": "You are a senior reviewer.\n\nCommit Summary:\nLines Added: 2 | Lines Deleted: 0 | Files Changed: 1 | Hunks: 1 | Methods Changed: 1 | Complexity Δ (Sum/Max): 0/0 | Churn Δ: 2 | Churn Cumulative: 7151 | Contributors (this commit): 89 | Commits (past 90d): 4 | Contributors (cumulative): 89 | DMM Complexity: 1.0\n\nDIFF:\n@@ -2808,3 +2808,5 @@ class TestPreparingURLs:\n         assert r2 == 425\n         assert r3 == 425\n         assert r4 == 425\n+        assert r5 == 425\n+        assert r6 == 425\n\n\nQuestion: Does this commit introduce technical debt? Answer yes or no."}], "max_tokens": 1, "temperature": 0}}
{"custom_id": "requests#3fd309a5c14e4cfbd96bea6c8e71b4958fe090bb", "method": "POST", "url": "/v1/chat/completions", "body": {"model": "gpt-4o", "messages": [{"role": "user", "content": "You are a senior reviewer.\n\nCommit Summary:\nLines Added: 3 | Lines Deleted: 0 | Files Changed: 1 | Hunks: 1 | Methods Changed: 1 | Complexity Δ (Sum/Max): 1/1 | Churn Δ: 3 | Churn Cumulative: 5 | Contributors (this commit): 3 | Commits (past 90d): 2 | Contributors (cumulative): 3 | DMM Complexity: 0.0\n\nDIFF:\n@@ -134,6 +134,9 @@ def super_len(o):\n     total_length = None\n     current_position = 0\n \n+    if isinstance(o, str):\n+        o = o.encode(\"utf-8\")\n+\n     if hasattr(o, \"__len__\"):\n         total_length = len(o)\n \n\n\nQuestion: Does this commit introduce technical debt? Answer yes or no."}], "max_tokens": 1, "temperature": 0}}
{"custom_id": "requests#3ff3ff21dd45957c9e143cd500291959bb15f690", "method": "POST", "url": "/v1/chat/completions", "body": {"model": "gpt-4o", "messages": [{"role": "user", "content": "You are a senior reviewer.\n\nCommit Summary:\nLines Added: 20 | Lines Deleted: 0 | Files Changed: 2 | Hunks: 2 | Methods Changed: 2 | Complexity Δ (Sum/Max): 7/6 | Churn Δ: 20 | Churn Cumulative: 7171 | Contributors (this commit): 90 | Commits (past 90d): 5 | Contributors (cumulative): 92 | DMM Complexity: 1.0\n\nDIFF:\n@@ -41,6 +41,16 @@ class JSONDecodeError(InvalidJSONError, CompatJSONDecodeError):\n         CompatJSONDecodeError.__init__(self, *args)\n         InvalidJSONError.__init__(self, *self.args, **kwargs)\n \n+    def __reduce__(self):\n+        \"\"\"\n+        The __reduce__ method called when pickling the object must\n+        be the one from the JSONDecodeError (be it json/simplejson)\n+        as it expects all the arguments for instantiation, not just\n+        one like the IOError, and the MRO would by default call the\n+        __reduce__ method from the IOError due to the inheritance order.\n+        \"\"\"\n+        return CompatJSONDecodeError.__reduce__(self)\n+\n \n class HTTPError(RequestException):\n     \"\"\"An HTTP error occurred.\"\"\"\n\n@@ -2810,3 +2810,13 @@ class TestPreparingURLs:\n         assert r4 == 425\n         assert r5 == 425\n         assert r6 == 425\n+\n+\n+def test_json_decode_errors_are_serializable_deserializable():\n+    json_decode_error = requests.exceptions.JSONDecodeError(\n+        \"Extra data\",\n+        '{\"responseCode\":[\"706\"],\"data\":null}{\"responseCode\":[\"706\"],\"data\":null}',\n+        36,\n+    )\n+    deserialized_error = pickle.loads(pickle.dumps(json_decode_error))\n+    assert repr(json_decode_error) == repr(deserialized_error)\n\n\nQuestion: Does this commit introduce technical debt? Answer yes or no."}], "max_tokens": 1, "temperature": 0}}
{"custom_id": "requests#58cea7a7282999adafdc19a4e82e2d09207ab568", "method": "POST", "url": "/v1/chat/completions", "body": {"model": "gpt-4o", "messages": [{"role": "user", "content": "You are a senior reviewer.\n\nCommit Summary:\nLines Added: 3 | Lines Deleted: 4 | Files Changed: 1 | Hunks: 4 | Methods Changed: 0 | Complexity Δ (Sum/Max): 0/0 | Churn Δ: 7 | Churn Cumulative: 933 | Contributors (this commit): 45 | Commits (past 90d): 1 | Contributors (cumulative): 45 | DMM Complexity: None\n\nDIFF:\n@@ -7,7 +7,7 @@ from setuptools import setup\n from setuptools.command.test import test as TestCommand\n \n CURRENT_PYTHON = sys.version_info[:2]\n-REQUIRED_PYTHON = (3, 7)\n+REQUIRED_PYTHON = (3, 8)\n \n if CURRENT_PYTHON < REQUIRED_PYTHON:\n     sys.stderr.write(\n@@ -20,7 +20,7 @@ you're trying to install it on Python {}.{}. To resolve this,\n consider upgrading to a supported Python version.\n \n If you can't upgrade your Python version, you'll need to\n-pin to an older version of Requests (<2.28).\n+pin to an older version of Requests (<2.32.0).\n \"\"\".format(\n             *(REQUIRED_PYTHON + CURRENT_PYTHON)\n         )\n@@ -94,7 +94,7 @@ setup(\n     package_data={\"\": [\"LICENSE\", \"NOTICE\"]},\n     package_dir={\"\": \"src\"},\n     include_package_data=True,\n-    python_requires=\">=3.7\",\n+    python_requires=\">=3.8\",\n     install_requires=requires,\n     license=about[\"__license__\"],\n     zip_safe=False,\n@@ -107,7 +107,6 @@ setup(\n         \"Operating System :: OS Independent\",\n         \"Programming Language :: Python\",\n         \"Programming Language :: Python :: 3\",\n-        \"Programming Language :: Python :: 3.7\",\n         \"Programming Language :: Python :: 3.8\",\n         \"Programming Language :: Python :: 3.9\",\n         \"Programming Language :: Python :: 3.10\",\n\n\nQuestion: Does this commit introduce technical debt? Answer yes or no."}], "max_tokens": 1, "temperature": 0}}
{"custom_id": "requests#60389df6d69ce833164696dcf36cbb43336d3426", "method": "POST", "url": "/v1/chat/completions", "body": {"model": "gpt-4o", "messages": [{"role": "user", "content": "You are a senior reviewer.\n\nCommit Summary:\nLines Added: 11 | Lines Deleted: 0 | Files Changed: 2 | Hunks: 2 | Methods Changed: 2 | Complexity Δ (Sum/Max): 64/63 | Churn Δ: 11 | Churn Cumulative: 11 | Contributors (this commit): 2 | Commits (past 90d): 2 | Contributors (cumulative): 3 | DMM Complexity: 0.0\n\nDIFF:\n@@ -390,6 +390,9 @@ class HTTPAdapter(BaseAdapter):\n             using_socks_proxy = proxy_scheme.startswith(\"socks\")\n \n         url = request.path_url\n+        if url.startswith(\"//\"):  # Don't confuse urllib3\n+            url = f\"/{url.lstrip('/')}\"\n+\n         if is_proxied_http_request and not using_socks_proxy:\n             url = urldefragauth(request.url)\n \n\n@@ -0,0 +1,8 @@\n+import requests.adapters\n+\n+\n+def test_request_url_trims_leading_path_separators():\n+    \"\"\"See also https://github.com/psf/requests/issues/6643.\"\"\"\n+    a = requests.adapters.HTTPAdapter()\n+    p = requests.Request(method=\"GET\", url=\"http://127.0.0.1:10000//v:h\").prepare()\n+    assert \"/v:h\" == a.request_url(p, {})\n\n\nQuestion: Does this commit introduce technical debt? Answer yes or no."}], "max_tokens": 1, "temperature": 0}}
{"custom_id": "requests#c0813a2d910ea6b4f8438b91d315b8d181302356", "method": "POST", "url": "/v1/chat/completions", "body": {"model": "gpt-4o", "messages": [{"role": "user", "content": "You are a senior reviewer.\n\nCommit Summary:\nLines Added: 64 | Lines Deleted: 1 | Files Changed: 2 | Hunks: 6 | Methods Changed: 4 | Complexity Δ (Sum/Max): 10/7 | Churn Δ: 65 | Churn Cumulative: 7229 | Contributors (this commit): 90 | Commits (past 90d): 4 | Contributors (cumulative): 92 | DMM Complexity: 1.0\n\nDIFF:\n@@ -8,6 +8,7 @@ and maintain connections.\n \n import os.path\n import socket  # noqa: F401\n+import typing\n \n from urllib3.exceptions import ClosedPoolError, ConnectTimeoutError\n from urllib3.exceptions import HTTPError as _HTTPError\n@@ -61,12 +62,38 @@ except ImportError:\n         raise InvalidSchema(\"Missing dependencies for SOCKS support.\")\n \n \n+if typing.TYPE_CHECKING:\n+    from .models import PreparedRequest\n+\n+\n DEFAULT_POOLBLOCK = False\n DEFAULT_POOLSIZE = 10\n DEFAULT_RETRIES = 0\n DEFAULT_POOL_TIMEOUT = None\n \n \n+def _urllib3_request_context(\n+    request: \"PreparedRequest\", verify: \"bool | str | None\"\n+) -> \"(typing.Dict[str, typing.Any], typing.Dict[str, typing.Any])\":\n+    host_params = {}\n+    pool_kwargs = {}\n+    parsed_request_url = urlparse(request.url)\n+    scheme = parsed_request_url.scheme.lower()\n+    port = parsed_request_url.port\n+    cert_reqs = \"CERT_REQUIRED\"\n+    if verify is False:\n+        cert_reqs = \"CERT_NONE\"\n+    if isinstance(verify, str):\n+        pool_kwargs[\"ca_certs\"] = verify\n+    pool_kwargs[\"cert_reqs\"] = cert_reqs\n+    host_params = {\n+        \"scheme\": scheme,\n+        \"host\": parsed_request_url.hostname,\n+        \"port\": port,\n+    }\n+    return host_params, pool_kwargs\n+\n+\n class BaseAdapter:\n     \"\"\"The Base Transport Adapter\"\"\"\n \n@@ -327,6 +354,35 @@ class HTTPAdapter(BaseAdapter):\n \n         return response\n \n+    def _get_connection(self, request, verify, proxies=None):\n+        # Replace the existing get_connection without breaking things and\n+        # ensure that TLS settings are considered when we interact with\n+        # urllib3 HTTP Pools\n+        proxy = select_proxy(request.url, proxies)\n+        try:\n+            host_params, pool_kwargs = _urllib3_request_context(request, verify)\n+        except ValueError as e:\n+            raise InvalidURL(e, request=request)\n+        if proxy:\n+            proxy = prepend_scheme_if_needed(proxy, \"http\")\n+            proxy_url = parse_url(proxy)\n+            if not proxy_url.host:\n+                raise InvalidProxyURL(\n+                    \"Please check proxy URL. It is malformed \"\n+                    \"and could be missing the host.\"\n+                )\n+            proxy_manager = self.proxy_manager_for(proxy)\n+            conn = proxy_manager.connection_from_host(\n+                **host_params, pool_kwargs=pool_kwargs\n+            )\n+        else:\n+            # Only scheme should be lower case\n+            conn = self.poolmanager.connection_from_host(\n+                **host_params, pool_kwargs=pool_kwargs\n+            )\n+\n+        return conn\n+\n     def get_connection(self, url, proxies=None):\n         \"\"\"Returns a urllib3 connection for the given URL. This should not be\n         called from user code, and is only exposed for use when subclassing the\n@@ -453,7 +509,7 @@ class HTTPAdapter(BaseAdapter):\n         \"\"\"\n \n         try:\n-            conn = self.get_connection(request.url, proxies)\n+            conn = self._get_connection(request, verify, proxies)\n         except LocationValueError as e:\n             raise InvalidURL(e, request=request)\n \n\n@@ -2828,6 +2828,13 @@ class TestPreparingURLs:\n         assert r5 == 425\n         assert r6 == 425\n \n+    def test_different_connection_pool_for_tls_settings(self):\n+        s = requests.Session()\n+        r1 = s.get(\"https://invalid.badssl.com\", verify=False)\n+        assert r1.status_code == 421\n+        with pytest.raises(requests.exceptions.SSLError):\n+            s.get(\"https://invalid.badssl.com\")\n+\n \n def test_json_decode_errors_are_serializable_deserializable():\n     json_decode_error = requests.exceptions.JSONDecodeError(\n\n\nQuestion: Does this commit introduce technical debt? Answer yes or no."}], "max_tokens": 1, "temperature": 0}}
{"custom_id": "requests#a94e9b5308ffcc3d2913ab873e9810a6601a67da", "method": "POST", "url": "/v1/chat/completions", "body": {"model": "gpt-4o", "messages": [{"role": "user", "content": "You are a senior reviewer.\n\nCommit Summary:\nLines Added: 190 | Lines Deleted: 8 | Files Changed: 3 | Hunks: 12 | Methods Changed: 16 | Complexity Δ (Sum/Max): 13/7 | Churn Δ: 198 | Churn Cumulative: 7651 | Contributors (this commit): 95 | Commits (past 90d): 7 | Contributors (cumulative): 102 | DMM Complexity: 0.8181818181818182\n\nDIFF:\n@@ -73,7 +73,9 @@ DEFAULT_POOL_TIMEOUT = None\n \n \n def _urllib3_request_context(\n-    request: \"PreparedRequest\", verify: \"bool | str | None\"\n+    request: \"PreparedRequest\",\n+    verify: \"bool | str | None\",\n+    client_cert: \"typing.Tuple[str, str] | str | None\",\n ) -> \"(typing.Dict[str, typing.Any], typing.Dict[str, typing.Any])\":\n     host_params = {}\n     pool_kwargs = {}\n@@ -86,6 +88,14 @@ def _urllib3_request_context(\n     if isinstance(verify, str):\n         pool_kwargs[\"ca_certs\"] = verify\n     pool_kwargs[\"cert_reqs\"] = cert_reqs\n+    if client_cert is not None:\n+        if isinstance(client_cert, tuple) and len(client_cert) == 2:\n+            pool_kwargs[\"cert_file\"] = client_cert[0]\n+            pool_kwargs[\"key_file\"] = client_cert[1]\n+        else:\n+            # According to our docs, we allow users to specify just the client\n+            # cert path\n+            pool_kwargs[\"cert_file\"] = client_cert\n     host_params = {\n         \"scheme\": scheme,\n         \"host\": parsed_request_url.hostname,\n@@ -354,13 +364,13 @@ class HTTPAdapter(BaseAdapter):\n \n         return response\n \n-    def _get_connection(self, request, verify, proxies=None):\n+    def _get_connection(self, request, verify, proxies=None, cert=None):\n         # Replace the existing get_connection without breaking things and\n         # ensure that TLS settings are considered when we interact with\n         # urllib3 HTTP Pools\n         proxy = select_proxy(request.url, proxies)\n         try:\n-            host_params, pool_kwargs = _urllib3_request_context(request, verify)\n+            host_params, pool_kwargs = _urllib3_request_context(request, verify, cert)\n         except ValueError as e:\n             raise InvalidURL(e, request=request)\n         if proxy:\n@@ -509,7 +519,7 @@ class HTTPAdapter(BaseAdapter):\n         \"\"\"\n \n         try:\n-            conn = self._get_connection(request, verify, proxies)\n+            conn = self._get_connection(request, verify, proxies=proxies, cert=cert)\n         except LocationValueError as e:\n             raise InvalidURL(e, request=request)\n \n\n@@ -7,6 +7,7 @@ import json\n import os\n import pickle\n import re\n+import threading\n import warnings\n from unittest import mock\n \n@@ -51,6 +52,7 @@ from requests.structures import CaseInsensitiveDict\n \n from . import SNIMissingWarning\n from .compat import StringIO\n+from .testserver.server import TLSServer, consume_socket_content\n from .utils import override_environ\n \n # Requests to this URL should always fail with a connection timeout (nothing\n@@ -2828,12 +2830,140 @@ class TestPreparingURLs:\n         assert r5 == 425\n         assert r6 == 425\n \n-    def test_different_connection_pool_for_tls_settings(self):\n+    def test_different_connection_pool_for_tls_settings_verify_True(self):\n+        def response_handler(sock):\n+            consume_socket_content(sock, timeout=0.5)\n+            sock.send(\n+                b\"HTTP/1.1 200 OK\\r\\n\"\n+                b\"Content-Length: 18\\r\\n\\r\\n\"\n+                b'\\xff\\xfe{\\x00\"\\x00K0\"\\x00=\\x00\"\\x00\\xab0\"\\x00\\r\\n'\n+            )\n+\n         s = requests.Session()\n-        r1 = s.get(\"https://invalid.badssl.com\", verify=False)\n-        assert r1.status_code == 421\n+        close_server = threading.Event()\n+        server = TLSServer(\n+            handler=response_handler,\n+            wait_to_close_event=close_server,\n+            requests_to_handle=3,\n+            cert_chain=\"tests/certs/expired/server/server.pem\",\n+            keyfile=\"tests/certs/expired/server/server.key\",\n+        )\n+\n+        with server as (host, port):\n+            url = f\"https://{host}:{port}\"\n+            r1 = s.get(url, verify=False)\n+            assert r1.status_code == 200\n+\n+            # Cannot verify self-signed certificate\n             with pytest.raises(requests.exceptions.SSLError):\n-            s.get(\"https://invalid.badssl.com\")\n+                s.get(url)\n+\n+            close_server.set()\n+        assert 2 == len(s.adapters[\"https://\"].poolmanager.pools)\n+\n+    def test_different_connection_pool_for_tls_settings_verify_bundle_expired_cert(\n+        self,\n+    ):\n+        def response_handler(sock):\n+            consume_socket_content(sock, timeout=0.5)\n+            sock.send(\n+                b\"HTTP/1.1 200 OK\\r\\n\"\n+                b\"Content-Length: 18\\r\\n\\r\\n\"\n+                b'\\xff\\xfe{\\x00\"\\x00K0\"\\x00=\\x00\"\\x00\\xab0\"\\x00\\r\\n'\n+            )\n+\n+        s = requests.Session()\n+        close_server = threading.Event()\n+        server = TLSServer(\n+            handler=response_handler,\n+            wait_to_close_event=close_server,\n+            requests_to_handle=3,\n+            cert_chain=\"tests/certs/expired/server/server.pem\",\n+            keyfile=\"tests/certs/expired/server/server.key\",\n+        )\n+\n+        with server as (host, port):\n+            url = f\"https://{host}:{port}\"\n+            r1 = s.get(url, verify=False)\n+            assert r1.status_code == 200\n+\n+            # Has right trust bundle, but certificate expired\n+            with pytest.raises(requests.exceptions.SSLError):\n+                s.get(url, verify=\"tests/certs/expired/ca/ca.crt\")\n+\n+            close_server.set()\n+        assert 2 == len(s.adapters[\"https://\"].poolmanager.pools)\n+\n+    def test_different_connection_pool_for_tls_settings_verify_bundle_unexpired_cert(\n+        self,\n+    ):\n+        def response_handler(sock):\n+            consume_socket_content(sock, timeout=0.5)\n+            sock.send(\n+                b\"HTTP/1.1 200 OK\\r\\n\"\n+                b\"Content-Length: 18\\r\\n\\r\\n\"\n+                b'\\xff\\xfe{\\x00\"\\x00K0\"\\x00=\\x00\"\\x00\\xab0\"\\x00\\r\\n'\n+            )\n+\n+        s = requests.Session()\n+        close_server = threading.Event()\n+        server = TLSServer(\n+            handler=response_handler,\n+            wait_to_close_event=close_server,\n+            requests_to_handle=3,\n+            cert_chain=\"tests/certs/valid/server/server.pem\",\n+            keyfile=\"tests/certs/valid/server/server.key\",\n+        )\n+\n+        with server as (host, port):\n+            url = f\"https://{host}:{port}\"\n+            r1 = s.get(url, verify=False)\n+            assert r1.status_code == 200\n+\n+            r2 = s.get(url, verify=\"tests/certs/valid/ca/ca.crt\")\n+            assert r2.status_code == 200\n+\n+            close_server.set()\n+        assert 2 == len(s.adapters[\"https://\"].poolmanager.pools)\n+\n+    def test_different_connection_pool_for_mtls_settings(self):\n+        client_cert = None\n+\n+        def response_handler(sock):\n+            nonlocal client_cert\n+            client_cert = sock.getpeercert()\n+            consume_socket_content(sock, timeout=0.5)\n+            sock.send(\n+                b\"HTTP/1.1 200 OK\\r\\n\"\n+                b\"Content-Length: 18\\r\\n\\r\\n\"\n+                b'\\xff\\xfe{\\x00\"\\x00K0\"\\x00=\\x00\"\\x00\\xab0\"\\x00\\r\\n'\n+            )\n+\n+        s = requests.Session()\n+        close_server = threading.Event()\n+        server = TLSServer(\n+            handler=response_handler,\n+            wait_to_close_event=close_server,\n+            requests_to_handle=2,\n+            cert_chain=\"tests/certs/expired/server/server.pem\",\n+            keyfile=\"tests/certs/expired/server/server.key\",\n+            mutual_tls=True,\n+            cacert=\"tests/certs/expired/ca/ca.crt\",\n+        )\n+\n+        cert = (\n+            \"tests/certs/mtls/client/client.pem\",\n+            \"tests/certs/mtls/client/client.key\",\n+        )\n+        with server as (host, port):\n+            url = f\"https://{host}:{port}\"\n+            r1 = s.get(url, verify=False, cert=cert)\n+            assert r1.status_code == 200\n+            with pytest.raises(requests.exceptions.SSLError):\n+                s.get(url, cert=cert)\n+            close_server.set()\n+\n+        assert client_cert is not None\n \n \n def test_json_decode_errors_are_serializable_deserializable():\n\n@@ -1,5 +1,6 @@\n import select\n import socket\n+import ssl\n import threading\n \n \n@@ -132,3 +133,44 @@ class Server(threading.Thread):\n         self._close_server_sock_ignore_errors()\n         self.join()\n         return False  # allow exceptions to propagate\n+\n+\n+class TLSServer(Server):\n+    def __init__(\n+        self,\n+        *,\n+        handler=None,\n+        host=\"localhost\",\n+        port=0,\n+        requests_to_handle=1,\n+        wait_to_close_event=None,\n+        cert_chain=None,\n+        keyfile=None,\n+        mutual_tls=False,\n+        cacert=None,\n+    ):\n+        super().__init__(\n+            handler=handler,\n+            host=host,\n+            port=port,\n+            requests_to_handle=requests_to_handle,\n+            wait_to_close_event=wait_to_close_event,\n+        )\n+        self.cert_chain = cert_chain\n+        self.keyfile = keyfile\n+        self.ssl_context = ssl.SSLContext(ssl.PROTOCOL_TLS_SERVER)\n+        self.ssl_context.load_cert_chain(self.cert_chain, keyfile=self.keyfile)\n+        self.mutual_tls = mutual_tls\n+        self.cacert = cacert\n+        if mutual_tls:\n+            # For simplicity, we're going to assume that the client cert is\n+            # issued by the same CA as our Server certificate\n+            self.ssl_context.verify_mode = ssl.CERT_OPTIONAL\n+            self.ssl_context.load_verify_locations(self.cacert)\n+\n+    def _create_socket_and_bind(self):\n+        sock = socket.socket()\n+        sock = self.ssl_context.wrap_socket(sock, server_side=True)\n+        sock.bind((self.host, self.port))\n+        sock.listen()\n+        return sock\n\n\nQuestion: Does this commit introduce technical debt? Answer yes or no."}], "max_tokens": 1, "temperature": 0}}
