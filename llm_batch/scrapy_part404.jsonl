{"custom_id": "scrapy#1469b2739ea566a57e0b5f8e6bb104fd19460d24", "method": "POST", "url": "/v1/chat/completions", "body": {"model": "gpt-4o", "messages": [{"role": "user", "content": "You are a senior reviewer.\n\nCommit Summary:\nLines Added: 0 | Lines Deleted: 750 | Files Changed: 1 | Hunks: 1 | Methods Changed: 63 | Complexity Δ (Sum/Max): -76/0 | Churn Δ: 750 | Churn Cumulative: 2368 | Contributors (this commit): 9 | Commits (past 90d): 5 | Contributors (cumulative): 9 | DMM Complexity: 0.0\n\nDIFF:\n@@ -1,750 +0,0 @@\n-\"\"\"\n-These tests are kept as references from the ones that were ported to a itemloaders library.\n-Once we remove the references from scrapy, we can remove these tests.\n-\"\"\"\n-\n-import unittest\n-from functools import partial\n-\n-import pytest\n-from itemloaders.processors import (\n-    Compose,\n-    Identity,\n-    Join,\n-    MapCompose,\n-    SelectJmes,\n-    TakeFirst,\n-)\n-\n-from scrapy.item import Field, Item\n-from scrapy.loader import ItemLoader\n-\n-\n-# test items\n-class NameItem(Item):\n-    name = Field()\n-\n-\n-class SummaryItem(NameItem):\n-    url = Field()\n-    summary = Field()\n-\n-\n-# test item loaders\n-class NameItemLoader(ItemLoader):\n-    default_item_class = SummaryItem\n-\n-\n-class ProcessorItemLoader(NameItemLoader):\n-    name_in = MapCompose(lambda v: v.title())\n-\n-\n-class DefaultedItemLoader(NameItemLoader):\n-    default_input_processor = MapCompose(lambda v: v[:-1])\n-\n-\n-# test processors\n-def processor_with_args(value, other=None, loader_context=None):\n-    if \"key\" in loader_context:\n-        return loader_context[\"key\"]\n-    return value\n-\n-\n-class BasicItemLoaderTest(unittest.TestCase):\n-    def test_load_item_using_default_loader(self):\n-        i = SummaryItem()\n-        i[\"summary\"] = \"lala\"\n-        il = ItemLoader(item=i)\n-        il.add_value(\"name\", \"marta\")\n-        item = il.load_item()\n-        assert item is i\n-        self.assertEqual(item[\"summary\"], [\"lala\"])\n-        self.assertEqual(item[\"name\"], [\"marta\"])\n-\n-    def test_load_item_using_custom_loader(self):\n-        il = ProcessorItemLoader()\n-        il.add_value(\"name\", \"marta\")\n-        item = il.load_item()\n-        self.assertEqual(item[\"name\"], [\"Marta\"])\n-\n-    def test_load_item_ignore_none_field_values(self):\n-        def validate_sku(value):\n-            # Let's assume a SKU is only digits.\n-            return value if value.isdigit() else None\n-\n-        class MyLoader(ItemLoader):\n-            name_out = Compose(lambda vs: vs[0])  # take first which allows empty values\n-            price_out = Compose(TakeFirst(), float)\n-            sku_out = Compose(TakeFirst(), validate_sku)\n-\n-        valid_fragment = \"SKU: 1234\"\n-        invalid_fragment = \"SKU: not available\"\n-        sku_re = \"SKU: (.+)\"\n-\n-        il = MyLoader(item={})\n-        # Should not return \"sku: None\".\n-        il.add_value(\"sku\", [invalid_fragment], re=sku_re)\n-        # Should not ignore empty values.\n-        il.add_value(\"name\", \"\")\n-        il.add_value(\"price\", [\"0\"])\n-        self.assertEqual(\n-            il.load_item(),\n-            {\n-                \"name\": \"\",\n-                \"price\": 0.0,\n-            },\n-        )\n-\n-        il.replace_value(\"sku\", [valid_fragment], re=sku_re)\n-        self.assertEqual(il.load_item()[\"sku\"], \"1234\")\n-\n-    def test_self_referencing_loader(self):\n-        class MyLoader(ItemLoader):\n-            url_out = TakeFirst()\n-\n-            def img_url_out(self, values):\n-                return (self.get_output_value(\"url\") or \"\") + values[0]\n-\n-        il = MyLoader(item={})\n-        il.add_value(\"url\", \"http://example.com/\")\n-        il.add_value(\"img_url\", \"1234.png\")\n-        self.assertEqual(\n-            il.load_item(),\n-            {\n-                \"url\": \"http://example.com/\",\n-                \"img_url\": \"http://example.com/1234.png\",\n-            },\n-        )\n-\n-        il = MyLoader(item={})\n-        il.add_value(\"img_url\", \"1234.png\")\n-        self.assertEqual(\n-            il.load_item(),\n-            {\n-                \"img_url\": \"1234.png\",\n-            },\n-        )\n-\n-    def test_add_value(self):\n-        il = ProcessorItemLoader()\n-        il.add_value(\"name\", \"marta\")\n-        self.assertEqual(il.get_collected_values(\"name\"), [\"Marta\"])\n-        self.assertEqual(il.get_output_value(\"name\"), [\"Marta\"])\n-        il.add_value(\"name\", \"pepe\")\n-        self.assertEqual(il.get_collected_values(\"name\"), [\"Marta\", \"Pepe\"])\n-        self.assertEqual(il.get_output_value(\"name\"), [\"Marta\", \"Pepe\"])\n-\n-        # test add object value\n-        il.add_value(\"summary\", {\"key\": 1})\n-        self.assertEqual(il.get_collected_values(\"summary\"), [{\"key\": 1}])\n-\n-        il.add_value(None, \"Jim\", lambda x: {\"name\": x})\n-        self.assertEqual(il.get_collected_values(\"name\"), [\"Marta\", \"Pepe\", \"Jim\"])\n-\n-    def test_add_zero(self):\n-        il = NameItemLoader()\n-        il.add_value(\"name\", 0)\n-        self.assertEqual(il.get_collected_values(\"name\"), [0])\n-\n-    def test_replace_value(self):\n-        il = ProcessorItemLoader()\n-        il.replace_value(\"name\", \"marta\")\n-        self.assertEqual(il.get_collected_values(\"name\"), [\"Marta\"])\n-        self.assertEqual(il.get_output_value(\"name\"), [\"Marta\"])\n-        il.replace_value(\"name\", \"pepe\")\n-        self.assertEqual(il.get_collected_values(\"name\"), [\"Pepe\"])\n-        self.assertEqual(il.get_output_value(\"name\"), [\"Pepe\"])\n-\n-        il.replace_value(None, \"Jim\", lambda x: {\"name\": x})\n-        self.assertEqual(il.get_collected_values(\"name\"), [\"Jim\"])\n-\n-    def test_get_value(self):\n-        il = NameItemLoader()\n-        self.assertEqual(\"FOO\", il.get_value([\"foo\", \"bar\"], TakeFirst(), str.upper))\n-        self.assertEqual(\n-            [\"foo\", \"bar\"], il.get_value([\"name:foo\", \"name:bar\"], re=\"name:(.*)$\")\n-        )\n-        self.assertEqual(\n-            \"foo\", il.get_value([\"name:foo\", \"name:bar\"], TakeFirst(), re=\"name:(.*)$\")\n-        )\n-\n-        il.add_value(\"name\", [\"name:foo\", \"name:bar\"], TakeFirst(), re=\"name:(.*)$\")\n-        self.assertEqual([\"foo\"], il.get_collected_values(\"name\"))\n-        il.replace_value(\"name\", \"name:bar\", re=\"name:(.*)$\")\n-        self.assertEqual([\"bar\"], il.get_collected_values(\"name\"))\n-\n-    def test_iter_on_input_processor_input(self):\n-        class NameFirstItemLoader(NameItemLoader):\n-            name_in = TakeFirst()\n-\n-        il = NameFirstItemLoader()\n-        il.add_value(\"name\", \"marta\")\n-        self.assertEqual(il.get_collected_values(\"name\"), [\"marta\"])\n-        il = NameFirstItemLoader()\n-        il.add_value(\"name\", [\"marta\", \"jose\"])\n-        self.assertEqual(il.get_collected_values(\"name\"), [\"marta\"])\n-\n-        il = NameFirstItemLoader()\n-        il.replace_value(\"name\", \"marta\")\n-        self.assertEqual(il.get_collected_values(\"name\"), [\"marta\"])\n-        il = NameFirstItemLoader()\n-        il.replace_value(\"name\", [\"marta\", \"jose\"])\n-        self.assertEqual(il.get_collected_values(\"name\"), [\"marta\"])\n-\n-        il = NameFirstItemLoader()\n-        il.add_value(\"name\", \"marta\")\n-        il.add_value(\"name\", [\"jose\", \"pedro\"])\n-        self.assertEqual(il.get_collected_values(\"name\"), [\"marta\", \"jose\"])\n-\n-    def test_map_compose_filter(self):\n-        def filter_world(x):\n-            return None if x == \"world\" else x\n-\n-        proc = MapCompose(filter_world, str.upper)\n-        self.assertEqual(\n-            proc([\"hello\", \"world\", \"this\", \"is\", \"scrapy\"]),\n-            [\"HELLO\", \"THIS\", \"IS\", \"SCRAPY\"],\n-        )\n-\n-    def test_map_compose_filter_multil(self):\n-        class TestItemLoader(NameItemLoader):\n-            name_in = MapCompose(lambda v: v.title(), lambda v: v[:-1])\n-\n-        il = TestItemLoader()\n-        il.add_value(\"name\", \"marta\")\n-        self.assertEqual(il.get_output_value(\"name\"), [\"Mart\"])\n-        item = il.load_item()\n-        self.assertEqual(item[\"name\"], [\"Mart\"])\n-\n-    def test_default_input_processor(self):\n-        il = DefaultedItemLoader()\n-        il.add_value(\"name\", \"marta\")\n-        self.assertEqual(il.get_output_value(\"name\"), [\"mart\"])\n-\n-    def test_inherited_default_input_processor(self):\n-        class InheritDefaultedItemLoader(DefaultedItemLoader):\n-            pass\n-\n-        il = InheritDefaultedItemLoader()\n-        il.add_value(\"name\", \"marta\")\n-        self.assertEqual(il.get_output_value(\"name\"), [\"mart\"])\n-\n-    def test_input_processor_inheritance(self):\n-        class ChildItemLoader(ProcessorItemLoader):\n-            url_in = MapCompose(lambda v: v.lower())\n-\n-        il = ChildItemLoader()\n-        il.add_value(\"url\", \"HTTP://scrapy.ORG\")\n-        self.assertEqual(il.get_output_value(\"url\"), [\"http://scrapy.org\"])\n-        il.add_value(\"name\", \"marta\")\n-        self.assertEqual(il.get_output_value(\"name\"), [\"Marta\"])\n-\n-        class ChildChildItemLoader(ChildItemLoader):\n-            url_in = MapCompose(lambda v: v.upper())\n-            summary_in = MapCompose(lambda v: v)\n-\n-        il = ChildChildItemLoader()\n-        il.add_value(\"url\", \"http://scrapy.org\")\n-        self.assertEqual(il.get_output_value(\"url\"), [\"HTTP://SCRAPY.ORG\"])\n-        il.add_value(\"name\", \"marta\")\n-        self.assertEqual(il.get_output_value(\"name\"), [\"Marta\"])\n-\n-    def test_empty_map_compose(self):\n-        class IdentityDefaultedItemLoader(DefaultedItemLoader):\n-            name_in = MapCompose()\n-\n-        il = IdentityDefaultedItemLoader()\n-        il.add_value(\"name\", \"marta\")\n-        self.assertEqual(il.get_output_value(\"name\"), [\"marta\"])\n-\n-    def test_identity_input_processor(self):\n-        class IdentityDefaultedItemLoader(DefaultedItemLoader):\n-            name_in = Identity()\n-\n-        il = IdentityDefaultedItemLoader()\n-        il.add_value(\"name\", \"marta\")\n-        self.assertEqual(il.get_output_value(\"name\"), [\"marta\"])\n-\n-    def test_extend_custom_input_processors(self):\n-        class ChildItemLoader(ProcessorItemLoader):\n-            name_in = MapCompose(ProcessorItemLoader.name_in, str.swapcase)\n-\n-        il = ChildItemLoader()\n-        il.add_value(\"name\", \"marta\")\n-        self.assertEqual(il.get_output_value(\"name\"), [\"mARTA\"])\n-\n-    def test_extend_default_input_processors(self):\n-        class ChildDefaultedItemLoader(DefaultedItemLoader):\n-            name_in = MapCompose(\n-                DefaultedItemLoader.default_input_processor, str.swapcase\n-            )\n-\n-        il = ChildDefaultedItemLoader()\n-        il.add_value(\"name\", \"marta\")\n-        self.assertEqual(il.get_output_value(\"name\"), [\"MART\"])\n-\n-    def test_output_processor_using_function(self):\n-        il = ProcessorItemLoader()\n-        il.add_value(\"name\", [\"mar\", \"ta\"])\n-        self.assertEqual(il.get_output_value(\"name\"), [\"Mar\", \"Ta\"])\n-\n-        class TakeFirstItemLoader(ProcessorItemLoader):\n-            name_out = \" \".join\n-\n-        il = TakeFirstItemLoader()\n-        il.add_value(\"name\", [\"mar\", \"ta\"])\n-        self.assertEqual(il.get_output_value(\"name\"), \"Mar Ta\")\n-\n-    def test_output_processor_error(self):\n-        class TestItemLoader(ItemLoader):\n-            default_item_class = SummaryItem\n-            name_out = MapCompose(float)\n-\n-        il = TestItemLoader()\n-        il.add_value(\"name\", [\"$10\"])\n-        try:\n-            float(\"$10\")\n-        except Exception as e:\n-            expected_exc_str = str(e)\n-\n-        exc = None\n-        try:\n-            il.load_item()\n-        except Exception as e:\n-            exc = e\n-        assert isinstance(exc, ValueError)\n-        s = str(exc)\n-        assert \"name\" in s, s\n-        assert \"$10\" in s, s\n-        assert \"ValueError\" in s, s\n-        assert expected_exc_str in s, s\n-\n-    def test_output_processor_using_classes(self):\n-        il = ProcessorItemLoader()\n-        il.add_value(\"name\", [\"mar\", \"ta\"])\n-        self.assertEqual(il.get_output_value(\"name\"), [\"Mar\", \"Ta\"])\n-\n-        class TakeFirstItemLoader(ProcessorItemLoader):\n-            name_out = Join()\n-\n-        il = TakeFirstItemLoader()\n-        il.add_value(\"name\", [\"mar\", \"ta\"])\n-        self.assertEqual(il.get_output_value(\"name\"), \"Mar Ta\")\n-\n-        class TakeFirstItemLoader2(ProcessorItemLoader):\n-            name_out = Join(\"<br>\")\n-\n-        il = TakeFirstItemLoader2()\n-        il.add_value(\"name\", [\"mar\", \"ta\"])\n-        self.assertEqual(il.get_output_value(\"name\"), \"Mar<br>Ta\")\n-\n-    def test_default_output_processor(self):\n-        il = ProcessorItemLoader()\n-        il.add_value(\"name\", [\"mar\", \"ta\"])\n-        self.assertEqual(il.get_output_value(\"name\"), [\"Mar\", \"Ta\"])\n-\n-        class LalaItemLoader(ProcessorItemLoader):\n-            default_output_processor = Identity()\n-\n-        il = LalaItemLoader()\n-        il.add_value(\"name\", [\"mar\", \"ta\"])\n-        self.assertEqual(il.get_output_value(\"name\"), [\"Mar\", \"Ta\"])\n-\n-    def test_loader_context_on_declaration(self):\n-        class ChildItemLoader(ProcessorItemLoader):\n-            url_in = MapCompose(processor_with_args, key=\"val\")\n-\n-        il = ChildItemLoader()\n-        il.add_value(\"url\", \"text\")\n-        self.assertEqual(il.get_output_value(\"url\"), [\"val\"])\n-        il.replace_value(\"url\", \"text2\")\n-        self.assertEqual(il.get_output_value(\"url\"), [\"val\"])\n-\n-    def test_loader_context_on_instantiation(self):\n-        class ChildItemLoader(ProcessorItemLoader):\n-            url_in = MapCompose(processor_with_args)\n-\n-        il = ChildItemLoader(key=\"val\")\n-        il.add_value(\"url\", \"text\")\n-        self.assertEqual(il.get_output_value(\"url\"), [\"val\"])\n-        il.replace_value(\"url\", \"text2\")\n-        self.assertEqual(il.get_output_value(\"url\"), [\"val\"])\n-\n-    def test_loader_context_on_assign(self):\n-        class ChildItemLoader(ProcessorItemLoader):\n-            url_in = MapCompose(processor_with_args)\n-\n-        il = ChildItemLoader()\n-        il.context[\"key\"] = \"val\"\n-        il.add_value(\"url\", \"text\")\n-        self.assertEqual(il.get_output_value(\"url\"), [\"val\"])\n-        il.replace_value(\"url\", \"text2\")\n-        self.assertEqual(il.get_output_value(\"url\"), [\"val\"])\n-\n-    def test_item_passed_to_input_processor_functions(self):\n-        def processor(value, loader_context):\n-            return loader_context[\"item\"][\"name\"]\n-\n-        class ChildItemLoader(ProcessorItemLoader):\n-            url_in = MapCompose(processor)\n-\n-        it = SummaryItem(name=\"marta\")\n-        il = ChildItemLoader(item=it)\n-        il.add_value(\"url\", \"text\")\n-        self.assertEqual(il.get_output_value(\"url\"), [\"marta\"])\n-        il.replace_value(\"url\", \"text2\")\n-        self.assertEqual(il.get_output_value(\"url\"), [\"marta\"])\n-\n-    def test_compose_processor(self):\n-        class TestItemLoader(NameItemLoader):\n-            name_out = Compose(lambda v: v[0], lambda v: v.title(), lambda v: v[:-1])\n-\n-        il = TestItemLoader()\n-        il.add_value(\"name\", [\"marta\", \"other\"])\n-        self.assertEqual(il.get_output_value(\"name\"), \"Mart\")\n-        item = il.load_item()\n-        self.assertEqual(item[\"name\"], \"Mart\")\n-\n-    def test_partial_processor(self):\n-        def join(values, sep=None, loader_context=None, ignored=None):\n-            if sep is not None:\n-                return sep.join(values)\n-            if loader_context and \"sep\" in loader_context:\n-                return loader_context[\"sep\"].join(values)\n-            return \"\".join(values)\n-\n-        class TestItemLoader(NameItemLoader):\n-            name_out = Compose(partial(join, sep=\"+\"))\n-            url_out = Compose(partial(join, loader_context={\"sep\": \".\"}))\n-            summary_out = Compose(partial(join, ignored=\"foo\"))\n-\n-        il = TestItemLoader()\n-        il.add_value(\"name\", [\"rabbit\", \"hole\"])\n-        il.add_value(\"url\", [\"rabbit\", \"hole\"])\n-        il.add_value(\"summary\", [\"rabbit\", \"hole\"])\n-        item = il.load_item()\n-        self.assertEqual(item[\"name\"], \"rabbit+hole\")\n-        self.assertEqual(item[\"url\"], \"rabbit.hole\")\n-        self.assertEqual(item[\"summary\"], \"rabbithole\")\n-\n-    def test_error_input_processor(self):\n-        class TestItem(Item):\n-            name = Field()\n-\n-        class TestItemLoader(ItemLoader):\n-            default_item_class = TestItem\n-            name_in = MapCompose(float)\n-\n-        il = TestItemLoader()\n-        with pytest.raises(\n-            ValueError,\n-            match=\"Error with input processor MapCompose: .* \"\n-            \"error='ValueError: Error in MapCompose .* \"\n-            \"error='ValueError: could not convert\",\n-        ):\n-            il.add_value(\"name\", [\"marta\", \"other\"])\n-\n-    def test_error_output_processor(self):\n-        class TestItem(Item):\n-            name = Field()\n-\n-        class TestItemLoader(ItemLoader):\n-            default_item_class = TestItem\n-            name_out = Compose(Join(), float)\n-\n-        il = TestItemLoader()\n-        il.add_value(\"name\", \"marta\")\n-        with pytest.raises(\n-            ValueError,\n-            match=\"Error with output processor: .* \"\n-            \"error='ValueError: Error in Compose .* \"\n-            \"error='ValueError: could not convert\",\n-        ):\n-            il.load_item()\n-\n-    def test_error_processor_as_argument(self):\n-        class TestItem(Item):\n-            name = Field()\n-\n-        class TestItemLoader(ItemLoader):\n-            default_item_class = TestItem\n-\n-        il = TestItemLoader()\n-        with pytest.raises(\n-            ValueError,\n-            match=r\"Error with processor Compose .* \"\n-            r\"error='ValueError: Error in Compose .* \"\n-            r\"error='TypeError: float\\(\\) argument\",\n-        ):\n-            il.add_value(\"name\", [\"marta\", \"other\"], Compose(float))\n-\n-\n-class InitializationFromDictTest(unittest.TestCase):\n-    item_class = dict\n-\n-    def test_keep_single_value(self):\n-        \"\"\"Loaded item should contain values from the initial item\"\"\"\n-        input_item = self.item_class(name=\"foo\")\n-        il = ItemLoader(item=input_item)\n-        loaded_item = il.load_item()\n-        self.assertIsInstance(loaded_item, self.item_class)\n-        self.assertEqual(dict(loaded_item), {\"name\": [\"foo\"]})\n-\n-    def test_keep_list(self):\n-        \"\"\"Loaded item should contain values from the initial item\"\"\"\n-        input_item = self.item_class(name=[\"foo\", \"bar\"])\n-        il = ItemLoader(item=input_item)\n-        loaded_item = il.load_item()\n-        self.assertIsInstance(loaded_item, self.item_class)\n-        self.assertEqual(dict(loaded_item), {\"name\": [\"foo\", \"bar\"]})\n-\n-    def test_add_value_singlevalue_singlevalue(self):\n-        \"\"\"Values added after initialization should be appended\"\"\"\n-        input_item = self.item_class(name=\"foo\")\n-        il = ItemLoader(item=input_item)\n-        il.add_value(\"name\", \"bar\")\n-        loaded_item = il.load_item()\n-        self.assertIsInstance(loaded_item, self.item_class)\n-        self.assertEqual(dict(loaded_item), {\"name\": [\"foo\", \"bar\"]})\n-\n-    def test_add_value_singlevalue_list(self):\n-        \"\"\"Values added after initialization should be appended\"\"\"\n-        input_item = self.item_class(name=\"foo\")\n-        il = ItemLoader(item=input_item)\n-        il.add_value(\"name\", [\"item\", \"loader\"])\n-        loaded_item = il.load_item()\n-        self.assertIsInstance(loaded_item, self.item_class)\n-        self.assertEqual(dict(loaded_item), {\"name\": [\"foo\", \"item\", \"loader\"]})\n-\n-    def test_add_value_list_singlevalue(self):\n-        \"\"\"Values added after initialization should be appended\"\"\"\n-        input_item = self.item_class(name=[\"foo\", \"bar\"])\n-        il = ItemLoader(item=input_item)\n-        il.add_value(\"name\", \"qwerty\")\n-        loaded_item = il.load_item()\n-        self.assertIsInstance(loaded_item, self.item_class)\n-        self.assertEqual(dict(loaded_item), {\"name\": [\"foo\", \"bar\", \"qwerty\"]})\n-\n-    def test_add_value_list_list(self):\n-        \"\"\"Values added after initialization should be appended\"\"\"\n-        input_item = self.item_class(name=[\"foo\", \"bar\"])\n-        il = ItemLoader(item=input_item)\n-        il.add_value(\"name\", [\"item\", \"loader\"])\n-        loaded_item = il.load_item()\n-        self.assertIsInstance(loaded_item, self.item_class)\n-        self.assertEqual(dict(loaded_item), {\"name\": [\"foo\", \"bar\", \"item\", \"loader\"]})\n-\n-    def test_get_output_value_singlevalue(self):\n-        \"\"\"Getting output value must not remove value from item\"\"\"\n-        input_item = self.item_class(name=\"foo\")\n-        il = ItemLoader(item=input_item)\n-        self.assertEqual(il.get_output_value(\"name\"), [\"foo\"])\n-        loaded_item = il.load_item()\n-        self.assertIsInstance(loaded_item, self.item_class)\n-        self.assertEqual(loaded_item, {\"name\": [\"foo\"]})\n-\n-    def test_get_output_value_list(self):\n-        \"\"\"Getting output value must not remove value from item\"\"\"\n-        input_item = self.item_class(name=[\"foo\", \"bar\"])\n-        il = ItemLoader(item=input_item)\n-        self.assertEqual(il.get_output_value(\"name\"), [\"foo\", \"bar\"])\n-        loaded_item = il.load_item()\n-        self.assertIsInstance(loaded_item, self.item_class)\n-        self.assertEqual(loaded_item, {\"name\": [\"foo\", \"bar\"]})\n-\n-    def test_values_single(self):\n-        \"\"\"Values from initial item must be added to loader._values\"\"\"\n-        input_item = self.item_class(name=\"foo\")\n-        il = ItemLoader(item=input_item)\n-        self.assertEqual(il._values.get(\"name\"), [\"foo\"])\n-\n-    def test_values_list(self):\n-        \"\"\"Values from initial item must be added to loader._values\"\"\"\n-        input_item = self.item_class(name=[\"foo\", \"bar\"])\n-        il = ItemLoader(item=input_item)\n-        self.assertEqual(il._values.get(\"name\"), [\"foo\", \"bar\"])\n-\n-\n-class BaseNoInputReprocessingLoader(ItemLoader):\n-    title_in = MapCompose(str.upper)\n-    title_out = TakeFirst()\n-\n-\n-class NoInputReprocessingDictLoader(BaseNoInputReprocessingLoader):\n-    default_item_class = dict\n-\n-\n-class NoInputReprocessingFromDictTest(unittest.TestCase):\n-    \"\"\"\n-    Loaders initialized from loaded items must not reprocess fields (dict instances)\n-    \"\"\"\n-\n-    def test_avoid_reprocessing_with_initial_values_single(self):\n-        il = NoInputReprocessingDictLoader(item={\"title\": \"foo\"})\n-        il_loaded = il.load_item()\n-        self.assertEqual(il_loaded, {\"title\": \"foo\"})\n-        self.assertEqual(\n-            NoInputReprocessingDictLoader(item=il_loaded).load_item(), {\"title\": \"foo\"}\n-        )\n-\n-    def test_avoid_reprocessing_with_initial_values_list(self):\n-        il = NoInputReprocessingDictLoader(item={\"title\": [\"foo\", \"bar\"]})\n-        il_loaded = il.load_item()\n-        self.assertEqual(il_loaded, {\"title\": \"foo\"})\n-        self.assertEqual(\n-            NoInputReprocessingDictLoader(item=il_loaded).load_item(), {\"title\": \"foo\"}\n-        )\n-\n-    def test_avoid_reprocessing_without_initial_values_single(self):\n-        il = NoInputReprocessingDictLoader()\n-        il.add_value(\"title\", \"foo\")\n-        il_loaded = il.load_item()\n-        self.assertEqual(il_loaded, {\"title\": \"FOO\"})\n-        self.assertEqual(\n-            NoInputReprocessingDictLoader(item=il_loaded).load_item(), {\"title\": \"FOO\"}\n-        )\n-\n-    def test_avoid_reprocessing_without_initial_values_list(self):\n-        il = NoInputReprocessingDictLoader()\n-        il.add_value(\"title\", [\"foo\", \"bar\"])\n-        il_loaded = il.load_item()\n-        self.assertEqual(il_loaded, {\"title\": \"FOO\"})\n-        self.assertEqual(\n-            NoInputReprocessingDictLoader(item=il_loaded).load_item(), {\"title\": \"FOO\"}\n-        )\n-\n-\n-class TestOutputProcessorDict(unittest.TestCase):\n-    def test_output_processor(self):\n-        class TempDict(dict):\n-            def __init__(self, *args, **kwargs):\n-                super().__init__(self, *args, **kwargs)\n-                self.setdefault(\"temp\", 0.3)\n-\n-        class TempLoader(ItemLoader):\n-            default_item_class = TempDict\n-            default_input_processor = Identity()\n-            default_output_processor = Compose(TakeFirst())\n-\n-        loader = TempLoader()\n-        item = loader.load_item()\n-        self.assertIsInstance(item, TempDict)\n-        self.assertEqual(dict(item), {\"temp\": 0.3})\n-\n-\n-class ProcessorsTest(unittest.TestCase):\n-    def test_take_first(self):\n-        proc = TakeFirst()\n-        self.assertEqual(proc([None, \"\", \"hello\", \"world\"]), \"hello\")\n-        self.assertEqual(proc([None, \"\", 0, \"hello\", \"world\"]), 0)\n-\n-    def test_identity(self):\n-        proc = Identity()\n-        self.assertEqual(\n-            proc([None, \"\", \"hello\", \"world\"]), [None, \"\", \"hello\", \"world\"]\n-        )\n-\n-    def test_join(self):\n-        proc = Join()\n-        with pytest.raises(TypeError):\n-            proc([None, \"\", \"hello\", \"world\"])\n-        self.assertEqual(proc([\"\", \"hello\", \"world\"]), \" hello world\")\n-        self.assertEqual(proc([\"hello\", \"world\"]), \"hello world\")\n-        self.assertIsInstance(proc([\"hello\", \"world\"]), str)\n-\n-    def test_compose(self):\n-        proc = Compose(lambda v: v[0], str.upper)\n-        self.assertEqual(proc([\"hello\", \"world\"]), \"HELLO\")\n-        proc = Compose(str.upper)\n-        self.assertEqual(proc(None), None)\n-        proc = Compose(str.upper, stop_on_none=False)\n-        with pytest.raises(\n-            ValueError,\n-            match=\"Error in Compose with .* error='TypeError: (descriptor 'upper'|'str' object expected)\",\n-        ):\n-            proc(None)\n-        proc = Compose(str.upper, lambda x: x + 1)\n-        with pytest.raises(\n-            ValueError,\n-            match=\"Error in Compose with .* error='TypeError: (can only|unsupported operand)\",\n-        ):\n-            proc(\"hello\")\n-\n-    def test_mapcompose(self):\n-        def filter_world(x):\n-            return None if x == \"world\" else x\n-\n-        proc = MapCompose(filter_world, str.upper)\n-        self.assertEqual(\n-            proc([\"hello\", \"world\", \"this\", \"is\", \"scrapy\"]),\n-            [\"HELLO\", \"THIS\", \"IS\", \"SCRAPY\"],\n-        )\n-        proc = MapCompose(filter_world, str.upper)\n-        self.assertEqual(proc(None), [])\n-        proc = MapCompose(filter_world, str.upper)\n-        with pytest.raises(\n-            ValueError,\n-            match=\"Error in MapCompose with .* error='TypeError: (descriptor 'upper'|'str' object expected)\",\n-        ):\n-            proc([1])\n-        proc = MapCompose(filter_world, lambda x: x + 1)\n-        with pytest.raises(\n-            ValueError,\n-            match=\"Error in MapCompose with .* error='TypeError: (can only|unsupported operand)\",\n-        ):\n-            proc(\"hello\")\n-\n-\n-class SelectJmesTestCase(unittest.TestCase):\n-    test_list_equals = {\n-        \"simple\": (\"foo.bar\", {\"foo\": {\"bar\": \"baz\"}}, \"baz\"),\n-        \"invalid\": (\"foo.bar.baz\", {\"foo\": {\"bar\": \"baz\"}}, None),\n-        \"top_level\": (\"foo\", {\"foo\": {\"bar\": \"baz\"}}, {\"bar\": \"baz\"}),\n-        \"double_vs_single_quote_string\": (\"foo.bar\", {\"foo\": {\"bar\": \"baz\"}}, \"baz\"),\n-        \"dict\": (\n-            \"foo.bar[*].name\",\n-            {\"foo\": {\"bar\": [{\"name\": \"one\"}, {\"name\": \"two\"}]}},\n-            [\"one\", \"two\"],\n-        ),\n-        \"list\": (\"[1]\", [1, 2], 2),\n-    }\n-\n-    def test_output(self):\n-        for k, v in self.test_list_equals.items():\n-            expr, test_list, expected = v\n-            test = SelectJmes(expr)(test_list)\n-            self.assertEqual(\n-                test, expected, msg=f'test \"{k}\" got {test} expected {expected}'\n-            )\n-\n-\n-# Functions as processors\n-\n-\n-def function_processor_strip(iterable):\n-    return [x.strip() for x in iterable]\n-\n-\n-def function_processor_upper(iterable):\n-    return [x.upper() for x in iterable]\n-\n-\n-class FunctionProcessorItem(Item):\n-    foo = Field(\n-        input_processor=function_processor_strip,\n-        output_processor=function_processor_upper,\n-    )\n-\n-\n-class FunctionProcessorDictLoader(ItemLoader):\n-    default_item_class = dict\n-    foo_in = function_processor_strip\n-    foo_out = function_processor_upper\n-\n-\n-class FunctionProcessorTestCase(unittest.TestCase):\n-    def test_processor_defined_in_item_loader(self):\n-        lo = FunctionProcessorDictLoader()\n-        lo.add_value(\"foo\", \"  bar  \")\n-        lo.add_value(\"foo\", [\"  asdf  \", \"  qwerty  \"])\n-        self.assertEqual(dict(lo.load_item()), {\"foo\": [\"BAR\", \"ASDF\", \"QWERTY\"]})\n\n\nQuestion: Does this commit introduce technical debt? Answer yes or no."}], "max_tokens": 1, "temperature": 0}}
{"custom_id": "scrapy#044c3f69edd1bf926408649361ada7f2146db04e", "method": "POST", "url": "/v1/chat/completions", "body": {"model": "gpt-4o", "messages": [{"role": "user", "content": "You are a senior reviewer.\n\nCommit Summary:\nLines Added: 17 | Lines Deleted: 1 | Files Changed: 2 | Hunks: 4 | Methods Changed: 1 | Complexity Δ (Sum/Max): 1/1 | Churn Δ: 18 | Churn Cumulative: 1699 | Contributors (this commit): 26 | Commits (past 90d): 4 | Contributors (cumulative): 31 | DMM Complexity: 1.0\n\nDIFF:\n@@ -1,9 +1,11 @@\n from __future__ import annotations\n \n+import warnings\n from collections.abc import Iterable\n from typing import TYPE_CHECKING, Any, cast\n \n from scrapy import Request\n+from scrapy.exceptions import ScrapyDeprecationWarning\n from scrapy.spiders import Spider\n from scrapy.utils.spider import iterate_spider_output\n \n@@ -12,7 +14,20 @@ if TYPE_CHECKING:\n \n \n class InitSpider(Spider):\n-    \"\"\"Base Spider with initialization facilities\"\"\"\n+    \"\"\"Base Spider with initialization facilities\n+\n+    .. warning:: This class is deprecated. Copy its code into your project if needed.\n+    It will be removed in a future Scrapy version.\n+    \"\"\"\n+\n+    def __init__(self, *args, **kwargs):\n+        super().__init__(*args, **kwargs)\n+        warnings.warn(\n+            \"InitSpider is deprecated. Copy its code from Scrapy's source if needed. \"\n+            \"Will be removed in a future version.\",\n+            ScrapyDeprecationWarning,\n+            stacklevel=2,\n+        )\n \n     def start_requests(self) -> Iterable[Request]:\n         self._postinit_reqs: Iterable[Request] = super().start_requests()\n\n@@ -144,6 +144,7 @@ class TestSpider(unittest.TestCase):\n         mock_logger.log.assert_called_once_with(\"INFO\", \"test log msg\")\n \n \n+@pytest.mark.filterwarnings(\"ignore::scrapy.exceptions.ScrapyDeprecationWarning\")\n class TestInitSpider(TestSpider):\n     spider_class = InitSpider\n \n\n\nQuestion: Does this commit introduce technical debt? Answer yes or no."}], "max_tokens": 1, "temperature": 0}}
{"custom_id": "scrapy#02ed71d8877d1f3f270a9085c3cdb7fc7e917b8a", "method": "POST", "url": "/v1/chat/completions", "body": {"model": "gpt-4o", "messages": [{"role": "user", "content": "You are a senior reviewer.\n\nCommit Summary:\nLines Added: 433 | Lines Deleted: 631 | Files Changed: 7 | Hunks: 301 | Methods Changed: 127 | Complexity Δ (Sum/Max): 0/0 | Churn Δ: 1064 | Churn Cumulative: 9024 | Contributors (this commit): 55 | Commits (past 90d): 25 | Contributors (cumulative): 118 | DMM Complexity: 0.0\n\nDIFF:\n@@ -1,4 +1,3 @@\n-import unittest\n from abc import ABCMeta\n from unittest import mock\n \n@@ -7,9 +6,9 @@ import pytest\n from scrapy.item import Field, Item, ItemMeta\n \n \n-class ItemTest(unittest.TestCase):\n+class TestItem:\n     def assertSortedEqual(self, first, second, msg=None):\n-        return self.assertEqual(sorted(first), sorted(second), msg)\n+        assert sorted(first) == sorted(second), msg\n \n     def test_simple(self):\n         class TestItem(Item):\n@@ -17,7 +16,7 @@ class ItemTest(unittest.TestCase):\n \n         i = TestItem()\n         i[\"name\"] = \"name\"\n-        self.assertEqual(i[\"name\"], \"name\")\n+        assert i[\"name\"] == \"name\"\n \n     def test_init(self):\n         class TestItem(Item):\n@@ -28,13 +27,13 @@ class ItemTest(unittest.TestCase):\n             i[\"name\"]\n \n         i2 = TestItem(name=\"john doe\")\n-        self.assertEqual(i2[\"name\"], \"john doe\")\n+        assert i2[\"name\"] == \"john doe\"\n \n         i3 = TestItem({\"name\": \"john doe\"})\n-        self.assertEqual(i3[\"name\"], \"john doe\")\n+        assert i3[\"name\"] == \"john doe\"\n \n         i4 = TestItem(i3)\n-        self.assertEqual(i4[\"name\"], \"john doe\")\n+        assert i4[\"name\"] == \"john doe\"\n \n         with pytest.raises(KeyError):\n             TestItem({\"name\": \"john doe\", \"other\": \"foo\"})\n@@ -59,11 +58,11 @@ class ItemTest(unittest.TestCase):\n         i[\"number\"] = 123\n         itemrepr = repr(i)\n \n-        self.assertEqual(itemrepr, \"{'name': 'John Doe', 'number': 123}\")\n+        assert itemrepr == \"{'name': 'John Doe', 'number': 123}\"\n \n         i2 = eval(itemrepr)  # pylint: disable=eval-used\n-        self.assertEqual(i2[\"name\"], \"John Doe\")\n-        self.assertEqual(i2[\"number\"], 123)\n+        assert i2[\"name\"] == \"John Doe\"\n+        assert i2[\"number\"] == 123\n \n     def test_private_attr(self):\n         class TestItem(Item):\n@@ -71,7 +70,7 @@ class ItemTest(unittest.TestCase):\n \n         i = TestItem()\n         i._private = \"test\"\n-        self.assertEqual(i._private, \"test\")\n+        assert i._private == \"test\"\n \n     def test_raise_getattr(self):\n         class TestItem(Item):\n@@ -103,9 +102,9 @@ class ItemTest(unittest.TestCase):\n         with pytest.raises(KeyError):\n             i.get_name()\n         i[\"name\"] = \"lala\"\n-        self.assertEqual(i.get_name(), \"lala\")\n+        assert i.get_name() == \"lala\"\n         i.change_name(\"other\")\n-        self.assertEqual(i.get_name(), \"other\")\n+        assert i.get_name() == \"other\"\n \n     def test_metaclass(self):\n         class TestItem(Item):\n@@ -115,8 +114,8 @@ class ItemTest(unittest.TestCase):\n \n         i = TestItem()\n         i[\"name\"] = \"John\"\n-        self.assertEqual(list(i.keys()), [\"name\"])\n-        self.assertEqual(list(i.values()), [\"John\"])\n+        assert list(i.keys()) == [\"name\"]\n+        assert list(i.values()) == [\"John\"]\n \n         i[\"keys\"] = \"Keys\"\n         i[\"values\"] = \"Values\"\n@@ -142,8 +141,8 @@ class ItemTest(unittest.TestCase):\n \n         i = TestItem()\n         i[\"keys\"] = 3\n-        self.assertEqual(list(i.keys()), [\"keys\"])\n-        self.assertEqual(list(i.values()), [3])\n+        assert list(i.keys()) == [\"keys\"]\n+        assert list(i.values()) == [3]\n \n     def test_metaclass_multiple_inheritance_simple(self):\n         class A(Item):\n@@ -161,17 +160,17 @@ class ItemTest(unittest.TestCase):\n             pass\n \n         item = D(save=\"X\", load=\"Y\")\n-        self.assertEqual(item[\"save\"], \"X\")\n-        self.assertEqual(item[\"load\"], \"Y\")\n-        self.assertEqual(D.fields, {\"load\": {\"default\": \"A\"}, \"save\": {\"default\": \"A\"}})\n+        assert item[\"save\"] == \"X\"\n+        assert item[\"load\"] == \"Y\"\n+        assert D.fields == {\"load\": {\"default\": \"A\"}, \"save\": {\"default\": \"A\"}}\n \n         # D class inverted\n         class E(C, B):\n             pass\n \n-        self.assertEqual(E(save=\"X\")[\"save\"], \"X\")\n-        self.assertEqual(E(load=\"X\")[\"load\"], \"X\")\n-        self.assertEqual(E.fields, {\"load\": {\"default\": \"C\"}, \"save\": {\"default\": \"C\"}})\n+        assert E(save=\"X\")[\"save\"] == \"X\"\n+        assert E(load=\"X\")[\"load\"] == \"X\"\n+        assert E.fields == {\"load\": {\"default\": \"C\"}, \"save\": {\"default\": \"C\"}}\n \n     def test_metaclass_multiple_inheritance_diamond(self):\n         class A(Item):\n@@ -190,31 +189,25 @@ class ItemTest(unittest.TestCase):\n             fields = {\"update\": Field(default=\"D\")}\n             load = Field(default=\"D\")\n \n-        self.assertEqual(D(save=\"X\")[\"save\"], \"X\")\n-        self.assertEqual(D(load=\"X\")[\"load\"], \"X\")\n-        self.assertEqual(\n-            D.fields,\n-            {\n+        assert D(save=\"X\")[\"save\"] == \"X\"\n+        assert D(load=\"X\")[\"load\"] == \"X\"\n+        assert D.fields == {\n             \"save\": {\"default\": \"C\"},\n             \"load\": {\"default\": \"D\"},\n             \"update\": {\"default\": \"D\"},\n-            },\n-        )\n+        }\n \n         # D class inverted\n         class E(C, B):\n             load = Field(default=\"E\")\n \n-        self.assertEqual(E(save=\"X\")[\"save\"], \"X\")\n-        self.assertEqual(E(load=\"X\")[\"load\"], \"X\")\n-        self.assertEqual(\n-            E.fields,\n-            {\n+        assert E(save=\"X\")[\"save\"] == \"X\"\n+        assert E(load=\"X\")[\"load\"] == \"X\"\n+        assert E.fields == {\n             \"save\": {\"default\": \"C\"},\n             \"load\": {\"default\": \"E\"},\n             \"update\": {\"default\": \"C\"},\n-            },\n-        )\n+        }\n \n     def test_metaclass_multiple_inheritance_without_metaclass(self):\n         class A(Item):\n@@ -234,8 +227,8 @@ class ItemTest(unittest.TestCase):\n \n         with pytest.raises(KeyError):\n             D(not_allowed=\"value\")\n-        self.assertEqual(D(save=\"X\")[\"save\"], \"X\")\n-        self.assertEqual(D.fields, {\"save\": {\"default\": \"A\"}, \"load\": {\"default\": \"A\"}})\n+        assert D(save=\"X\")[\"save\"] == \"X\"\n+        assert D.fields == {\"save\": {\"default\": \"A\"}, \"load\": {\"default\": \"A\"}}\n \n         # D class inverted\n         class E(C, B):\n@@ -243,8 +236,8 @@ class ItemTest(unittest.TestCase):\n \n         with pytest.raises(KeyError):\n             E(not_allowed=\"value\")\n-        self.assertEqual(E(save=\"X\")[\"save\"], \"X\")\n-        self.assertEqual(E.fields, {\"save\": {\"default\": \"A\"}, \"load\": {\"default\": \"A\"}})\n+        assert E(save=\"X\")[\"save\"] == \"X\"\n+        assert E.fields == {\"save\": {\"default\": \"A\"}, \"load\": {\"default\": \"A\"}}\n \n     def test_to_dict(self):\n         class TestItem(Item):\n@@ -252,7 +245,7 @@ class ItemTest(unittest.TestCase):\n \n         i = TestItem()\n         i[\"name\"] = \"John\"\n-        self.assertEqual(dict(i), {\"name\": \"John\"})\n+        assert dict(i) == {\"name\": \"John\"}\n \n     def test_copy(self):\n         class TestItem(Item):\n@@ -260,9 +253,9 @@ class ItemTest(unittest.TestCase):\n \n         item = TestItem({\"name\": \"lower\"})\n         copied_item = item.copy()\n-        self.assertNotEqual(id(item), id(copied_item))\n+        assert id(item) != id(copied_item)\n         copied_item[\"name\"] = copied_item[\"name\"].upper()\n-        self.assertNotEqual(item[\"name\"], copied_item[\"name\"])\n+        assert item[\"name\"] != copied_item[\"name\"]\n \n     def test_deepcopy(self):\n         class TestItem(Item):\n@@ -274,7 +267,7 @@ class ItemTest(unittest.TestCase):\n         assert item[\"tags\"] != copied_item[\"tags\"]\n \n \n-class ItemMetaTest(unittest.TestCase):\n+class TestItemMeta:\n     def test_new_method_propagates_classcell(self):\n         new_mock = mock.Mock(side_effect=ABCMeta.__new__)\n         base = ItemMeta.__bases__[0]\n@@ -297,7 +290,7 @@ class ItemMetaTest(unittest.TestCase):\n         assert \"__classcell__\" in attrs\n \n \n-class ItemMetaClassCellRegression(unittest.TestCase):\n+class TestItemMetaClassCellRegression:\n     def test_item_meta_classcell_regression(self):\n         class MyItem(Item, metaclass=ItemMeta):\n             def __init__(self, *args, **kwargs):  # pylint: disable=useless-parent-delegation\n\n@@ -1,18 +1,16 @@\n-import unittest\n-\n import pytest\n \n from scrapy.link import Link\n \n \n-class LinkTest(unittest.TestCase):\n+class TestLink:\n     def _assert_same_links(self, link1, link2):\n-        self.assertEqual(link1, link2)\n-        self.assertEqual(hash(link1), hash(link2))\n+        assert link1 == link2\n+        assert hash(link1) == hash(link2)\n \n     def _assert_different_links(self, link1, link2):\n-        self.assertNotEqual(link1, link2)\n-        self.assertNotEqual(hash(link1), hash(link2))\n+        assert link1 != link2\n+        assert hash(link1) != hash(link2)\n \n     def test_eq_and_hash(self):\n         l1 = Link(\"http://www.example.com\")\n\n@@ -2,7 +2,6 @@ from __future__ import annotations\n \n import pickle\n import re\n-import unittest\n \n import pytest\n from packaging.version import Version\n@@ -16,30 +15,25 @@ from tests import get_testdata\n \n # a hack to skip base class tests in pytest\n class Base:\n-    class LinkExtractorTestCase(unittest.TestCase):\n+    class TestLinkExtractorBase:\n         extractor_cls: type | None = None\n \n-        def setUp(self):\n+        def setup_method(self):\n             body = get_testdata(\"link_extractor\", \"linkextractor.html\")\n             self.response = HtmlResponse(url=\"http://example.com/index\", body=body)\n \n         def test_urls_type(self):\n             \"\"\"Test that the resulting urls are str objects\"\"\"\n             lx = self.extractor_cls()\n-            self.assertTrue(\n-                all(\n-                    isinstance(link.url, str)\n-                    for link in lx.extract_links(self.response)\n-                )\n+            assert all(\n+                isinstance(link.url, str) for link in lx.extract_links(self.response)\n             )\n \n         def test_extract_all_links(self):\n             lx = self.extractor_cls()\n             page4_url = \"http://example.com/page%204.html\"\n \n-            self.assertEqual(\n-                list(lx.extract_links(self.response)),\n-                [\n+            assert list(lx.extract_links(self.response)) == [\n                 Link(url=\"http://example.com/sample1.html\", text=\"\"),\n                 Link(url=\"http://example.com/sample2.html\", text=\"sample 2\"),\n                 Link(url=\"http://example.com/sample3.html\", text=\"sample 3 text\"),\n@@ -50,14 +44,11 @@ class Base:\n                 Link(url=\"http://www.google.com/something\", text=\"\"),\n                 Link(url=\"http://example.com/innertag.html\", text=\"inner tag\"),\n                 Link(url=page4_url, text=\"href with whitespaces\"),\n-                ],\n-            )\n+            ]\n \n         def test_extract_filter_allow(self):\n             lx = self.extractor_cls(allow=(\"sample\",))\n-            self.assertEqual(\n-                list(lx.extract_links(self.response)),\n-                [\n+            assert list(lx.extract_links(self.response)) == [\n                 Link(url=\"http://example.com/sample1.html\", text=\"\"),\n                 Link(url=\"http://example.com/sample2.html\", text=\"sample 2\"),\n                 Link(url=\"http://example.com/sample3.html\", text=\"sample 3 text\"),\n@@ -65,14 +56,11 @@ class Base:\n                     url=\"http://example.com/sample3.html#foo\",\n                     text=\"sample 3 repetition with fragment\",\n                 ),\n-                ],\n-            )\n+            ]\n \n         def test_extract_filter_allow_with_duplicates(self):\n             lx = self.extractor_cls(allow=(\"sample\",), unique=False)\n-            self.assertEqual(\n-                list(lx.extract_links(self.response)),\n-                [\n+            assert list(lx.extract_links(self.response)) == [\n                 Link(url=\"http://example.com/sample1.html\", text=\"\"),\n                 Link(url=\"http://example.com/sample2.html\", text=\"sample 2\"),\n                 Link(url=\"http://example.com/sample3.html\", text=\"sample 3 text\"),\n@@ -88,14 +76,11 @@ class Base:\n                     url=\"http://example.com/sample3.html#foo\",\n                     text=\"sample 3 repetition with fragment\",\n                 ),\n-                ],\n-            )\n+            ]\n \n         def test_extract_filter_allow_with_duplicates_canonicalize(self):\n             lx = self.extractor_cls(allow=(\"sample\",), unique=False, canonicalize=True)\n-            self.assertEqual(\n-                list(lx.extract_links(self.response)),\n-                [\n+            assert list(lx.extract_links(self.response)) == [\n                 Link(url=\"http://example.com/sample1.html\", text=\"\"),\n                 Link(url=\"http://example.com/sample2.html\", text=\"sample 2\"),\n                 Link(url=\"http://example.com/sample3.html\", text=\"sample 3 text\"),\n@@ -111,46 +96,34 @@ class Base:\n                     url=\"http://example.com/sample3.html\",\n                     text=\"sample 3 repetition with fragment\",\n                 ),\n-                ],\n-            )\n+            ]\n \n         def test_extract_filter_allow_no_duplicates_canonicalize(self):\n             lx = self.extractor_cls(allow=(\"sample\",), unique=True, canonicalize=True)\n-            self.assertEqual(\n-                list(lx.extract_links(self.response)),\n-                [\n+            assert list(lx.extract_links(self.response)) == [\n                 Link(url=\"http://example.com/sample1.html\", text=\"\"),\n                 Link(url=\"http://example.com/sample2.html\", text=\"sample 2\"),\n                 Link(url=\"http://example.com/sample3.html\", text=\"sample 3 text\"),\n-                ],\n-            )\n+            ]\n \n         def test_extract_filter_allow_and_deny(self):\n             lx = self.extractor_cls(allow=(\"sample\",), deny=(\"3\",))\n-            self.assertEqual(\n-                list(lx.extract_links(self.response)),\n-                [\n+            assert list(lx.extract_links(self.response)) == [\n                 Link(url=\"http://example.com/sample1.html\", text=\"\"),\n                 Link(url=\"http://example.com/sample2.html\", text=\"sample 2\"),\n-                ],\n-            )\n+            ]\n \n         def test_extract_filter_allowed_domains(self):\n             lx = self.extractor_cls(allow_domains=(\"google.com\",))\n-            self.assertEqual(\n-                list(lx.extract_links(self.response)),\n-                [\n+            assert list(lx.extract_links(self.response)) == [\n                 Link(url=\"http://www.google.com/something\", text=\"\"),\n-                ],\n-            )\n+            ]\n \n         def test_extraction_using_single_values(self):\n             \"\"\"Test the extractor's behaviour among different situations\"\"\"\n \n             lx = self.extractor_cls(allow=\"sample\")\n-            self.assertEqual(\n-                list(lx.extract_links(self.response)),\n-                [\n+            assert list(lx.extract_links(self.response)) == [\n                 Link(url=\"http://example.com/sample1.html\", text=\"\"),\n                 Link(url=\"http://example.com/sample2.html\", text=\"sample 2\"),\n                 Link(url=\"http://example.com/sample3.html\", text=\"sample 3 text\"),\n@@ -158,33 +131,23 @@ class Base:\n                     url=\"http://example.com/sample3.html#foo\",\n                     text=\"sample 3 repetition with fragment\",\n                 ),\n-                ],\n-            )\n+            ]\n \n             lx = self.extractor_cls(allow=\"sample\", deny=\"3\")\n-            self.assertEqual(\n-                list(lx.extract_links(self.response)),\n-                [\n+            assert list(lx.extract_links(self.response)) == [\n                 Link(url=\"http://example.com/sample1.html\", text=\"\"),\n                 Link(url=\"http://example.com/sample2.html\", text=\"sample 2\"),\n-                ],\n-            )\n+            ]\n \n             lx = self.extractor_cls(allow_domains=\"google.com\")\n-            self.assertEqual(\n-                list(lx.extract_links(self.response)),\n-                [\n+            assert list(lx.extract_links(self.response)) == [\n                 Link(url=\"http://www.google.com/something\", text=\"\"),\n-                ],\n-            )\n+            ]\n \n             lx = self.extractor_cls(deny_domains=\"example.com\")\n-            self.assertEqual(\n-                list(lx.extract_links(self.response)),\n-                [\n+            assert list(lx.extract_links(self.response)) == [\n                 Link(url=\"http://www.google.com/something\", text=\"\"),\n-                ],\n-            )\n+            ]\n \n         def test_nofollow(self):\n             \"\"\"Test the extractor's behaviour for links with rel='nofollow'\"\"\"\n@@ -210,9 +173,7 @@ class Base:\n             response = HtmlResponse(\"http://example.org/somepage/index.html\", body=html)\n \n             lx = self.extractor_cls()\n-            self.assertEqual(\n-                lx.extract_links(response),\n-                [\n+            assert lx.extract_links(response) == [\n                 Link(url=\"http://example.org/about.html\", text=\"About us\"),\n                 Link(url=\"http://example.org/follow.html\", text=\"Follow this link\"),\n                 Link(\n@@ -229,28 +190,27 @@ class Base:\n                     text=\"External link not to follow\",\n                     nofollow=True,\n                 ),\n-                ],\n-            )\n+            ]\n \n         def test_matches(self):\n             url1 = \"http://lotsofstuff.com/stuff1/index\"\n             url2 = \"http://evenmorestuff.com/uglystuff/index\"\n \n             lx = self.extractor_cls(allow=(r\"stuff1\",))\n-            self.assertTrue(lx.matches(url1))\n-            self.assertFalse(lx.matches(url2))\n+            assert lx.matches(url1)\n+            assert not lx.matches(url2)\n \n             lx = self.extractor_cls(deny=(r\"uglystuff\",))\n-            self.assertTrue(lx.matches(url1))\n-            self.assertFalse(lx.matches(url2))\n+            assert lx.matches(url1)\n+            assert not lx.matches(url2)\n \n             lx = self.extractor_cls(allow_domains=(\"evenmorestuff.com\",))\n-            self.assertFalse(lx.matches(url1))\n-            self.assertTrue(lx.matches(url2))\n+            assert not lx.matches(url1)\n+            assert lx.matches(url2)\n \n             lx = self.extractor_cls(deny_domains=(\"lotsofstuff.com\",))\n-            self.assertFalse(lx.matches(url1))\n-            self.assertTrue(lx.matches(url2))\n+            assert not lx.matches(url1)\n+            assert lx.matches(url2)\n \n             lx = self.extractor_cls(\n                 allow=[\"blah1\"],\n@@ -258,20 +218,17 @@ class Base:\n                 allow_domains=[\"blah1.com\"],\n                 deny_domains=[\"blah2.com\"],\n             )\n-            self.assertTrue(lx.matches(\"http://blah1.com/blah1\"))\n-            self.assertFalse(lx.matches(\"http://blah1.com/blah2\"))\n-            self.assertFalse(lx.matches(\"http://blah2.com/blah1\"))\n-            self.assertFalse(lx.matches(\"http://blah2.com/blah2\"))\n+            assert lx.matches(\"http://blah1.com/blah1\")\n+            assert not lx.matches(\"http://blah1.com/blah2\")\n+            assert not lx.matches(\"http://blah2.com/blah1\")\n+            assert not lx.matches(\"http://blah2.com/blah2\")\n \n         def test_restrict_xpaths(self):\n             lx = self.extractor_cls(restrict_xpaths=('//div[@id=\"subwrapper\"]',))\n-            self.assertEqual(\n-                list(lx.extract_links(self.response)),\n-                [\n+            assert list(lx.extract_links(self.response)) == [\n                 Link(url=\"http://example.com/sample1.html\", text=\"\"),\n                 Link(url=\"http://example.com/sample2.html\", text=\"sample 2\"),\n-                ],\n-            )\n+            ]\n \n         def test_restrict_xpaths_encoding(self):\n             \"\"\"Test restrict_xpaths with encodings\"\"\"\n@@ -291,10 +248,9 @@ class Base:\n             )\n \n             lx = self.extractor_cls(restrict_xpaths=\"//div[@class='links']\")\n-            self.assertEqual(\n-                lx.extract_links(response),\n-                [Link(url=\"http://example.org/about.html\", text=\"About us\\xa3\")],\n-            )\n+            assert lx.extract_links(response) == [\n+                Link(url=\"http://example.org/about.html\", text=\"About us\\xa3\")\n+            ]\n \n         def test_restrict_xpaths_with_html_entities(self):\n             html = b'<html><body><p><a href=\"/&hearts;/you?c=&euro;\">text</a></p></body></html>'\n@@ -304,47 +260,40 @@ class Base:\n                 encoding=\"iso8859-15\",\n             )\n             links = self.extractor_cls(restrict_xpaths=\"//p\").extract_links(response)\n-            self.assertEqual(\n-                links, [Link(url=\"http://example.org/%E2%99%A5/you?c=%A4\", text=\"text\")]\n-            )\n+            assert links == [\n+                Link(url=\"http://example.org/%E2%99%A5/you?c=%A4\", text=\"text\")\n+            ]\n \n         def test_restrict_xpaths_concat_in_handle_data(self):\n             \"\"\"html entities cause SGMLParser to call handle_data hook twice\"\"\"\n             body = b\"\"\"<html><body><div><a href=\"/foo\">&gt;\\xbe\\xa9&lt;\\xb6\\xab</a></body></html>\"\"\"\n             response = HtmlResponse(\"http://example.org\", body=body, encoding=\"gb18030\")\n             lx = self.extractor_cls(restrict_xpaths=\"//div\")\n-            self.assertEqual(\n-                lx.extract_links(response),\n-                [\n+            assert lx.extract_links(response) == [\n                 Link(\n                     url=\"http://example.org/foo\",\n                     text=\">\\u4eac<\\u4e1c\",\n                     fragment=\"\",\n                     nofollow=False,\n                 )\n-                ],\n-            )\n+            ]\n \n         def test_restrict_css(self):\n             lx = self.extractor_cls(restrict_css=(\"#subwrapper a\",))\n-            self.assertEqual(\n-                lx.extract_links(self.response),\n-                [Link(url=\"http://example.com/sample2.html\", text=\"sample 2\")],\n-            )\n+            assert lx.extract_links(self.response) == [\n+                Link(url=\"http://example.com/sample2.html\", text=\"sample 2\")\n+            ]\n \n         def test_restrict_css_and_restrict_xpaths_together(self):\n             lx = self.extractor_cls(\n                 restrict_xpaths=('//div[@id=\"subwrapper\"]',),\n                 restrict_css=(\"#subwrapper + a\",),\n             )\n-            self.assertEqual(\n-                list(lx.extract_links(self.response)),\n-                [\n+            assert list(lx.extract_links(self.response)) == [\n                 Link(url=\"http://example.com/sample1.html\", text=\"\"),\n                 Link(url=\"http://example.com/sample2.html\", text=\"sample 2\"),\n                 Link(url=\"http://example.com/sample3.html\", text=\"sample 3 text\"),\n-                ],\n-            )\n+            ]\n \n         def test_area_tag_with_unicode_present(self):\n             body = b\"\"\"<html><body>\\xbe\\xa9<map><area href=\"http://example.org/foo\" /></map></body></html>\"\"\"\n@@ -353,17 +302,14 @@ class Base:\n             lx.extract_links(response)\n             lx.extract_links(response)\n             lx.extract_links(response)\n-            self.assertEqual(\n-                lx.extract_links(response),\n-                [\n+            assert lx.extract_links(response) == [\n                 Link(\n                     url=\"http://example.org/foo\",\n                     text=\"\",\n                     fragment=\"\",\n                     nofollow=False,\n                 )\n-                ],\n-            )\n+            ]\n \n         def test_encoded_url(self):\n             body = b\"\"\"<html><body><div><a href=\"?page=2\">BinB</a></body></html>\"\"\"\n@@ -371,17 +317,14 @@ class Base:\n                 \"http://known.fm/AC%2FDC/\", body=body, encoding=\"utf8\"\n             )\n             lx = self.extractor_cls()\n-            self.assertEqual(\n-                lx.extract_links(response),\n-                [\n+            assert lx.extract_links(response) == [\n                 Link(\n                     url=\"http://known.fm/AC%2FDC/?page=2\",\n                     text=\"BinB\",\n                     fragment=\"\",\n                     nofollow=False,\n                 ),\n-                ],\n-            )\n+            ]\n \n         def test_encoded_url_in_restricted_xpath(self):\n             body = b\"\"\"<html><body><div><a href=\"?page=2\">BinB</a></body></html>\"\"\"\n@@ -389,38 +332,29 @@ class Base:\n                 \"http://known.fm/AC%2FDC/\", body=body, encoding=\"utf8\"\n             )\n             lx = self.extractor_cls(restrict_xpaths=\"//div\")\n-            self.assertEqual(\n-                lx.extract_links(response),\n-                [\n+            assert lx.extract_links(response) == [\n                 Link(\n                     url=\"http://known.fm/AC%2FDC/?page=2\",\n                     text=\"BinB\",\n                     fragment=\"\",\n                     nofollow=False,\n                 ),\n-                ],\n-            )\n+            ]\n \n         def test_ignored_extensions(self):\n             # jpg is ignored by default\n             html = b\"\"\"<a href=\"page.html\">asd</a> and <a href=\"photo.jpg\">\"\"\"\n             response = HtmlResponse(\"http://example.org/\", body=html)\n             lx = self.extractor_cls()\n-            self.assertEqual(\n-                lx.extract_links(response),\n-                [\n+            assert lx.extract_links(response) == [\n                 Link(url=\"http://example.org/page.html\", text=\"asd\"),\n-                ],\n-            )\n+            ]\n \n             # override denied extensions\n             lx = self.extractor_cls(deny_extensions=[\"html\"])\n-            self.assertEqual(\n-                lx.extract_links(response),\n-                [\n+            assert lx.extract_links(response) == [\n                 Link(url=\"http://example.org/photo.jpg\"),\n-                ],\n-            )\n+            ]\n \n         def test_process_value(self):\n             \"\"\"Test restrict_xpaths with encodings\"\"\"\n@@ -439,10 +373,9 @@ class Base:\n                 return m.group(1) if m else None\n \n             lx = self.extractor_cls(process_value=process_value)\n-            self.assertEqual(\n-                lx.extract_links(response),\n-                [Link(url=\"http://example.org/other/page.html\", text=\"Text\")],\n-            )\n+            assert lx.extract_links(response) == [\n+                Link(url=\"http://example.org/other/page.html\", text=\"Text\")\n+            ]\n \n         def test_base_url_with_restrict_xpaths(self):\n             html = b\"\"\"<html><head><title>Page title<title><base href=\"http://otherdomain.com/base/\" />\n@@ -450,18 +383,15 @@ class Base:\n             </body></html>\"\"\"\n             response = HtmlResponse(\"http://example.org/somepage/index.html\", body=html)\n             lx = self.extractor_cls(restrict_xpaths=\"//p\")\n-            self.assertEqual(\n-                lx.extract_links(response),\n-                [Link(url=\"http://otherdomain.com/base/item/12.html\", text=\"Item 12\")],\n-            )\n+            assert lx.extract_links(response) == [\n+                Link(url=\"http://otherdomain.com/base/item/12.html\", text=\"Item 12\")\n+            ]\n \n         def test_attrs(self):\n             lx = self.extractor_cls(attrs=\"href\")\n             page4_url = \"http://example.com/page%204.html\"\n \n-            self.assertEqual(\n-                lx.extract_links(self.response),\n-                [\n+            assert lx.extract_links(self.response) == [\n                 Link(url=\"http://example.com/sample1.html\", text=\"\"),\n                 Link(url=\"http://example.com/sample2.html\", text=\"sample 2\"),\n                 Link(url=\"http://example.com/sample3.html\", text=\"sample 3 text\"),\n@@ -472,15 +402,12 @@ class Base:\n                 Link(url=\"http://www.google.com/something\", text=\"\"),\n                 Link(url=\"http://example.com/innertag.html\", text=\"inner tag\"),\n                 Link(url=page4_url, text=\"href with whitespaces\"),\n-                ],\n-            )\n+            ]\n \n             lx = self.extractor_cls(\n                 attrs=(\"href\", \"src\"), tags=(\"a\", \"area\", \"img\"), deny_extensions=()\n             )\n-            self.assertEqual(\n-                lx.extract_links(self.response),\n-                [\n+            assert lx.extract_links(self.response) == [\n                 Link(url=\"http://example.com/sample1.html\", text=\"\"),\n                 Link(url=\"http://example.com/sample2.html\", text=\"sample 2\"),\n                 Link(url=\"http://example.com/sample2.jpg\", text=\"\"),\n@@ -492,11 +419,10 @@ class Base:\n                 Link(url=\"http://www.google.com/something\", text=\"\"),\n                 Link(url=\"http://example.com/innertag.html\", text=\"inner tag\"),\n                 Link(url=page4_url, text=\"href with whitespaces\"),\n-                ],\n-            )\n+            ]\n \n             lx = self.extractor_cls(attrs=None)\n-            self.assertEqual(lx.extract_links(self.response), [])\n+            assert lx.extract_links(self.response) == []\n \n         def test_tags(self):\n             html = (\n@@ -506,43 +432,31 @@ class Base:\n             response = HtmlResponse(\"http://example.com/index.html\", body=html)\n \n             lx = self.extractor_cls(tags=None)\n-            self.assertEqual(lx.extract_links(response), [])\n+            assert lx.extract_links(response) == []\n \n             lx = self.extractor_cls()\n-            self.assertEqual(\n-                lx.extract_links(response),\n-                [\n+            assert lx.extract_links(response) == [\n                 Link(url=\"http://example.com/sample1.html\", text=\"\"),\n                 Link(url=\"http://example.com/sample2.html\", text=\"sample 2\"),\n-                ],\n-            )\n+            ]\n \n             lx = self.extractor_cls(tags=\"area\")\n-            self.assertEqual(\n-                lx.extract_links(response),\n-                [\n+            assert lx.extract_links(response) == [\n                 Link(url=\"http://example.com/sample1.html\", text=\"\"),\n-                ],\n-            )\n+            ]\n \n             lx = self.extractor_cls(tags=\"a\")\n-            self.assertEqual(\n-                lx.extract_links(response),\n-                [\n+            assert lx.extract_links(response) == [\n                 Link(url=\"http://example.com/sample2.html\", text=\"sample 2\"),\n-                ],\n-            )\n+            ]\n \n             lx = self.extractor_cls(\n                 tags=(\"a\", \"img\"), attrs=(\"href\", \"src\"), deny_extensions=()\n             )\n-            self.assertEqual(\n-                lx.extract_links(response),\n-                [\n+            assert lx.extract_links(response) == [\n                 Link(url=\"http://example.com/sample2.html\", text=\"sample 2\"),\n                 Link(url=\"http://example.com/sample2.jpg\", text=\"\"),\n-                ],\n-            )\n+            ]\n \n         def test_tags_attrs(self):\n             html = b\"\"\"\n@@ -554,9 +468,7 @@ class Base:\n             response = HtmlResponse(\"http://example.com/index.html\", body=html)\n \n             lx = self.extractor_cls(tags=\"div\", attrs=\"data-url\")\n-            self.assertEqual(\n-                lx.extract_links(response),\n-                [\n+            assert lx.extract_links(response) == [\n                 Link(\n                     url=\"http://example.com/get?id=1\",\n                     text=\"Item 1\",\n@@ -569,13 +481,10 @@ class Base:\n                     fragment=\"\",\n                     nofollow=False,\n                 ),\n-                ],\n-            )\n+            ]\n \n             lx = self.extractor_cls(tags=(\"div\",), attrs=(\"data-url\",))\n-            self.assertEqual(\n-                lx.extract_links(response),\n-                [\n+            assert lx.extract_links(response) == [\n                 Link(\n                     url=\"http://example.com/get?id=1\",\n                     text=\"Item 1\",\n@@ -588,8 +497,7 @@ class Base:\n                     fragment=\"\",\n                     nofollow=False,\n                 ),\n-                ],\n-            )\n+            ]\n \n         def test_xhtml(self):\n             xhtml = b\"\"\"\n@@ -623,9 +531,7 @@ class Base:\n             response = HtmlResponse(\"http://example.com/index.xhtml\", body=xhtml)\n \n             lx = self.extractor_cls()\n-            self.assertEqual(\n-                lx.extract_links(response),\n-                [\n+            assert lx.extract_links(response) == [\n                 Link(\n                     url=\"http://example.com/about.html\",\n                     text=\"About us\",\n@@ -655,15 +561,12 @@ class Base:\n                     text=\"External link not to follow\",\n                     nofollow=True,\n                 ),\n-                ],\n-            )\n+            ]\n \n             response = XmlResponse(\"http://example.com/index.xhtml\", body=xhtml)\n \n             lx = self.extractor_cls()\n-            self.assertEqual(\n-                lx.extract_links(response),\n-                [\n+            assert lx.extract_links(response) == [\n                 Link(\n                     url=\"http://example.com/about.html\",\n                     text=\"About us\",\n@@ -693,8 +596,7 @@ class Base:\n                     text=\"External link not to follow\",\n                     nofollow=True,\n                 ),\n-                ],\n-            )\n+            ]\n \n         def test_link_wrong_href(self):\n             html = b\"\"\"\n@@ -704,9 +606,7 @@ class Base:\n             \"\"\"\n             response = HtmlResponse(\"http://example.org/index.html\", body=html)\n             lx = self.extractor_cls()\n-            self.assertEqual(\n-                list(lx.extract_links(response)),\n-                [\n+            assert list(lx.extract_links(response)) == [\n                 Link(\n                     url=\"http://example.org/item1.html\",\n                     text=\"Item 1\",\n@@ -717,8 +617,7 @@ class Base:\n                     text=\"Item 3\",\n                     nofollow=False,\n                 ),\n-                ],\n-            )\n+            ]\n \n         def test_ftp_links(self):\n             body = b\"\"\"\n@@ -729,21 +628,18 @@ class Base:\n                 \"http://www.example.com/index.html\", body=body, encoding=\"utf8\"\n             )\n             lx = self.extractor_cls()\n-            self.assertEqual(\n-                lx.extract_links(response),\n-                [\n+            assert lx.extract_links(response) == [\n                 Link(\n                     url=\"ftp://www.external.com/\",\n                     text=\"An Item\",\n                     fragment=\"\",\n                     nofollow=False,\n                 ),\n-                ],\n-            )\n+            ]\n \n         def test_pickle_extractor(self):\n             lx = self.extractor_cls()\n-            self.assertIsInstance(pickle.loads(pickle.dumps(lx)), self.extractor_cls)\n+            assert isinstance(pickle.loads(pickle.dumps(lx)), self.extractor_cls)\n \n         def test_link_extractor_aggregation(self):\n             \"\"\"When a parameter like restrict_css is used, the underlying\n@@ -770,14 +666,11 @@ class Base:\n                 \"\"\",\n             )\n             actual = lx.extract_links(response)\n-            self.assertEqual(\n-                actual,\n-                [\n+            assert actual == [\n                 Link(url=\"https://example.com/a\", text=\"a1\"),\n                 Link(url=\"https://example.com/b?a=1&b=2\", text=\"b1\"),\n                 Link(url=\"https://example.com/b?b=2&a=1\", text=\"b2\"),\n-                ],\n-            )\n+            ]\n \n             # unique=True (default), canonicalize=True\n             lx = self.extractor_cls(restrict_css=(\"div\",), canonicalize=True)\n@@ -795,13 +688,10 @@ class Base:\n                 \"\"\",\n             )\n             actual = lx.extract_links(response)\n-            self.assertEqual(\n-                actual,\n-                [\n+            assert actual == [\n                 Link(url=\"https://example.com/a\", text=\"a1\"),\n                 Link(url=\"https://example.com/b?a=1&b=2\", text=\"b1\"),\n-                ],\n-            )\n+            ]\n \n             # unique=False, canonicalize=False (default)\n             lx = self.extractor_cls(restrict_css=(\"div\",), unique=False)\n@@ -819,15 +709,12 @@ class Base:\n                 \"\"\",\n             )\n             actual = lx.extract_links(response)\n-            self.assertEqual(\n-                actual,\n-                [\n+            assert actual == [\n                 Link(url=\"https://example.com/a\", text=\"a1\"),\n                 Link(url=\"https://example.com/b?a=1&b=2\", text=\"b1\"),\n                 Link(url=\"https://example.com/a\", text=\"a2\"),\n                 Link(url=\"https://example.com/b?b=2&a=1\", text=\"b2\"),\n-                ],\n-            )\n+            ]\n \n             # unique=False, canonicalize=True\n             lx = self.extractor_cls(\n@@ -847,18 +734,15 @@ class Base:\n                 \"\"\",\n             )\n             actual = lx.extract_links(response)\n-            self.assertEqual(\n-                actual,\n-                [\n+            assert actual == [\n                 Link(url=\"https://example.com/a\", text=\"a1\"),\n                 Link(url=\"https://example.com/b?a=1&b=2\", text=\"b1\"),\n                 Link(url=\"https://example.com/a\", text=\"a2\"),\n                 Link(url=\"https://example.com/b?a=1&b=2\", text=\"b2\"),\n-                ],\n-            )\n+            ]\n \n \n-class LxmlLinkExtractorTestCase(Base.LinkExtractorTestCase):\n+class TestLxmlLinkExtractor(Base.TestLinkExtractorBase):\n     extractor_cls = LxmlLinkExtractor\n \n     def test_link_wrong_href(self):\n@@ -869,17 +753,10 @@ class LxmlLinkExtractorTestCase(Base.LinkExtractorTestCase):\n         \"\"\"\n         response = HtmlResponse(\"http://example.org/index.html\", body=html)\n         lx = self.extractor_cls()\n-        self.assertEqual(\n-            list(lx.extract_links(response)),\n-            [\n-                Link(\n-                    url=\"http://example.org/item1.html\", text=\"Item 1\", nofollow=False\n-                ),\n-                Link(\n-                    url=\"http://example.org/item3.html\", text=\"Item 3\", nofollow=False\n-                ),\n-            ],\n-        )\n+        assert list(lx.extract_links(response)) == [\n+            Link(url=\"http://example.org/item1.html\", text=\"Item 1\", nofollow=False),\n+            Link(url=\"http://example.org/item3.html\", text=\"Item 3\", nofollow=False),\n+        ]\n \n     def test_link_restrict_text(self):\n         html = b\"\"\"\n@@ -890,33 +767,25 @@ class LxmlLinkExtractorTestCase(Base.LinkExtractorTestCase):\n         response = HtmlResponse(\"http://example.org/index.html\", body=html)\n         # Simple text inclusion test\n         lx = self.extractor_cls(restrict_text=\"dog\")\n-        self.assertEqual(\n-            list(lx.extract_links(response)),\n-            [\n+        assert list(lx.extract_links(response)) == [\n             Link(\n                 url=\"http://example.org/item2.html\",\n                 text=\"Pic of a dog\",\n                 nofollow=False,\n             ),\n-            ],\n-        )\n+        ]\n         # Unique regex test\n         lx = self.extractor_cls(restrict_text=r\"of.*dog\")\n-        self.assertEqual(\n-            list(lx.extract_links(response)),\n-            [\n+        assert list(lx.extract_links(response)) == [\n             Link(\n                 url=\"http://example.org/item2.html\",\n                 text=\"Pic of a dog\",\n                 nofollow=False,\n             ),\n-            ],\n-        )\n+        ]\n         # Multiple regex test\n         lx = self.extractor_cls(restrict_text=[r\"of.*dog\", r\"of.*cat\"])\n-        self.assertEqual(\n-            list(lx.extract_links(response)),\n-            [\n+        assert list(lx.extract_links(response)) == [\n             Link(\n                 url=\"http://example.org/item1.html\",\n                 text=\"Pic of a cat\",\n@@ -927,8 +796,7 @@ class LxmlLinkExtractorTestCase(Base.LinkExtractorTestCase):\n                 text=\"Pic of a dog\",\n                 nofollow=False,\n             ),\n-            ],\n-        )\n+        ]\n \n     @pytest.mark.skipif(\n         Version(w3lib_version) < Version(\"2.0.0\"),\n@@ -945,9 +813,7 @@ class LxmlLinkExtractorTestCase(Base.LinkExtractorTestCase):\n         \"\"\"\n         response = HtmlResponse(\"http://example.org/index.html\", body=html)\n         lx = self.extractor_cls()\n-        self.assertEqual(\n-            list(lx.extract_links(response)),\n-            [\n+        assert list(lx.extract_links(response)) == [\n             Link(\n                 url=\"http://example.org/item2.html\",\n                 text=\"Good Link\",\n@@ -958,17 +824,16 @@ class LxmlLinkExtractorTestCase(Base.LinkExtractorTestCase):\n                 text=\"Good Link 2\",\n                 nofollow=False,\n             ),\n-            ],\n-        )\n+        ]\n \n     def test_link_allowed_is_false_with_empty_url(self):\n         bad_link = Link(\"\")\n-        self.assertFalse(LxmlLinkExtractor()._link_allowed(bad_link))\n+        assert not LxmlLinkExtractor()._link_allowed(bad_link)\n \n     def test_link_allowed_is_false_with_bad_url_prefix(self):\n         bad_link = Link(\"htp://should_be_http.example\")\n-        self.assertFalse(LxmlLinkExtractor()._link_allowed(bad_link))\n+        assert not LxmlLinkExtractor()._link_allowed(bad_link)\n \n     def test_link_allowed_is_false_with_missing_url_prefix(self):\n         bad_link = Link(\"should_have_prefix.example\")\n-        self.assertFalse(LxmlLinkExtractor()._link_allowed(bad_link))\n+        assert not LxmlLinkExtractor()._link_allowed(bad_link)\n\n@@ -53,7 +53,7 @@ class RedirectedMediaDownloadSpider(MediaDownloadSpider):\n         )\n \n \n-class FileDownloadCrawlTestCase(TestCase):\n+class TestFileDownloadCrawl(TestCase):\n     pipeline_class = \"scrapy.pipelines.files.FilesPipeline\"\n     store_setting_key = \"FILES_STORE\"\n     media_key = \"files\"\n@@ -98,52 +98,46 @@ class FileDownloadCrawlTestCase(TestCase):\n         return crawler\n \n     def _assert_files_downloaded(self, items, logs):\n-        self.assertEqual(len(items), 1)\n-        self.assertIn(self.media_key, items[0])\n+        assert len(items) == 1\n+        assert self.media_key in items[0]\n \n         # check that logs show the expected number of successful file downloads\n         file_dl_success = \"File (downloaded): Downloaded file from\"\n-        self.assertEqual(logs.count(file_dl_success), 3)\n+        assert logs.count(file_dl_success) == 3\n \n         # check that the images/files status is `downloaded`\n         for item in items:\n             for i in item[self.media_key]:\n-                self.assertEqual(i[\"status\"], \"downloaded\")\n+                assert i[\"status\"] == \"downloaded\"\n \n         # check that the images/files checksums are what we know they should be\n         if self.expected_checksums is not None:\n             checksums = {i[\"checksum\"] for item in items for i in item[self.media_key]}\n-            self.assertEqual(checksums, self.expected_checksums)\n+            assert checksums == self.expected_checksums\n \n         # check that the image files where actually written to the media store\n         for item in items:\n             for i in item[self.media_key]:\n-                self.assertTrue((self.tmpmediastore / i[\"path\"]).exists())\n+                assert (self.tmpmediastore / i[\"path\"]).exists()\n \n     def _assert_files_download_failure(self, crawler, items, code, logs):\n         # check that the item does NOT have the \"images/files\" field populated\n-        self.assertEqual(len(items), 1)\n-        self.assertIn(self.media_key, items[0])\n-        self.assertFalse(items[0][self.media_key])\n+        assert len(items) == 1\n+        assert self.media_key in items[0]\n+        assert not items[0][self.media_key]\n \n         # check that there was 1 successful fetch and 3 other responses with non-200 code\n-        self.assertEqual(\n-            crawler.stats.get_value(\"downloader/request_method_count/GET\"), 4\n-        )\n-        self.assertEqual(crawler.stats.get_value(\"downloader/response_count\"), 4)\n-        self.assertEqual(\n-            crawler.stats.get_value(\"downloader/response_status_count/200\"), 1\n-        )\n-        self.assertEqual(\n-            crawler.stats.get_value(f\"downloader/response_status_count/{code}\"), 3\n-        )\n+        assert crawler.stats.get_value(\"downloader/request_method_count/GET\") == 4\n+        assert crawler.stats.get_value(\"downloader/response_count\") == 4\n+        assert crawler.stats.get_value(\"downloader/response_status_count/200\") == 1\n+        assert crawler.stats.get_value(f\"downloader/response_status_count/{code}\") == 3\n \n         # check that logs do show the failure on the file downloads\n         file_dl_failure = f\"File (code: {code}): Error downloading file from\"\n-        self.assertEqual(logs.count(file_dl_failure), 3)\n+        assert logs.count(file_dl_failure) == 3\n \n         # check that no files were written to the media store\n-        self.assertEqual(list(self.tmpmediastore.iterdir()), [])\n+        assert not list(self.tmpmediastore.iterdir())\n \n     @defer.inlineCallbacks\n     def test_download_media(self):\n@@ -193,9 +187,7 @@ class FileDownloadCrawlTestCase(TestCase):\n                 mockserver=self.mockserver,\n             )\n         self._assert_files_downloaded(self.items, str(log))\n-        self.assertEqual(\n-            crawler.stats.get_value(\"downloader/response_status_count/302\"), 3\n-        )\n+        assert crawler.stats.get_value(\"downloader/response_status_count/302\") == 3\n \n     @defer.inlineCallbacks\n     def test_download_media_file_path_error(self):\n@@ -218,7 +210,7 @@ class FileDownloadCrawlTestCase(TestCase):\n                 media_urls_key=self.media_urls_key,\n                 mockserver=self.mockserver,\n             )\n-        self.assertIn(\"ZeroDivisionError\", str(log))\n+        assert \"ZeroDivisionError\" in str(log)\n \n \n skip_pillow: str | None\n@@ -230,7 +222,7 @@ else:\n     skip_pillow = None\n \n \n-class ImageDownloadCrawlTestCase(FileDownloadCrawlTestCase):\n+class ImageDownloadCrawlTestCase(TestFileDownloadCrawl):\n     skip = skip_pillow\n \n     pipeline_class = \"scrapy.pipelines.images.ImagesPipeline\"\n\n@@ -77,7 +77,7 @@ def get_ftp_content_and_delete(\n     return b\"\".join(ftp_data)\n \n \n-class FilesPipelineTestCase(unittest.TestCase):\n+class TestFilesPipeline(unittest.TestCase):\n     def setUp(self):\n         self.tempdir = mkdtemp()\n         settings_dict = {\"FILES_STORE\": self.tempdir}\n@@ -91,73 +91,73 @@ class FilesPipelineTestCase(unittest.TestCase):\n \n     def test_file_path(self):\n         file_path = self.pipeline.file_path\n-        self.assertEqual(\n-            file_path(Request(\"https://dev.mydeco.com/mydeco.pdf\")),\n-            \"full/c9b564df929f4bc635bdd19fde4f3d4847c757c5.pdf\",\n+        assert (\n+            file_path(Request(\"https://dev.mydeco.com/mydeco.pdf\"))\n+            == \"full/c9b564df929f4bc635bdd19fde4f3d4847c757c5.pdf\"\n         )\n-        self.assertEqual(\n+        assert (\n             file_path(\n                 Request(\n                     \"http://www.maddiebrown.co.uk///catalogue-items//image_54642_12175_95307.txt\"\n                 )\n-            ),\n-            \"full/4ce274dd83db0368bafd7e406f382ae088e39219.txt\",\n             )\n-        self.assertEqual(\n+            == \"full/4ce274dd83db0368bafd7e406f382ae088e39219.txt\"\n+        )\n+        assert (\n             file_path(\n                 Request(\"https://dev.mydeco.com/two/dirs/with%20spaces%2Bsigns.doc\")\n-            ),\n-            \"full/94ccc495a17b9ac5d40e3eabf3afcb8c2c9b9e1a.doc\",\n             )\n-        self.assertEqual(\n+            == \"full/94ccc495a17b9ac5d40e3eabf3afcb8c2c9b9e1a.doc\"\n+        )\n+        assert (\n             file_path(\n                 Request(\n                     \"http://www.dfsonline.co.uk/get_prod_image.php?img=status_0907_mdm.jpg\"\n                 )\n-            ),\n-            \"full/4507be485f38b0da8a0be9eb2e1dfab8a19223f2.jpg\",\n             )\n-        self.assertEqual(\n-            file_path(Request(\"http://www.dorma.co.uk/images/product_details/2532/\")),\n-            \"full/97ee6f8a46cbbb418ea91502fd24176865cf39b2\",\n+            == \"full/4507be485f38b0da8a0be9eb2e1dfab8a19223f2.jpg\"\n         )\n-        self.assertEqual(\n-            file_path(Request(\"http://www.dorma.co.uk/images/product_details/2532\")),\n-            \"full/244e0dd7d96a3b7b01f54eded250c9e272577aa1\",\n+        assert (\n+            file_path(Request(\"http://www.dorma.co.uk/images/product_details/2532/\"))\n+            == \"full/97ee6f8a46cbbb418ea91502fd24176865cf39b2\"\n         )\n-        self.assertEqual(\n+        assert (\n+            file_path(Request(\"http://www.dorma.co.uk/images/product_details/2532\"))\n+            == \"full/244e0dd7d96a3b7b01f54eded250c9e272577aa1\"\n+        )\n+        assert (\n             file_path(\n                 Request(\"http://www.dorma.co.uk/images/product_details/2532\"),\n                 response=Response(\"http://www.dorma.co.uk/images/product_details/2532\"),\n                 info=object(),\n-            ),\n-            \"full/244e0dd7d96a3b7b01f54eded250c9e272577aa1\",\n             )\n-        self.assertEqual(\n+            == \"full/244e0dd7d96a3b7b01f54eded250c9e272577aa1\"\n+        )\n+        assert (\n             file_path(\n                 Request(\n                     \"http://www.dfsonline.co.uk/get_prod_image.php?img=status_0907_mdm.jpg.bohaha\"\n                 )\n-            ),\n-            \"full/76c00cef2ef669ae65052661f68d451162829507\",\n             )\n-        self.assertEqual(\n+            == \"full/76c00cef2ef669ae65052661f68d451162829507\"\n+        )\n+        assert (\n             file_path(\n                 Request(\n                     \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAR0AAACxCAMAAADOHZloAAACClBMVEX/\\\n                                     //+F0tzCwMK76ZKQ21AMqr7oAAC96JvD5aWM2kvZ78J0N7fmAAC46Y4Ap7y\"\n                 )\n-            ),\n-            \"full/178059cbeba2e34120a67f2dc1afc3ecc09b61cb.png\",\n+            )\n+            == \"full/178059cbeba2e34120a67f2dc1afc3ecc09b61cb.png\"\n         )\n \n     def test_fs_store(self):\n         assert isinstance(self.pipeline.store, FSFilesStore)\n-        self.assertEqual(self.pipeline.store.basedir, self.tempdir)\n+        assert self.pipeline.store.basedir == self.tempdir\n \n         path = \"some/image/key.jpg\"\n         fullpath = Path(self.tempdir, \"some\", \"image\", \"key.jpg\")\n-        self.assertEqual(self.pipeline.store._get_filesystem_path(path), fullpath)\n+        assert self.pipeline.store._get_filesystem_path(path) == fullpath\n \n     @defer.inlineCallbacks\n     def test_file_not_expired(self):\n@@ -180,8 +180,8 @@ class FilesPipelineTestCase(unittest.TestCase):\n             p.start()\n \n         result = yield self.pipeline.process_item(item, None)\n-        self.assertEqual(result[\"files\"][0][\"checksum\"], \"abc\")\n-        self.assertEqual(result[\"files\"][0][\"status\"], \"uptodate\")\n+        assert result[\"files\"][0][\"checksum\"] == \"abc\"\n+        assert result[\"files\"][0][\"status\"] == \"uptodate\"\n \n         for p in patchers:\n             p.stop()\n@@ -211,8 +211,8 @@ class FilesPipelineTestCase(unittest.TestCase):\n             p.start()\n \n         result = yield self.pipeline.process_item(item, None)\n-        self.assertNotEqual(result[\"files\"][0][\"checksum\"], \"abc\")\n-        self.assertEqual(result[\"files\"][0][\"status\"], \"downloaded\")\n+        assert result[\"files\"][0][\"checksum\"] != \"abc\"\n+        assert result[\"files\"][0][\"status\"] == \"downloaded\"\n \n         for p in patchers:\n             p.stop()\n@@ -242,8 +242,8 @@ class FilesPipelineTestCase(unittest.TestCase):\n             p.start()\n \n         result = yield self.pipeline.process_item(item, None)\n-        self.assertNotEqual(result[\"files\"][0][\"checksum\"], \"abc\")\n-        self.assertEqual(result[\"files\"][0][\"status\"], \"cached\")\n+        assert result[\"files\"][0][\"checksum\"] != \"abc\"\n+        assert result[\"files\"][0][\"status\"] == \"cached\"\n \n         for p in patchers:\n             p.stop()\n@@ -262,14 +262,14 @@ class FilesPipelineTestCase(unittest.TestCase):\n         ).file_path\n         item = {\"path\": \"path-to-store-file\"}\n         request = Request(\"http://example.com\")\n-        self.assertEqual(file_path(request, item=item), \"full/path-to-store-file\")\n+        assert file_path(request, item=item) == \"full/path-to-store-file\"\n \n \n class FilesPipelineTestCaseFieldsMixin:\n-    def setUp(self):\n+    def setup_method(self):\n         self.tempdir = mkdtemp()\n \n-    def tearDown(self):\n+    def teardown_method(self):\n         rmtree(self.tempdir)\n \n     def test_item_fields_default(self):\n@@ -279,12 +279,12 @@ class FilesPipelineTestCaseFieldsMixin:\n             get_crawler(None, {\"FILES_STORE\": self.tempdir})\n         )\n         requests = list(pipeline.get_media_requests(item, None))\n-        self.assertEqual(requests[0].url, url)\n+        assert requests[0].url == url\n         results = [(True, {\"url\": url})]\n         item = pipeline.item_completed(results, item, None)\n         files = ItemAdapter(item).get(\"files\")\n-        self.assertEqual(files, [results[0][1]])\n-        self.assertIsInstance(item, self.item_class)\n+        assert files == [results[0][1]]\n+        assert isinstance(item, self.item_class)\n \n     def test_item_fields_override_settings(self):\n         url = \"http://www.example.com/files/1.txt\"\n@@ -300,17 +300,15 @@ class FilesPipelineTestCaseFieldsMixin:\n             )\n         )\n         requests = list(pipeline.get_media_requests(item, None))\n-        self.assertEqual(requests[0].url, url)\n+        assert requests[0].url == url\n         results = [(True, {\"url\": url})]\n         item = pipeline.item_completed(results, item, None)\n         custom_files = ItemAdapter(item).get(\"custom_files\")\n-        self.assertEqual(custom_files, [results[0][1]])\n-        self.assertIsInstance(item, self.item_class)\n+        assert custom_files == [results[0][1]]\n+        assert isinstance(item, self.item_class)\n \n \n-class FilesPipelineTestCaseFieldsDict(\n-    FilesPipelineTestCaseFieldsMixin, unittest.TestCase\n-):\n+class TestFilesPipelineFieldsDict(FilesPipelineTestCaseFieldsMixin):\n     item_class = dict\n \n \n@@ -324,9 +322,7 @@ class FilesPipelineTestItem(Item):\n     custom_files = Field()\n \n \n-class FilesPipelineTestCaseFieldsItem(\n-    FilesPipelineTestCaseFieldsMixin, unittest.TestCase\n-):\n+class TestFilesPipelineFieldsItem(FilesPipelineTestCaseFieldsMixin):\n     item_class = FilesPipelineTestItem\n \n \n@@ -341,9 +337,7 @@ class FilesPipelineTestDataClass:\n     custom_files: list = dataclasses.field(default_factory=list)\n \n \n-class FilesPipelineTestCaseFieldsDataClass(\n-    FilesPipelineTestCaseFieldsMixin, unittest.TestCase\n-):\n+class TestFilesPipelineFieldsDataClass(FilesPipelineTestCaseFieldsMixin):\n     item_class = FilesPipelineTestDataClass\n \n \n@@ -358,13 +352,11 @@ class FilesPipelineTestAttrsItem:\n     custom_files: list[dict[str, str]] = attr.ib(default=list)\n \n \n-class FilesPipelineTestCaseFieldsAttrsItem(\n-    FilesPipelineTestCaseFieldsMixin, unittest.TestCase\n-):\n+class TestFilesPipelineFieldsAttrsItem(FilesPipelineTestCaseFieldsMixin):\n     item_class = FilesPipelineTestAttrsItem\n \n \n-class FilesPipelineTestCaseCustomSettings(unittest.TestCase):\n+class TestFilesPipelineCustomSettings:\n     default_cls_settings = {\n         \"EXPIRES\": 90,\n         \"FILES_URLS_FIELD\": \"file_urls\",\n@@ -376,10 +368,10 @@ class FilesPipelineTestCaseCustomSettings(unittest.TestCase):\n         (\"FILES_RESULT_FIELD\", \"FILES_RESULT_FIELD\", \"files_result_field\"),\n     }\n \n-    def setUp(self):\n+    def setup_method(self):\n         self.tempdir = mkdtemp()\n \n-    def tearDown(self):\n+    def teardown_method(self):\n         rmtree(self.tempdir)\n \n     def _generate_fake_settings(self, prefix=None):\n@@ -420,10 +412,10 @@ class FilesPipelineTestCaseCustomSettings(unittest.TestCase):\n         one_pipeline = FilesPipeline(self.tempdir, crawler=get_crawler(None))\n         for pipe_attr, settings_attr, pipe_ins_attr in self.file_cls_attr_settings_map:\n             default_value = self.default_cls_settings[pipe_attr]\n-            self.assertEqual(getattr(one_pipeline, pipe_attr), default_value)\n+            assert getattr(one_pipeline, pipe_attr) == default_value\n             custom_value = custom_settings[settings_attr]\n-            self.assertNotEqual(default_value, custom_value)\n-            self.assertEqual(getattr(another_pipeline, pipe_ins_attr), custom_value)\n+            assert default_value != custom_value\n+            assert getattr(another_pipeline, pipe_ins_attr) == custom_value\n \n     def test_subclass_attributes_preserved_if_no_settings(self):\n         \"\"\"\n@@ -433,8 +425,8 @@ class FilesPipelineTestCaseCustomSettings(unittest.TestCase):\n         pipe = pipe_cls.from_crawler(get_crawler(None, {\"FILES_STORE\": self.tempdir}))\n         for pipe_attr, settings_attr, pipe_ins_attr in self.file_cls_attr_settings_map:\n             custom_value = getattr(pipe, pipe_ins_attr)\n-            self.assertNotEqual(custom_value, self.default_cls_settings[pipe_attr])\n-            self.assertEqual(getattr(pipe, pipe_ins_attr), getattr(pipe, pipe_attr))\n+            assert custom_value != self.default_cls_settings[pipe_attr]\n+            assert getattr(pipe, pipe_ins_attr) == getattr(pipe, pipe_attr)\n \n     def test_subclass_attrs_preserved_custom_settings(self):\n         \"\"\"\n@@ -447,8 +439,8 @@ class FilesPipelineTestCaseCustomSettings(unittest.TestCase):\n         for pipe_attr, settings_attr, pipe_ins_attr in self.file_cls_attr_settings_map:\n             value = getattr(pipeline, pipe_ins_attr)\n             setting_value = settings.get(settings_attr)\n-            self.assertNotEqual(value, self.default_cls_settings[pipe_attr])\n-            self.assertEqual(value, setting_value)\n+            assert value != self.default_cls_settings[pipe_attr]\n+            assert value == setting_value\n \n     def test_no_custom_settings_for_subclasses(self):\n         \"\"\"\n@@ -465,7 +457,7 @@ class FilesPipelineTestCaseCustomSettings(unittest.TestCase):\n         for pipe_attr, settings_attr, pipe_ins_attr in self.file_cls_attr_settings_map:\n             # Values from settings for custom pipeline should be set on pipeline instance.\n             custom_value = self.default_cls_settings.get(pipe_attr.upper())\n-            self.assertEqual(getattr(user_pipeline, pipe_ins_attr), custom_value)\n+            assert getattr(user_pipeline, pipe_ins_attr) == custom_value\n \n     def test_custom_settings_for_subclasses(self):\n         \"\"\"\n@@ -484,8 +476,8 @@ class FilesPipelineTestCaseCustomSettings(unittest.TestCase):\n         for pipe_attr, settings_attr, pipe_inst_attr in self.file_cls_attr_settings_map:\n             # Values from settings for custom pipeline should be set on pipeline instance.\n             custom_value = settings.get(prefix + \"_\" + settings_attr)\n-            self.assertNotEqual(custom_value, self.default_cls_settings[pipe_attr])\n-            self.assertEqual(getattr(user_pipeline, pipe_inst_attr), custom_value)\n+            assert custom_value != self.default_cls_settings[pipe_attr]\n+            assert getattr(user_pipeline, pipe_inst_attr) == custom_value\n \n     def test_custom_settings_and_class_attrs_for_subclasses(self):\n         \"\"\"\n@@ -502,8 +494,8 @@ class FilesPipelineTestCaseCustomSettings(unittest.TestCase):\n             pipe_inst_attr,\n         ) in self.file_cls_attr_settings_map:\n             custom_value = settings.get(prefix + \"_\" + settings_attr)\n-            self.assertNotEqual(custom_value, self.default_cls_settings[pipe_cls_attr])\n-            self.assertEqual(getattr(user_pipeline, pipe_inst_attr), custom_value)\n+            assert custom_value != self.default_cls_settings[pipe_cls_attr]\n+            assert getattr(user_pipeline, pipe_inst_attr) == custom_value\n \n     def test_cls_attrs_with_DEFAULT_prefix(self):\n         class UserDefinedFilesPipeline(FilesPipeline):\n@@ -513,12 +505,13 @@ class FilesPipelineTestCaseCustomSettings(unittest.TestCase):\n         pipeline = UserDefinedFilesPipeline.from_crawler(\n             get_crawler(None, {\"FILES_STORE\": self.tempdir})\n         )\n-        self.assertEqual(\n-            pipeline.files_result_field,\n-            UserDefinedFilesPipeline.DEFAULT_FILES_RESULT_FIELD,\n+        assert (\n+            pipeline.files_result_field\n+            == UserDefinedFilesPipeline.DEFAULT_FILES_RESULT_FIELD\n         )\n-        self.assertEqual(\n-            pipeline.files_urls_field, UserDefinedFilesPipeline.DEFAULT_FILES_URLS_FIELD\n+        assert (\n+            pipeline.files_urls_field\n+            == UserDefinedFilesPipeline.DEFAULT_FILES_URLS_FIELD\n         )\n \n     def test_user_defined_subclass_default_key_names(self):\n@@ -535,7 +528,7 @@ class FilesPipelineTestCaseCustomSettings(unittest.TestCase):\n \n         for pipe_attr, settings_attr, pipe_inst_attr in self.file_cls_attr_settings_map:\n             expected_value = settings.get(settings_attr)\n-            self.assertEqual(getattr(pipeline_cls, pipe_inst_attr), expected_value)\n+            assert getattr(pipeline_cls, pipe_inst_attr) == expected_value\n \n     def test_file_pipeline_using_pathlike_objects(self):\n         class CustomFilesPipelineWithPathLikeDir(FilesPipeline):\n@@ -546,12 +539,12 @@ class FilesPipelineTestCaseCustomSettings(unittest.TestCase):\n             get_crawler(None, {\"FILES_STORE\": Path(\"./Temp\")})\n         )\n         request = Request(\"http://example.com/image01.jpg\")\n-        self.assertEqual(pipeline.file_path(request), Path(\"subdir/image01.jpg\"))\n+        assert pipeline.file_path(request) == Path(\"subdir/image01.jpg\")\n \n     def test_files_store_constructor_with_pathlike_object(self):\n         path = Path(\"./FileDir\")\n         fs_store = FSFilesStore(path)\n-        self.assertEqual(fs_store.basedir, str(path))\n+        assert fs_store.basedir == str(path)\n \n \n @pytest.mark.requires_botocore\n@@ -593,13 +586,8 @@ class TestS3FilesStore(unittest.TestCase):\n             )\n \n             stub.assert_no_pending_responses()\n-            self.assertEqual(\n-                buffer.method_calls,\n-                [\n-                    mock.call.seek(0),\n             # The call to read does not happen with Stubber\n-                ],\n-            )\n+            assert buffer.method_calls == [mock.call.seek(0)]\n \n     @defer.inlineCallbacks\n     def test_stat(self):\n@@ -626,13 +614,10 @@ class TestS3FilesStore(unittest.TestCase):\n             )\n \n             file_stats = yield store.stat_file(\"\", info=None)\n-            self.assertEqual(\n-                file_stats,\n-                {\n+            assert file_stats == {\n                 \"checksum\": checksum,\n                 \"last_modified\": last_modified.timestamp(),\n-                },\n-            )\n+            }\n \n             stub.assert_no_pending_responses()\n \n@@ -655,16 +640,16 @@ class TestGCSFilesStore(unittest.TestCase):\n         expected_policy = {\"role\": \"READER\", \"entity\": \"allAuthenticatedUsers\"}\n         yield store.persist_file(path, buf, info=None, meta=meta, headers=None)\n         s = yield store.stat_file(path, info=None)\n-        self.assertIn(\"last_modified\", s)\n-        self.assertIn(\"checksum\", s)\n-        self.assertEqual(s[\"checksum\"], \"cdcda85605e46d0af6110752770dce3c\")\n+        assert \"last_modified\" in s\n+        assert \"checksum\" in s\n+        assert s[\"checksum\"] == \"cdcda85605e46d0af6110752770dce3c\"\n         u = urlparse(uri)\n         content, acl, blob = get_gcs_content_and_delete(u.hostname, u.path[1:] + path)\n-        self.assertEqual(content, data)\n-        self.assertEqual(blob.metadata, {\"foo\": \"bar\"})\n-        self.assertEqual(blob.cache_control, GCSFilesStore.CACHE_CONTROL)\n-        self.assertEqual(blob.content_type, \"application/octet-stream\")\n-        self.assertIn(expected_policy, acl)\n+        assert content == data\n+        assert blob.metadata == {\"foo\": \"bar\"}\n+        assert blob.cache_control == GCSFilesStore.CACHE_CONTROL\n+        assert blob.content_type == \"application/octet-stream\"\n+        assert expected_policy in acl\n \n     @defer.inlineCallbacks\n     def test_blob_path_consistency(self):\n@@ -702,12 +687,12 @@ class TestFTPFileStore(unittest.TestCase):\n         with MockFTPServer() as ftp_server:\n             store = FTPFilesStore(ftp_server.url(\"/\"))\n             empty_dict = yield store.stat_file(path, info=None)\n-            self.assertEqual(empty_dict, {})\n+            assert empty_dict == {}\n             yield store.persist_file(path, buf, info=None, meta=meta, headers=None)\n             stat = yield store.stat_file(path, info=None)\n-            self.assertIn(\"last_modified\", stat)\n-            self.assertIn(\"checksum\", stat)\n-            self.assertEqual(stat[\"checksum\"], \"d113d66b2ec7258724a268bd88eef6b6\")\n+            assert \"last_modified\" in stat\n+            assert \"checksum\" in stat\n+            assert stat[\"checksum\"] == \"d113d66b2ec7258724a268bd88eef6b6\"\n             path = f\"{store.basedir}/{path}\"\n             content = get_ftp_content_and_delete(\n                 path,\n@@ -717,7 +702,7 @@ class TestFTPFileStore(unittest.TestCase):\n                 store.password,\n                 store.USE_ACTIVE_MODE,\n             )\n-        self.assertEqual(data, content)\n+        assert data == content\n \n \n class ItemWithFiles(Item):\n@@ -739,12 +724,12 @@ def _prepare_request_object(item_url, flags=None):\n \n \n # this is separate from the one in test_pipeline_media.py to specifically test FilesPipeline subclasses\n-class BuildFromCrawlerTestCase(unittest.TestCase):\n-    def setUp(self):\n+class TestBuildFromCrawler:\n+    def setup_method(self):\n         self.tempdir = mkdtemp()\n         self.crawler = get_crawler(None, {\"FILES_STORE\": self.tempdir})\n \n-    def tearDown(self):\n+    def teardown_method(self):\n         rmtree(self.tempdir)\n \n     def test_simple(self):\n@@ -755,7 +740,7 @@ class BuildFromCrawlerTestCase(unittest.TestCase):\n             pipe = Pipeline.from_crawler(self.crawler)\n             assert pipe.crawler == self.crawler\n             assert pipe._fingerprinter\n-            self.assertEqual(len(w), 0)\n+            assert len(w) == 0\n             assert pipe.store\n \n     def test_has_old_init(self):\n@@ -768,7 +753,7 @@ class BuildFromCrawlerTestCase(unittest.TestCase):\n             pipe = Pipeline.from_crawler(self.crawler)\n             assert pipe.crawler == self.crawler\n             assert pipe._fingerprinter\n-            self.assertEqual(len(w), 2)\n+            assert len(w) == 2\n             assert pipe._init_called\n \n     def test_has_from_settings(self):\n@@ -785,7 +770,7 @@ class BuildFromCrawlerTestCase(unittest.TestCase):\n             pipe = Pipeline.from_crawler(self.crawler)\n             assert pipe.crawler == self.crawler\n             assert pipe._fingerprinter\n-            self.assertEqual(len(w), 3)\n+            assert len(w) == 3\n             assert pipe.store\n             assert pipe._from_settings_called\n \n@@ -805,6 +790,6 @@ class BuildFromCrawlerTestCase(unittest.TestCase):\n             pipe = Pipeline.from_crawler(self.crawler)\n             assert pipe.crawler == self.crawler\n             assert pipe._fingerprinter\n-            self.assertEqual(len(w), 0)\n+            assert len(w) == 0\n             assert pipe.store\n             assert pipe._from_crawler_called\n\n@@ -9,109 +9,106 @@ from tempfile import mkdtemp\n import attr\n import pytest\n from itemadapter import ItemAdapter\n-from twisted.trial import unittest\n \n from scrapy.http import Request, Response\n from scrapy.item import Field, Item\n from scrapy.pipelines.images import ImageException, ImagesPipeline\n from scrapy.utils.test import get_crawler\n \n-skip_pillow: str | None\n try:\n     from PIL import Image\n except ImportError:\n-    skip_pillow = \"Missing Python Imaging Library, install https://pypi.org/pypi/Pillow\"\n+    pytest.skip(\n+        \"Missing Python Imaging Library, install https://pypi.org/pypi/Pillow\",\n+        allow_module_level=True,\n+    )\n else:\n     encoders = {\"jpeg_encoder\", \"jpeg_decoder\"}\n     if not encoders.issubset(set(Image.core.__dict__)):  # type: ignore[attr-defined]\n-        skip_pillow = \"Missing JPEG encoders\"\n-    else:\n-        skip_pillow = None\n+        pytest.skip(\"Missing JPEG encoders\", allow_module_level=True)\n \n \n-class ImagesPipelineTestCase(unittest.TestCase):\n-    skip = skip_pillow\n-\n-    def setUp(self):\n+class TestImagesPipeline:\n+    def setup_method(self):\n         self.tempdir = mkdtemp()\n         crawler = get_crawler()\n         self.pipeline = ImagesPipeline(self.tempdir, crawler=crawler)\n \n-    def tearDown(self):\n+    def teardown_method(self):\n         rmtree(self.tempdir)\n \n     def test_file_path(self):\n         file_path = self.pipeline.file_path\n-        self.assertEqual(\n-            file_path(Request(\"https://dev.mydeco.com/mydeco.gif\")),\n-            \"full/3fd165099d8e71b8a48b2683946e64dbfad8b52d.jpg\",\n+        assert (\n+            file_path(Request(\"https://dev.mydeco.com/mydeco.gif\"))\n+            == \"full/3fd165099d8e71b8a48b2683946e64dbfad8b52d.jpg\"\n         )\n-        self.assertEqual(\n+        assert (\n             file_path(\n                 Request(\n                     \"http://www.maddiebrown.co.uk///catalogue-items//image_54642_12175_95307.jpg\"\n                 )\n-            ),\n-            \"full/0ffcd85d563bca45e2f90becd0ca737bc58a00b2.jpg\",\n             )\n-        self.assertEqual(\n+            == \"full/0ffcd85d563bca45e2f90becd0ca737bc58a00b2.jpg\"\n+        )\n+        assert (\n             file_path(\n                 Request(\"https://dev.mydeco.com/two/dirs/with%20spaces%2Bsigns.gif\")\n-            ),\n-            \"full/b250e3a74fff2e4703e310048a5b13eba79379d2.jpg\",\n             )\n-        self.assertEqual(\n+            == \"full/b250e3a74fff2e4703e310048a5b13eba79379d2.jpg\"\n+        )\n+        assert (\n             file_path(\n                 Request(\n                     \"http://www.dfsonline.co.uk/get_prod_image.php?img=status_0907_mdm.jpg\"\n                 )\n-            ),\n-            \"full/4507be485f38b0da8a0be9eb2e1dfab8a19223f2.jpg\",\n             )\n-        self.assertEqual(\n-            file_path(Request(\"http://www.dorma.co.uk/images/product_details/2532/\")),\n-            \"full/97ee6f8a46cbbb418ea91502fd24176865cf39b2.jpg\",\n+            == \"full/4507be485f38b0da8a0be9eb2e1dfab8a19223f2.jpg\"\n         )\n-        self.assertEqual(\n-            file_path(Request(\"http://www.dorma.co.uk/images/product_details/2532\")),\n-            \"full/244e0dd7d96a3b7b01f54eded250c9e272577aa1.jpg\",\n+        assert (\n+            file_path(Request(\"http://www.dorma.co.uk/images/product_details/2532/\"))\n+            == \"full/97ee6f8a46cbbb418ea91502fd24176865cf39b2.jpg\"\n         )\n-        self.assertEqual(\n+        assert (\n+            file_path(Request(\"http://www.dorma.co.uk/images/product_details/2532\"))\n+            == \"full/244e0dd7d96a3b7b01f54eded250c9e272577aa1.jpg\"\n+        )\n+        assert (\n             file_path(\n                 Request(\"http://www.dorma.co.uk/images/product_details/2532\"),\n                 response=Response(\"http://www.dorma.co.uk/images/product_details/2532\"),\n                 info=object(),\n-            ),\n-            \"full/244e0dd7d96a3b7b01f54eded250c9e272577aa1.jpg\",\n+            )\n+            == \"full/244e0dd7d96a3b7b01f54eded250c9e272577aa1.jpg\"\n         )\n \n     def test_thumbnail_name(self):\n         thumb_path = self.pipeline.thumb_path\n         name = \"50\"\n-        self.assertEqual(\n-            thumb_path(Request(\"file:///tmp/foo.jpg\"), name),\n-            \"thumbs/50/38a86208c36e59d4404db9e37ce04be863ef0335.jpg\",\n+        assert (\n+            thumb_path(Request(\"file:///tmp/foo.jpg\"), name)\n+            == \"thumbs/50/38a86208c36e59d4404db9e37ce04be863ef0335.jpg\"\n         )\n-        self.assertEqual(\n-            thumb_path(Request(\"file://foo.png\"), name),\n-            \"thumbs/50/e55b765eba0ec7348e50a1df496040449071b96a.jpg\",\n+        assert (\n+            thumb_path(Request(\"file://foo.png\"), name)\n+            == \"thumbs/50/e55b765eba0ec7348e50a1df496040449071b96a.jpg\"\n         )\n-        self.assertEqual(\n-            thumb_path(Request(\"file:///tmp/foo\"), name),\n-            \"thumbs/50/0329ad83ebb8e93ea7c7906d46e9ed55f7349a50.jpg\",\n+        assert (\n+            thumb_path(Request(\"file:///tmp/foo\"), name)\n+            == \"thumbs/50/0329ad83ebb8e93ea7c7906d46e9ed55f7349a50.jpg\"\n         )\n-        self.assertEqual(\n-            thumb_path(Request(\"file:///tmp/some.name/foo\"), name),\n-            \"thumbs/50/850233df65a5b83361798f532f1fc549cd13cbe9.jpg\",\n+        assert (\n+            thumb_path(Request(\"file:///tmp/some.name/foo\"), name)\n+            == \"thumbs/50/850233df65a5b83361798f532f1fc549cd13cbe9.jpg\"\n         )\n-        self.assertEqual(\n+        assert (\n             thumb_path(\n                 Request(\"file:///tmp/some.name/foo\"),\n                 name,\n                 response=Response(\"file:///tmp/some.name/foo\"),\n                 info=object(),\n-            ),\n-            \"thumbs/50/850233df65a5b83361798f532f1fc549cd13cbe9.jpg\",\n+            )\n+            == \"thumbs/50/850233df65a5b83361798f532f1fc549cd13cbe9.jpg\"\n         )\n \n     def test_thumbnail_name_from_item(self):\n@@ -130,8 +127,8 @@ class ImagesPipelineTestCase(unittest.TestCase):\n         ).thumb_path\n         item = {\"path\": \"path-to-store-file\"}\n         request = Request(\"http://example.com\")\n-        self.assertEqual(\n-            thumb_path(request, \"small\", item=item), \"thumb/small/path-to-store-file\"\n+        assert (\n+            thumb_path(request, \"small\", item=item) == \"thumb/small/path-to-store-file\"\n         )\n \n     def test_get_images_exception(self):\n@@ -169,16 +166,13 @@ class ImagesPipelineTestCase(unittest.TestCase):\n         )\n \n         path, new_im, new_buf = next(get_images_gen)\n-        self.assertEqual(path, \"full/3fd165099d8e71b8a48b2683946e64dbfad8b52d.jpg\")\n-        self.assertEqual(orig_im, new_im)\n-        self.assertEqual(buf.getvalue(), new_buf.getvalue())\n+        assert path == \"full/3fd165099d8e71b8a48b2683946e64dbfad8b52d.jpg\"\n+        assert orig_im == new_im\n+        assert buf.getvalue() == new_buf.getvalue()\n \n         thumb_path, thumb_img, thumb_buf = next(get_images_gen)\n-        self.assertEqual(\n-            thumb_path, \"thumbs/small/3fd165099d8e71b8a48b2683946e64dbfad8b52d.jpg\"\n-        )\n-        self.assertEqual(thumb_img, thumb_img)\n-        self.assertEqual(orig_thumb_buf.getvalue(), thumb_buf.getvalue())\n+        assert thumb_path == \"thumbs/small/3fd165099d8e71b8a48b2683946e64dbfad8b52d.jpg\"\n+        assert orig_thumb_buf.getvalue() == thumb_buf.getvalue()\n \n     def test_convert_image(self):\n         SIZE = (100, 100)\n@@ -186,37 +180,35 @@ class ImagesPipelineTestCase(unittest.TestCase):\n         COLOUR = (0, 127, 255)\n         im, buf = _create_image(\"JPEG\", \"RGB\", SIZE, COLOUR)\n         converted, converted_buf = self.pipeline.convert_image(im, response_body=buf)\n-        self.assertEqual(converted.mode, \"RGB\")\n-        self.assertEqual(converted.getcolors(), [(10000, COLOUR)])\n+        assert converted.mode == \"RGB\"\n+        assert converted.getcolors() == [(10000, COLOUR)]\n         # check that we don't convert JPEGs again\n-        self.assertEqual(converted_buf, buf)\n+        assert converted_buf == buf\n \n         # check that thumbnail keep image ratio\n         thumbnail, _ = self.pipeline.convert_image(\n             converted, size=(10, 25), response_body=converted_buf\n         )\n-        self.assertEqual(thumbnail.mode, \"RGB\")\n-        self.assertEqual(thumbnail.size, (10, 10))\n+        assert thumbnail.mode == \"RGB\"\n+        assert thumbnail.size == (10, 10)\n \n         # transparency case: RGBA and PNG\n         COLOUR = (0, 127, 255, 50)\n         im, buf = _create_image(\"PNG\", \"RGBA\", SIZE, COLOUR)\n         converted, _ = self.pipeline.convert_image(im, response_body=buf)\n-        self.assertEqual(converted.mode, \"RGB\")\n-        self.assertEqual(converted.getcolors(), [(10000, (205, 230, 255))])\n+        assert converted.mode == \"RGB\"\n+        assert converted.getcolors() == [(10000, (205, 230, 255))]\n \n         # transparency case with palette: P and PNG\n         COLOUR = (0, 127, 255, 50)\n         im, buf = _create_image(\"PNG\", \"RGBA\", SIZE, COLOUR)\n         im = im.convert(\"P\")\n         converted, _ = self.pipeline.convert_image(im, response_body=buf)\n-        self.assertEqual(converted.mode, \"RGB\")\n-        self.assertEqual(converted.getcolors(), [(10000, (205, 230, 255))])\n+        assert converted.mode == \"RGB\"\n+        assert converted.getcolors() == [(10000, (205, 230, 255))]\n \n \n class ImagesPipelineTestCaseFieldsMixin:\n-    skip = skip_pillow\n-\n     def test_item_fields_default(self):\n         url = \"http://www.example.com/images/1.jpg\"\n         item = self.item_class(name=\"item1\", image_urls=[url])\n@@ -224,12 +216,12 @@ class ImagesPipelineTestCaseFieldsMixin:\n             get_crawler(None, {\"IMAGES_STORE\": \"s3://example/images/\"})\n         )\n         requests = list(pipeline.get_media_requests(item, None))\n-        self.assertEqual(requests[0].url, url)\n+        assert requests[0].url == url\n         results = [(True, {\"url\": url})]\n         item = pipeline.item_completed(results, item, None)\n         images = ItemAdapter(item).get(\"images\")\n-        self.assertEqual(images, [results[0][1]])\n-        self.assertIsInstance(item, self.item_class)\n+        assert images == [results[0][1]]\n+        assert isinstance(item, self.item_class)\n \n     def test_item_fields_override_settings(self):\n         url = \"http://www.example.com/images/1.jpg\"\n@@ -245,17 +237,15 @@ class ImagesPipelineTestCaseFieldsMixin:\n             )\n         )\n         requests = list(pipeline.get_media_requests(item, None))\n-        self.assertEqual(requests[0].url, url)\n+        assert requests[0].url == url\n         results = [(True, {\"url\": url})]\n         item = pipeline.item_completed(results, item, None)\n         custom_images = ItemAdapter(item).get(\"custom_images\")\n-        self.assertEqual(custom_images, [results[0][1]])\n-        self.assertIsInstance(item, self.item_class)\n+        assert custom_images == [results[0][1]]\n+        assert isinstance(item, self.item_class)\n \n \n-class ImagesPipelineTestCaseFieldsDict(\n-    ImagesPipelineTestCaseFieldsMixin, unittest.TestCase\n-):\n+class TestImagesPipelineFieldsDict(ImagesPipelineTestCaseFieldsMixin):\n     item_class = dict\n \n \n@@ -269,9 +259,7 @@ class ImagesPipelineTestItem(Item):\n     custom_images = Field()\n \n \n-class ImagesPipelineTestCaseFieldsItem(\n-    ImagesPipelineTestCaseFieldsMixin, unittest.TestCase\n-):\n+class TestImagesPipelineFieldsItem(ImagesPipelineTestCaseFieldsMixin):\n     item_class = ImagesPipelineTestItem\n \n \n@@ -286,9 +274,7 @@ class ImagesPipelineTestDataClass:\n     custom_images: list = dataclasses.field(default_factory=list)\n \n \n-class ImagesPipelineTestCaseFieldsDataClass(\n-    ImagesPipelineTestCaseFieldsMixin, unittest.TestCase\n-):\n+class TestImagesPipelineFieldsDataClass(ImagesPipelineTestCaseFieldsMixin):\n     item_class = ImagesPipelineTestDataClass\n \n \n@@ -303,15 +289,11 @@ class ImagesPipelineTestAttrsItem:\n     custom_images: list[dict[str, str]] = attr.ib(default=list)\n \n \n-class ImagesPipelineTestCaseFieldsAttrsItem(\n-    ImagesPipelineTestCaseFieldsMixin, unittest.TestCase\n-):\n+class TestImagesPipelineFieldsAttrsItem(ImagesPipelineTestCaseFieldsMixin):\n     item_class = ImagesPipelineTestAttrsItem\n \n \n-class ImagesPipelineTestCaseCustomSettings(unittest.TestCase):\n-    skip = skip_pillow\n-\n+class TestImagesPipelineCustomSettings:\n     img_cls_attribute_names = [\n         # Pipeline attribute names with corresponding setting names.\n         (\"EXPIRES\", \"IMAGES_EXPIRES\"),\n@@ -332,10 +314,10 @@ class ImagesPipelineTestCaseCustomSettings(unittest.TestCase):\n         \"IMAGES_RESULT_FIELD\": \"images\",\n     }\n \n-    def setUp(self):\n+    def setup_method(self):\n         self.tempdir = mkdtemp()\n \n-    def tearDown(self):\n+    def teardown_method(self):\n         rmtree(self.tempdir)\n \n     def _generate_fake_settings(self, prefix=None):\n@@ -397,11 +379,11 @@ class ImagesPipelineTestCaseCustomSettings(unittest.TestCase):\n         for pipe_attr, settings_attr in self.img_cls_attribute_names:\n             expected_default_value = self.default_pipeline_settings.get(pipe_attr)\n             custom_value = custom_settings.get(settings_attr)\n-            self.assertNotEqual(expected_default_value, custom_value)\n-            self.assertEqual(\n-                getattr(default_sts_pipe, pipe_attr.lower()), expected_default_value\n+            assert expected_default_value != custom_value\n+            assert (\n+                getattr(default_sts_pipe, pipe_attr.lower()) == expected_default_value\n             )\n-            self.assertEqual(getattr(user_sts_pipe, pipe_attr.lower()), custom_value)\n+            assert getattr(user_sts_pipe, pipe_attr.lower()) == custom_value\n \n     def test_subclass_attrs_preserved_default_settings(self):\n         \"\"\"\n@@ -415,8 +397,8 @@ class ImagesPipelineTestCaseCustomSettings(unittest.TestCase):\n         for pipe_attr, settings_attr in self.img_cls_attribute_names:\n             # Instance attribute (lowercase) must be equal to class attribute (uppercase).\n             attr_value = getattr(pipeline, pipe_attr.lower())\n-            self.assertNotEqual(attr_value, self.default_pipeline_settings[pipe_attr])\n-            self.assertEqual(attr_value, getattr(pipeline, pipe_attr))\n+            assert attr_value != self.default_pipeline_settings[pipe_attr]\n+            assert attr_value == getattr(pipeline, pipe_attr)\n \n     def test_subclass_attrs_preserved_custom_settings(self):\n         \"\"\"\n@@ -430,9 +412,9 @@ class ImagesPipelineTestCaseCustomSettings(unittest.TestCase):\n             # Instance attribute (lowercase) must be equal to\n             # value defined in settings.\n             value = getattr(pipeline, pipe_attr.lower())\n-            self.assertNotEqual(value, self.default_pipeline_settings[pipe_attr])\n+            assert value != self.default_pipeline_settings[pipe_attr]\n             setings_value = settings.get(settings_attr)\n-            self.assertEqual(value, setings_value)\n+            assert value == setings_value\n \n     def test_no_custom_settings_for_subclasses(self):\n         \"\"\"\n@@ -449,7 +431,7 @@ class ImagesPipelineTestCaseCustomSettings(unittest.TestCase):\n         for pipe_attr, settings_attr in self.img_cls_attribute_names:\n             # Values from settings for custom pipeline should be set on pipeline instance.\n             custom_value = self.default_pipeline_settings.get(pipe_attr.upper())\n-            self.assertEqual(getattr(user_pipeline, pipe_attr.lower()), custom_value)\n+            assert getattr(user_pipeline, pipe_attr.lower()) == custom_value\n \n     def test_custom_settings_for_subclasses(self):\n         \"\"\"\n@@ -468,8 +450,8 @@ class ImagesPipelineTestCaseCustomSettings(unittest.TestCase):\n         for pipe_attr, settings_attr in self.img_cls_attribute_names:\n             # Values from settings for custom pipeline should be set on pipeline instance.\n             custom_value = settings.get(prefix + \"_\" + settings_attr)\n-            self.assertNotEqual(custom_value, self.default_pipeline_settings[pipe_attr])\n-            self.assertEqual(getattr(user_pipeline, pipe_attr.lower()), custom_value)\n+            assert custom_value != self.default_pipeline_settings[pipe_attr]\n+            assert getattr(user_pipeline, pipe_attr.lower()) == custom_value\n \n     def test_custom_settings_and_class_attrs_for_subclasses(self):\n         \"\"\"\n@@ -482,8 +464,8 @@ class ImagesPipelineTestCaseCustomSettings(unittest.TestCase):\n         user_pipeline = pipeline_cls.from_crawler(get_crawler(None, settings))\n         for pipe_attr, settings_attr in self.img_cls_attribute_names:\n             custom_value = settings.get(prefix + \"_\" + settings_attr)\n-            self.assertNotEqual(custom_value, self.default_pipeline_settings[pipe_attr])\n-            self.assertEqual(getattr(user_pipeline, pipe_attr.lower()), custom_value)\n+            assert custom_value != self.default_pipeline_settings[pipe_attr]\n+            assert getattr(user_pipeline, pipe_attr.lower()) == custom_value\n \n     def test_cls_attrs_with_DEFAULT_prefix(self):\n         class UserDefinedImagePipeline(ImagesPipeline):\n@@ -493,13 +475,13 @@ class ImagesPipelineTestCaseCustomSettings(unittest.TestCase):\n         pipeline = UserDefinedImagePipeline.from_crawler(\n             get_crawler(None, {\"IMAGES_STORE\": self.tempdir})\n         )\n-        self.assertEqual(\n-            pipeline.images_result_field,\n-            UserDefinedImagePipeline.DEFAULT_IMAGES_RESULT_FIELD,\n+        assert (\n+            pipeline.images_result_field\n+            == UserDefinedImagePipeline.DEFAULT_IMAGES_RESULT_FIELD\n         )\n-        self.assertEqual(\n-            pipeline.images_urls_field,\n-            UserDefinedImagePipeline.DEFAULT_IMAGES_URLS_FIELD,\n+        assert (\n+            pipeline.images_urls_field\n+            == UserDefinedImagePipeline.DEFAULT_IMAGES_URLS_FIELD\n         )\n \n     def test_user_defined_subclass_default_key_names(self):\n@@ -516,7 +498,7 @@ class ImagesPipelineTestCaseCustomSettings(unittest.TestCase):\n \n         for pipe_attr, settings_attr in self.img_cls_attribute_names:\n             expected_value = settings.get(settings_attr)\n-            self.assertEqual(getattr(pipeline_cls, pipe_attr.lower()), expected_value)\n+            assert getattr(pipeline_cls, pipe_attr.lower()) == expected_value\n \n \n def _create_image(format, *a, **kw):\n\n@@ -2,6 +2,7 @@ from __future__ import annotations\n \n import warnings\n \n+import pytest\n from testfixtures import LogCapture\n from twisted.internet import reactor\n from twisted.internet.defer import Deferred, inlineCallbacks\n@@ -18,15 +19,6 @@ from scrapy.utils.log import failure_to_exc_info\n from scrapy.utils.signal import disconnect_all\n from scrapy.utils.test import get_crawler\n \n-try:\n-    from PIL import Image  # noqa: F401\n-except ImportError:\n-    skip_pillow: str | None = (\n-        \"Missing Python Imaging Library, install https://pypi.org/pypi/Pillow\"\n-    )\n-else:\n-    skip_pillow = None\n-\n \n def _mocked_download_func(request, info):\n     assert request.callback is NO_CALLBACK\n@@ -51,7 +43,7 @@ class UserDefinedPipeline(MediaPipeline):\n         return \"\"\n \n \n-class BaseMediaPipelineTestCase(unittest.TestCase):\n+class TestBaseMediaPipeline(unittest.TestCase):\n     pipeline_class = UserDefinedPipeline\n     settings = None\n \n@@ -123,9 +115,9 @@ class BaseMediaPipelineTestCase(unittest.TestCase):\n                 failure = Failure(file_exc)\n \n         # The Failure should encapsulate a FileException ...\n-        self.assertEqual(failure.value, file_exc)\n+        assert failure.value == file_exc\n         # ... and it should have the StopIteration exception set as its context\n-        self.assertEqual(failure.value.__context__, def_gen_return_exc)\n+        assert failure.value.__context__ == def_gen_return_exc\n \n         # Let's calculate the request fingerprint and fake some runtime data...\n         fp = self.fingerprint(request)\n@@ -136,12 +128,12 @@ class BaseMediaPipelineTestCase(unittest.TestCase):\n         # When calling the method that caches the Request's result ...\n         self.pipe._cache_result_and_execute_waiters(failure, fp, info)\n         # ... it should store the Twisted Failure ...\n-        self.assertEqual(info.downloaded[fp], failure)\n+        assert info.downloaded[fp] == failure\n         # ... encapsulating the original FileException ...\n-        self.assertEqual(info.downloaded[fp].value, file_exc)\n+        assert info.downloaded[fp].value == file_exc\n         # ... but it should not store the StopIteration exception on its context\n         context = getattr(info.downloaded[fp].value, \"__context__\", None)\n-        self.assertIsNone(context)\n+        assert context is None\n \n     def test_default_item_completed(self):\n         item = {\"name\": \"name\"}\n@@ -158,7 +150,7 @@ class BaseMediaPipelineTestCase(unittest.TestCase):\n         assert len(log.records) == 1\n         record = log.records[0]\n         assert record.levelname == \"ERROR\"\n-        self.assertTupleEqual(record.exc_info, failure_to_exc_info(fail))\n+        assert record.exc_info == failure_to_exc_info(fail)\n \n         # disable failure logging and check again\n         self.pipe.LOG_FAILED_RESULTS = False\n@@ -208,7 +200,7 @@ class MockedMediaPipeline(UserDefinedPipeline):\n         return item\n \n \n-class MediaPipelineTestCase(BaseMediaPipelineTestCase):\n+class TestMediaPipeline(TestBaseMediaPipeline):\n     pipeline_class = MockedMediaPipeline\n \n     def _errback(self, result):\n@@ -225,16 +217,13 @@ class MediaPipelineTestCase(BaseMediaPipelineTestCase):\n         )\n         item = {\"requests\": req}\n         new_item = yield self.pipe.process_item(item, self.spider)\n-        self.assertEqual(new_item[\"results\"], [(True, {})])\n-        self.assertEqual(\n-            self.pipe._mockcalled,\n-            [\n+        assert new_item[\"results\"] == [(True, {})]\n+        assert self.pipe._mockcalled == [\n             \"get_media_requests\",\n             \"media_to_download\",\n             \"media_downloaded\",\n             \"item_completed\",\n-            ],\n-        )\n+        ]\n \n     @inlineCallbacks\n     def test_result_failure(self):\n@@ -247,17 +236,14 @@ class MediaPipelineTestCase(BaseMediaPipelineTestCase):\n         )\n         item = {\"requests\": req}\n         new_item = yield self.pipe.process_item(item, self.spider)\n-        self.assertEqual(new_item[\"results\"], [(False, fail)])\n-        self.assertEqual(\n-            self.pipe._mockcalled,\n-            [\n+        assert new_item[\"results\"] == [(False, fail)]\n+        assert self.pipe._mockcalled == [\n             \"get_media_requests\",\n             \"media_to_download\",\n             \"media_failed\",\n             \"request_errback\",\n             \"item_completed\",\n-            ],\n-        )\n+        ]\n \n     @inlineCallbacks\n     def test_mix_of_success_and_failure(self):\n@@ -268,18 +254,18 @@ class MediaPipelineTestCase(BaseMediaPipelineTestCase):\n         req2 = Request(\"http://url2\", meta={\"response\": fail})\n         item = {\"requests\": [req1, req2]}\n         new_item = yield self.pipe.process_item(item, self.spider)\n-        self.assertEqual(new_item[\"results\"], [(True, {}), (False, fail)])\n+        assert new_item[\"results\"] == [(True, {}), (False, fail)]\n         m = self.pipe._mockcalled\n         # only once\n-        self.assertEqual(m[0], \"get_media_requests\")  # first hook called\n-        self.assertEqual(m.count(\"get_media_requests\"), 1)\n-        self.assertEqual(m.count(\"item_completed\"), 1)\n-        self.assertEqual(m[-1], \"item_completed\")  # last hook called\n+        assert m[0] == \"get_media_requests\"  # first hook called\n+        assert m.count(\"get_media_requests\") == 1\n+        assert m.count(\"item_completed\") == 1\n+        assert m[-1] == \"item_completed\"  # last hook called\n         # twice, one per request\n-        self.assertEqual(m.count(\"media_to_download\"), 2)\n+        assert m.count(\"media_to_download\") == 2\n         # one to handle success and other for failure\n-        self.assertEqual(m.count(\"media_downloaded\"), 1)\n-        self.assertEqual(m.count(\"media_failed\"), 1)\n+        assert m.count(\"media_downloaded\") == 1\n+        assert m.count(\"media_failed\") == 1\n \n     @inlineCallbacks\n     def test_get_media_requests(self):\n@@ -288,7 +274,7 @@ class MediaPipelineTestCase(BaseMediaPipelineTestCase):\n         item = {\"requests\": req}  # pass a single item\n         new_item = yield self.pipe.process_item(item, self.spider)\n         assert new_item is item\n-        self.assertIn(self.fingerprint(req), self.info.downloaded)\n+        assert self.fingerprint(req) in self.info.downloaded\n \n         # returns iterable of Requests\n         req1 = Request(\"http://url1\")\n@@ -305,8 +291,8 @@ class MediaPipelineTestCase(BaseMediaPipelineTestCase):\n         req1 = Request(\"http://url1\", meta={\"response\": rsp1})\n         item = {\"requests\": req1}\n         new_item = yield self.pipe.process_item(item, self.spider)\n-        self.assertTrue(new_item is item)\n-        self.assertEqual(new_item[\"results\"], [(True, {})])\n+        assert new_item is item\n+        assert new_item[\"results\"] == [(True, {})]\n \n         # rsp2 is ignored, rsp1 must be in results because request fingerprints are the same\n         req2 = Request(\n@@ -314,9 +300,9 @@ class MediaPipelineTestCase(BaseMediaPipelineTestCase):\n         )\n         item = {\"requests\": req2}\n         new_item = yield self.pipe.process_item(item, self.spider)\n-        self.assertTrue(new_item is item)\n-        self.assertEqual(self.fingerprint(req1), self.fingerprint(req2))\n-        self.assertEqual(new_item[\"results\"], [(True, {})])\n+        assert new_item is item\n+        assert self.fingerprint(req1) == self.fingerprint(req2)\n+        assert new_item[\"results\"] == [(True, {})]\n \n     @inlineCallbacks\n     def test_results_are_cached_for_requests_of_single_item(self):\n@@ -327,17 +313,17 @@ class MediaPipelineTestCase(BaseMediaPipelineTestCase):\n         )\n         item = {\"requests\": [req1, req2]}\n         new_item = yield self.pipe.process_item(item, self.spider)\n-        self.assertTrue(new_item is item)\n-        self.assertEqual(new_item[\"results\"], [(True, {}), (True, {})])\n+        assert new_item is item\n+        assert new_item[\"results\"] == [(True, {}), (True, {})]\n \n     @inlineCallbacks\n     def test_wait_if_request_is_downloading(self):\n         def _check_downloading(response):\n             fp = self.fingerprint(req1)\n-            self.assertTrue(fp in self.info.downloading)\n-            self.assertTrue(fp in self.info.waiting)\n-            self.assertTrue(fp not in self.info.downloaded)\n-            self.assertEqual(len(self.info.waiting[fp]), 2)\n+            assert fp in self.info.downloading\n+            assert fp in self.info.waiting\n+            assert fp not in self.info.downloaded\n+            assert len(self.info.waiting[fp]) == 2\n             return response\n \n         rsp1 = Response(\"http://url\")\n@@ -348,39 +334,40 @@ class MediaPipelineTestCase(BaseMediaPipelineTestCase):\n             return dfd\n \n         def rsp2_func():\n-            self.fail(\"it must cache rsp1 result and must not try to redownload\")\n+            pytest.fail(\"it must cache rsp1 result and must not try to redownload\")\n \n         req1 = Request(\"http://url\", meta={\"response\": rsp1_func})\n         req2 = Request(req1.url, meta={\"response\": rsp2_func})\n         item = {\"requests\": [req1, req2]}\n         new_item = yield self.pipe.process_item(item, self.spider)\n-        self.assertEqual(new_item[\"results\"], [(True, {}), (True, {})])\n+        assert new_item[\"results\"] == [(True, {}), (True, {})]\n \n     @inlineCallbacks\n     def test_use_media_to_download_result(self):\n         req = Request(\"http://url\", meta={\"result\": \"ITSME\", \"response\": self.fail})\n         item = {\"requests\": req}\n         new_item = yield self.pipe.process_item(item, self.spider)\n-        self.assertEqual(new_item[\"results\"], [(True, \"ITSME\")])\n-        self.assertEqual(\n-            self.pipe._mockcalled,\n-            [\"get_media_requests\", \"media_to_download\", \"item_completed\"],\n-        )\n+        assert new_item[\"results\"] == [(True, \"ITSME\")]\n+        assert self.pipe._mockcalled == [\n+            \"get_media_requests\",\n+            \"media_to_download\",\n+            \"item_completed\",\n+        ]\n \n     def test_key_for_pipe(self):\n-        self.assertEqual(\n-            self.pipe._key_for_pipe(\"IMAGES\", base_class_name=\"MediaPipeline\"),\n-            \"MOCKEDMEDIAPIPELINE_IMAGES\",\n+        assert (\n+            self.pipe._key_for_pipe(\"IMAGES\", base_class_name=\"MediaPipeline\")\n+            == \"MOCKEDMEDIAPIPELINE_IMAGES\"\n         )\n \n \n-class MediaPipelineAllowRedirectSettingsTestCase(unittest.TestCase):\n+class TestMediaPipelineAllowRedirectSettings:\n     def _assert_request_no3xx(self, pipeline_class, settings):\n         pipe = pipeline_class(crawler=get_crawler(None, settings))\n         request = Request(\"http://url\")\n         pipe._modify_media_request(request)\n \n-        self.assertIn(\"handle_httpstatus_list\", request.meta)\n+        assert \"handle_httpstatus_list\" in request.meta\n         for status, check in [\n             (200, True),\n             # These are the status codes we want\n@@ -396,9 +383,9 @@ class MediaPipelineAllowRedirectSettingsTestCase(unittest.TestCase):\n             (500, True),\n         ]:\n             if check:\n-                self.assertIn(status, request.meta[\"handle_httpstatus_list\"])\n+                assert status in request.meta[\"handle_httpstatus_list\"]\n             else:\n-                self.assertNotIn(status, request.meta[\"handle_httpstatus_list\"])\n+                assert status not in request.meta[\"handle_httpstatus_list\"]\n \n     def test_subclass_standard_setting(self):\n         self._assert_request_no3xx(UserDefinedPipeline, {\"MEDIA_ALLOW_REDIRECTS\": True})\n@@ -409,8 +396,8 @@ class MediaPipelineAllowRedirectSettingsTestCase(unittest.TestCase):\n         )\n \n \n-class BuildFromCrawlerTestCase(unittest.TestCase):\n-    def setUp(self):\n+class TestBuildFromCrawler:\n+    def setup_method(self):\n         self.crawler = get_crawler(None, {\"FILES_STORE\": \"/foo\"})\n \n     def test_simple(self):\n@@ -421,7 +408,7 @@ class BuildFromCrawlerTestCase(unittest.TestCase):\n             pipe = Pipeline.from_crawler(self.crawler)\n             assert pipe.crawler == self.crawler\n             assert pipe._fingerprinter\n-            self.assertEqual(len(w), 0)\n+            assert len(w) == 0\n \n     def test_has_old_init(self):\n         class Pipeline(UserDefinedPipeline):\n@@ -433,7 +420,7 @@ class BuildFromCrawlerTestCase(unittest.TestCase):\n             pipe = Pipeline.from_crawler(self.crawler)\n             assert pipe.crawler == self.crawler\n             assert pipe._fingerprinter\n-            self.assertEqual(len(w), 2)\n+            assert len(w) == 2\n             assert pipe._init_called\n \n     def test_has_from_settings(self):\n@@ -450,7 +437,7 @@ class BuildFromCrawlerTestCase(unittest.TestCase):\n             pipe = Pipeline.from_crawler(self.crawler)\n             assert pipe.crawler == self.crawler\n             assert pipe._fingerprinter\n-            self.assertEqual(len(w), 2)\n+            assert len(w) == 2\n             assert pipe._from_settings_called\n \n     def test_has_from_settings_and_from_crawler(self):\n@@ -474,7 +461,7 @@ class BuildFromCrawlerTestCase(unittest.TestCase):\n             pipe = Pipeline.from_crawler(self.crawler)\n             assert pipe.crawler == self.crawler\n             assert pipe._fingerprinter\n-            self.assertEqual(len(w), 2)\n+            assert len(w) == 2\n             assert pipe._from_settings_called\n             assert pipe._from_crawler_called\n \n@@ -497,7 +484,7 @@ class BuildFromCrawlerTestCase(unittest.TestCase):\n             pipe = Pipeline.from_crawler(self.crawler)\n             assert pipe.crawler == self.crawler\n             assert pipe._fingerprinter\n-            self.assertEqual(len(w), 2)\n+            assert len(w) == 2\n             assert pipe._from_settings_called\n             assert pipe._init_called\n \n@@ -521,7 +508,7 @@ class BuildFromCrawlerTestCase(unittest.TestCase):\n             pipe = Pipeline.from_crawler(self.crawler)\n             assert pipe.crawler == self.crawler\n             assert pipe._fingerprinter\n-            self.assertEqual(len(w), 0)\n+            assert len(w) == 0\n             assert pipe._from_crawler_called\n             assert pipe._init_called\n \n@@ -542,5 +529,5 @@ class BuildFromCrawlerTestCase(unittest.TestCase):\n             # this and the next assert will fail as MediaPipeline.from_crawler() wasn't called\n             assert pipe.crawler == self.crawler\n             assert pipe._fingerprinter\n-            self.assertEqual(len(w), 0)\n+            assert len(w) == 0\n             assert pipe._from_crawler_called\n\n\nQuestion: Does this commit introduce technical debt? Answer yes or no."}], "max_tokens": 1, "temperature": 0}}
